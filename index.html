<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
html,body{height:100%;background:#fff7e6}

.tela{position:fixed;inset:0;display:none;flex-direction:column;align-items:center;padding:14px;overflow:auto}
.tela.ativa{display:flex}

.btnVoltarGlobal{
position:fixed;bottom:12px;left:12px;z-index:3000;
background:#333;color:white;border:none;border-radius:14px;padding:12px 16px;font-weight:700;
}

.btnConfig{
position:fixed;top:10px;right:12px;z-index:4000;
font-size:26px;background:white;border:none;border-radius:12px;
padding:8px 10px;box-shadow:0 2px 6px rgba(0,0,0,.2);
}

#telaInicial{
justify-content:center;text-align:center;
background:linear-gradient(180deg,#ff9800,#ff5722);color:white;
}

.logo{font-size:clamp(24px,6vw,36px);font-weight:700;margin-bottom:20px}

.btnPrincipal{
background:white;color:#ff5722;padding:16px;border-radius:14px;
font-size:18px;font-weight:700;border:none;width:100%;max-width:320px;
}

.topo{width:100%;max-width:680px;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}

.abas{display:flex;gap:8px;overflow-x:auto;width:100%;max-width:680px}
.aba{background:#ffe0b2;border:none;padding:10px 14px;border-radius:20px;font-weight:600;white-space:nowrap}

.lista{width:100%;max-width:680px;display:flex;flex-direction:column;gap:10px;padding-bottom:120px}

.item{
background:white;border-radius:14px;padding:10px;
display:flex;justify-content:space-between;align-items:center;
box-shadow:0 2px 6px rgba(0,0,0,.1);gap:8px;
}

.btnAdd{background:#4caf50;color:white;border:none;border-radius:10px;padding:10px 14px;font-weight:700}

.btn{border:none;border-radius:12px;padding:14px;font-weight:700;width:100%;max-width:680px}
.btnPrim{background:#ff5722;color:white}
.btnSec{background:#ccc}

#carrinho{
position:fixed;right:-100%;top:0;width:100%;max-width:420px;height:100%;
background:white;box-shadow:-4px 0 12px rgba(0,0,0,.25);
transition:.3s;display:flex;flex-direction:column;z-index:2000;
}
#carrinho.aberto{right:0}

.cLista{flex:1;overflow:auto;padding:10px}
.cItem{display:flex;justify-content:space-between;margin-bottom:8px}

.form{width:100%;max-width:680px;display:flex;flex-direction:column;gap:12px}

input,select{
padding:14px;border-radius:12px;border:1px solid #ccc;
font-size:16px;width:100%;
}

#telaAdmin{background:#212121;color:white}
.adminBox{background:#424242;padding:12px;border-radius:12px;margin-bottom:12px;width:100%;max-width:680px}
.adminBtn{background:#ff9800;border:none;color:white;padding:12px;border-radius:10px;margin-top:6px;width:100%;font-weight:700}

</style>
</head>
<body>
<!-- ‚öôÔ∏è CONFIG ADMIN -->

<button class="btnConfig"
onclick="abrirConfig()">‚öôÔ∏è</button>

<button class="btnVoltarGlobal"
onclick="voltarUniversal()">‚Üê VOLTAR</button>

<!-- =========================
TELA INICIAL
========================= -->

<div id="telaInicial" class="tela ativa">

<div class="logo">ü•ü Recanto do Pastel</div>

<button class="btnPrincipal"
onclick="abrirCardapio()">
FAZER PEDIDO
</button>

</div>

<!-- =========================
CARD√ÅPIO
========================= -->

<div id="telaCardapio" class="tela">

<div class="topo">
<b>Card√°pio</b>

<button class="btn btnPrim"
style="max-width:180px"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<div id="abas" class="abas"></div>

<div id="lista" class="lista"></div>

</div>

<!-- =========================
CARRINHO
========================= -->

<div id="carrinho">

<div style="padding:16px;font-weight:700">
Seu Pedido
<button style="float:right"
onclick="toggleCarrinho()">X</button>
</div>

<div id="cLista" class="cLista"></div>

<div style="padding:12px">

<div id="linhaFreteCarrinho"
style="display:none;margin-bottom:6px">
Frete: R$
<span id="freteCarrinhoTxt">0.00</span>
</div>

<b>
Total R$
<span id="total">0.00</span>
</b>

</div>

<button class="btn btnPrim"
onclick="irCheckout()">
FINALIZAR
</button>

</div>
<!-- =========================
CHECKOUT
========================= -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:10px">
Finalizar Pedido
</h2>

<div class="form">

<select id="tipoPedido">
<option value="local">Consumir no local</option>
<option value="entrega">Entrega</option>
</select>

<!-- MESA OPCIONAL -->

<div id="boxMesa">
<input id="mesaInput"
placeholder="N√∫mero da mesa (opcional)">
</div>

<input id="nome"
placeholder="Nome do cliente">

<input id="telefone"
placeholder="Telefone">

<!-- ENDERE√áO ENTREGA -->

<div id="boxEndereco" style="display:none">

<input id="rua" placeholder="Rua">
<input id="bairro" placeholder="Bairro">
<input id="numero" placeholder="N√∫mero">

</div>

<select id="pagamento">
<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>
</select>

<!-- TROCO -->

<div id="boxTroco" style="display:none">
<input id="troco"
placeholder="Troco para quanto?">
</div>

<!-- PIX BOX -->

<div id="boxPix"
style="display:none;background:#e8f5e9;padding:12px;border-radius:12px;font-weight:700">

Chave PIX:<br>
<span id="pixChaveTxt"></span>

<br><br>

Valor PIX:<br>
R$ <span id="pixValorTxt">0.00</span>

</div>

<input id="frete" value="0" readonly>

<button class="btn btnPrim"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>
<!-- =========================
PAINEL ADMIN
========================= -->

<div id="telaAdmin" class="tela">

<h2 style="margin-bottom:12px">
Painel Admin
</h2>

<div class="adminBox">

<b>Card√°pio</b>

<button class="adminBtn"
onclick="adminNovaAba()">
Nova Aba
</button>

<button class="adminBtn"
onclick="adminNovoItem()">
Novo Item
</button>

<button class="adminBtn"
onclick="abrirEditorItens()">
Editar / Remover Itens
</button>

</div>

<div class="adminBox">

<b>Pedidos ao Vivo</b>
<div id="adminPedidos"></div>

</div>

<div class="adminBox">

<b>Relat√≥rios</b>

<button class="adminBtn"
onclick="relatorioHoje()">
Relat√≥rio Hoje
</button>

<button class="adminBtn"
onclick="relatorioMes()">
Relat√≥rio M√™s
</button>

<button class="adminBtn"
onclick="relatorioAno()">
Relat√≥rio Ano
</button>

<button class="adminBtn"
onclick="zerarRelatorios()">
Zerar Dados Relat√≥rio
</button>

<button class="adminBtn"
onclick="exportarCSV()">
Exportar CSV
</button>

</div>

</div>

<!-- =========================
EDITOR ITENS
========================= -->

<div id="telaEditorItens" class="tela">

<h2 style="margin-bottom:10px">
Editar / Remover Itens
</h2>

<div id="listaEditor"
class="lista"></div>

</div>

<!-- =========================
BANNER PROMO
========================= -->

<div id="bannerPromo"
style="display:none;position:fixed;top:0;left:0;width:100%;
background:#d32f2f;color:white;text-align:center;
padding:8px;font-weight:700;z-index:3500;">
PROMO
</div>
<script type="module">

/* =========================
CONFIG
========================= */

const ADMIN_SENHA="1234"
let WHATSAPP_LOJA="5599999999999"
let PIX_CHAVE="pix-recanto-exemplo@pix"

/* =========================
FIREBASE
========================= */

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore, collection, addDoc,
onSnapshot, updateDoc, doc, getDocs, deleteDoc
} from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig={
apiKey:"AIzaSyCE6daBipSq0Xjxt3ofW9anxMdN-AecI4w",
authDomain:"recanto-do-pastel-bcea2.firebaseapp.com",
projectId:"recanto-do-pastel-bcea2",
storageBucket:"recanto-do-pastel-bcea2.firebasestorage.app",
messagingSenderId:"304374292790",
appId:"1:304374292790:web:5bd235b7c0419a8dfe1397"
}

const app=initializeApp(firebaseConfig)
const db=getFirestore(app)

/* ========================= */

let carrinho=[]
let pedidosCache=[]
let historico=["telaInicial"]

let cardapio={
"Past√©is":[
{nome:"Pastel Carne",preco:12},
{nome:"Pastel Queijo",preco:11}
],
"Bebidas":[
{nome:"Refri",preco:6}
]
}

function qs(id){return document.getElementById(id)}

function mostrar(id){
document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))
qs(id).classList.add("ativa")
historico.push(id)
}

window.voltarUniversal=()=>{
historico.pop()
let prev=historico.pop()||"telaInicial"
mostrar(prev)
}

/* ADMIN */

window.abrirConfig=()=>{
let s=prompt("Senha admin")
if(s!==ADMIN_SENHA) return
mostrar("telaAdmin")
}

/* CARD√ÅPIO */

window.abrirCardapio=()=>{
mostrar("telaCardapio")
renderAbas()
}

function renderAbas(){
let d=qs("abas")
d.innerHTML=""
Object.keys(cardapio).forEach(nome=>{
let b=document.createElement("button")
b.className="aba"
b.innerText=nome
b.onclick=()=>renderItens(cardapio[nome])
d.appendChild(b)
})
}

function renderItens(lista){
let d=qs("lista")
d.innerHTML=""
lista.forEach(item=>{
let el=document.createElement("div")
el.className="item"
el.innerHTML=`
<div><b>${item.nome}</b><br>
R$ ${item.preco.toFixed(2)}</div>
<button class="btnAdd">+</button>`
el.querySelector("button").onclick=
()=>addCarrinho(item)
d.appendChild(el)
})
}

/* CARRINHO */

function totalItens(){
return carrinho.reduce((s,i)=>s+i.preco*i.qtd,0)
}

function freteAtual(){
return parseFloat(qs("frete").value||0)
}

function totalGeral(){
return totalItens()+freteAtual()
}

function addCarrinho(item){
let ex=carrinho.find(i=>i.nome===item.nome)
if(ex) ex.qtd++
else carrinho.push({...item,qtd:1})
qs("carrinho").classList.add("aberto")
renderCarrinho()
}

window.removerItem=(nome)=>{
carrinho=carrinho.filter(i=>i.nome!==nome)
renderCarrinho()
if(!carrinho.length)
qs("carrinho").classList.remove("aberto")
}

window.toggleCarrinho=()=>{
qs("carrinho").classList.toggle("aberto")
}

function renderCarrinho(){

let d=qs("cLista")
d.innerHTML=""
let qtd=0

carrinho.forEach(i=>{
qtd+=i.qtd
let row=document.createElement("div")
row.className="cItem"
row.innerHTML=`
<span>${i.qtd}x ${i.nome}</span>
<span>
R$ ${(i.qtd*i.preco).toFixed(2)}
<button onclick="removerItem('${i.nome}')">x</button>
</span>`
d.appendChild(row)
})

if(freteAtual()>0){
qs("linhaFreteCarrinho").style.display="block"
qs("freteCarrinhoTxt").innerText=
freteAtual().toFixed(2)
}else{
qs("linhaFreteCarrinho").style.display="none"
}

qs("qtd").innerText=qtd
qs("total").innerText=totalGeral().toFixed(2)

atualizarPixPreview()
}

/* CHECKOUT */

qs("tipoPedido").onchange=e=>{
let ent=e.target.value==="entrega"
qs("boxEndereco").style.display=ent?"block":"none"
qs("boxMesa").style.display=ent?"none":"block"
qs("frete").value = ent?5:0
renderCarrinho()
}

qs("pagamento").onchange=e=>{
let p=e.target.value
qs("boxPix").style.display=(p==="PIX")?"block":"none"
qs("boxTroco").style.display=(p==="Dinheiro")?"block":"none"
atualizarPixPreview()
}

function atualizarPixPreview(){
qs("pixValorTxt").innerText=totalGeral().toFixed(2)
qs("pixChaveTxt").innerText=PIX_CHAVE
}

window.irCheckout=()=>{
if(!carrinho.length) return
mostrar("telaCheckout")
atualizarPixPreview()
}

/* FINALIZAR */

window.finalizarPedido=async()=>{

let nome=qs("nome").value
let tel=qs("telefone").value
if(!nome||!tel) return alert("Preencha dados")

let pedido={
cliente:{nome,tel},
itens:carrinho,
frete:freteAtual(),
total:totalGeral(),
data:new Date().toISOString()
}

await addDoc(collection(db,"pedidos"),pedido)

let txt="ü•ü RECANTO DO PASTEL\n\n"
carrinho.forEach(i=>txt+=`${i.qtd}x ${i.nome}\n`)
txt+=`\nTotal R$ ${pedido.total.toFixed(2)}`

window.open(`https://wa.me/${WHATSAPP_LOJA}?text=${encodeURIComponent(txt)}`)

carrinho=[]
renderCarrinho()
qs("carrinho").classList.remove("aberto")
mostrar("telaInicial")
}

/* SNAPSHOT PEDIDOS */

onSnapshot(collection(db,"pedidos"),snap=>{
pedidosCache=[]
let div=qs("adminPedidos")
if(div) div.innerHTML=""

snap.forEach(d=>{
let p=d.data()
p._id=d.id
pedidosCache.push(p)

if(div){
let el=document.createElement("div")
el.className="adminBox"
el.innerHTML=`${p.cliente.nome}<br>R$ ${p.total.toFixed(2)}`
div.appendChild(el)
}
})
})

/* RELAT√ìRIOS */

function somaFiltro(fn){
return pedidosCache.filter(fn)
.reduce((s,p)=>s+p.total,0)
}

window.relatorioHoje=()=>{
let h=new Date().toDateString()
alert("Hoje R$ "+somaFiltro(
p=>new Date(p.data).toDateString()===h
).toFixed(2))
}

window.relatorioMes=()=>{
let m=new Date().getMonth()
alert("M√™s R$ "+somaFiltro(
p=>new Date(p.data).getMonth()===m
).toFixed(2))
}

window.relatorioAno=()=>{
let a=new Date().getFullYear()
alert("Ano R$ "+somaFiltro(
p=>new Date(p.data).getFullYear()===a
).toFixed(2))
}

window.zerarRelatorios=async()=>{
if(!confirm("Apagar pedidos?")) return
let snap=await getDocs(collection(db,"pedidos"))
for(let d of snap.docs){
await deleteDoc(doc(db,"pedidos",d.id))
}
}

/* CSV */

window.exportarCSV=()=>{
let l=["data,total"]
pedidosCache.forEach(p=>l.push(`${p.data},${p.total}`))
let blob=new Blob([l.join("\n")])
let a=document.createElement("a")
a.href=URL.createObjectURL(blob)
a.download="relatorio.csv"
a.click()
}

/* EDITAR / REMOVER */

window.abrirEditorItens=()=>{
let d=qs("listaEditor")
d.innerHTML=""

Object.keys(cardapio).forEach(a=>{
cardapio[a].forEach(i=>{
let el=document.createElement("div")
el.className="item"
el.innerHTML=`
<div>${a}<br>${i.nome}<br>R$ ${i.preco}</div>
<div>
<button onclick="editarItemAdmin('${a}','${i.nome}')">Editar</button>
<button onclick="removerItemAdmin('${a}','${i.nome}')">Remover</button>
</div>`
d.appendChild(el)
})
})

mostrar("telaEditorItens")
}

window.editarItemAdmin=(a,n)=>{
let item=cardapio[a].find(i=>i.nome===n)
let nn=prompt("Nome",item.nome)
let np=parseFloat(prompt("Pre√ßo",item.preco))
if(nn && !isNaN(np)){
item.nome=nn
item.preco=np
}
abrirEditorItens()
renderItens(cardapio[a])
}

window.removerItemAdmin=(a,n)=>{
cardapio[a]=cardapio[a].filter(i=>i.nome!==n)
abrirEditorItens()
renderItens(cardapio[a])
}

renderAbas()

</script>
</body>
</html>
