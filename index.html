<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700" rel="stylesheet">

<style>

*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
background:#fff7e6;
overflow:hidden;
}

/* ===== TELAS ===== */

.tela{
position:absolute;
top:0;left:0;
width:100%;height:100%;
display:none;
flex-direction:column;
align-items:center;
padding:16px;
}

.tela.ativa{display:flex}

/* ===== BOT√ÉO VOLTAR GLOBAL ===== */

.btnVoltarGlobal{
position:fixed;
bottom:14px;
left:14px;
z-index:2000;
background:#333;
color:white;
border:none;
border-radius:14px;
padding:12px 16px;
font-weight:700;
}

/* ===== INICIAL ===== */

#telaInicial{
justify-content:center;
background:linear-gradient(180deg,#ff9800,#ff5722);
color:white;
text-align:center;
}

.logo{
font-size:34px;
font-weight:700;
margin-bottom:20px;
}

.btnPrincipal{
background:white;
color:#ff5722;
padding:14px 24px;
border-radius:14px;
font-size:18px;
font-weight:700;
border:none;
width:260px;
}

/* ===== TOPO ===== */

.topo{
width:100%;
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}

.titulo{
font-size:22px;
font-weight:700;
color:#e65100;
}

/* ===== ABAS ===== */

.abas{
display:flex;
gap:8px;
overflow-x:auto;
width:100%;
margin-bottom:10px;
}

.aba{
background:#ffe0b2;
border:none;
padding:10px 14px;
border-radius:20px;
font-weight:600;
white-space:nowrap;
}

.aba.ativa{
background:#ff9800;
color:white;
}

/* ===== LISTA ===== */

.lista{
width:100%;
flex:1;
overflow-y:auto;
padding-bottom:140px;
}

.item{
background:white;
border-radius:14px;
padding:10px;
margin-bottom:10px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.item.promocao{
border:2px solid #ff5722;
background:#fff3e0;
}

.itemInfo{
display:flex;
gap:10px;
align-items:center;
}

.itemInfo img{
width:60px;
height:60px;
border-radius:10px;
object-fit:cover;
}

.btnAdd{
background:#4caf50;
color:white;
border:none;
border-radius:10px;
padding:8px 12px;
font-weight:700;
}

/* ===== CARRINHO ===== */

#carrinho{
position:fixed;
right:-100%;
top:0;
width:100%;
max-width:420px;
height:100%;
background:white;
box-shadow:-4px 0 12px rgba(0,0,0,0.2);
transition:.3s;
display:flex;
flex-direction:column;
z-index:999;
}

#carrinho.aberto{right:0}

.cTop{
padding:16px;
font-weight:700;
font-size:20px;
display:flex;
justify-content:space-between;
color:#e65100;
}

.cLista{
flex:1;
overflow:auto;
padding:10px;
}

.cItem{
display:flex;
justify-content:space-between;
margin-bottom:8px;
}

.total{
padding:12px;
font-size:20px;
font-weight:700;
}

.btn{
border:none;
border-radius:12px;
padding:12px;
font-weight:700;
}

.btnPrim{background:#ff5722;color:white}
.btnSec{background:#ccc}

button{cursor:pointer}

/* ===== CHECKOUT ===== */

.form{
width:100%;
max-width:420px;
display:flex;
flex-direction:column;
gap:10px;
}

input,select{
padding:12px;
border-radius:10px;
border:1px solid #ccc;
font-size:15px;
}

/* ===== ADMIN ===== */

#telaAdmin{
background:#212121;
color:white;
overflow:auto;
}

.adminBox{
background:#424242;
padding:12px;
border-radius:12px;
margin-bottom:12px;
width:100%;
max-width:520px;
}

.adminBtn{
background:#ff9800;
border:none;
color:white;
padding:10px;
border-radius:10px;
margin-top:6px;
width:100%;
font-weight:700;
}

</style>
</head>
<body>

<button class="btnVoltarGlobal"
onclick="voltarUniversal()">
‚Üê VOLTAR
</button>

<!-- ===== TELA INICIAL ===== -->

<div id="telaInicial" class="tela ativa">
<div class="logo">ü•ü Recanto do Pastel</div>
<button class="btnPrincipal"
onclick="abrirCardapio()">
FAZER PEDIDO
</button>

<button class="btn btnSec"
style="margin-top:12px"
onclick="loginAdmin()">
PAINEL ADMIN
</button>
</div>

<!-- ===== CARD√ÅPIO ===== -->

<div id="telaCardapio" class="tela">

<div class="topo">
<div class="titulo">Card√°pio</div>
<button class="btn btnPrim"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<div id="abas" class="abas"></div>
<div id="lista" class="lista"></div>

</div>

<!-- ===== CARRINHO ===== -->

<div id="carrinho">

<div class="cTop">
Seu Pedido
<button onclick="toggleCarrinho()">X</button>
</div>

<div id="cLista" class="cLista"></div>

<div class="total">
Total R$ <span id="total">0.00</span>
</div>

<button class="btn btnPrim"
onclick="irCheckout()">
FINALIZAR
</button>

</div>
<!-- ===== CHECKOUT ===== -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:10px">
Finalizar Pedido
</h2>

<div class="form">

<select id="tipoPedido">
<option value="local">Consumir no local</option>
<option value="entrega">Entrega</option>
</select>

<input id="nome" placeholder="Nome do cliente">
<input id="telefone" placeholder="Telefone">

<div id="boxEndereco" style="display:none">
<input id="rua" placeholder="Rua">
<input id="bairro" placeholder="Bairro">
<input id="numero" placeholder="N√∫mero">
</div>

<select id="pagamento">
<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>
</select>

<div id="boxTroco" style="display:none">
<input id="troco" placeholder="Troco para quanto?">
</div>

<!-- PIX VISUAL SOMENTE -->
<div id="boxPix" style="
display:none;
background:#e8f5e9;
padding:10px;
border-radius:10px;
font-weight:700;
">
PIX da loja:<br>
<span id="pixChaveTxt"></span><br>
Valor do PIX:<br>
R$ <span id="pixValorTxt">0.00</span>
</div>

<input id="frete"
placeholder="Frete R$"
value="0"
readonly>

<button class="btn btnPrim"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>

<!-- ===== ADMIN SIMPLIFICADO ===== -->

<div id="telaAdmin" class="tela">

<h2 style="margin-bottom:12px">
Painel Admin
</h2>

<div class="adminBox">

<b>Card√°pio</b>

<button class="adminBtn"
onclick="adminNovaAba()">
Nova Aba
</button>

<button class="adminBtn"
onclick="adminNovoItem()">
Novo Item
</button>

<button class="adminBtn"
onclick="abrirEditorItens()">
Editar / Remover Itens
</button>

</div>

<div class="adminBox">

<b>Promo√ß√µes</b>

<button class="adminBtn"
onclick="adminBanner()">
Banner Promo
</button>

<button class="adminBtn"
onclick="adminPromoItem()">
Marcar Item Promo
</button>

</div>

<div class="adminBox">

<b>Pedidos ao Vivo</b>
<div id="adminPedidos"></div>

</div>

<div class="adminBox">

<b>Relat√≥rios</b>

<button class="adminBtn"
onclick="relatorioHoje()">
Hoje
</button>

<button class="adminBtn"
onclick="relatorioMes()">
M√™s
</button>

<button class="adminBtn"
onclick="relatorioAno()">
Ano
</button>

<button class="adminBtn"
onclick="exportarCSV()">
Exportar Excel
</button>

<button class="adminBtn"
onclick="zerarRelatorios()">
Zerar
</button>

</div>

</div>

<!-- ===== TELA EDITAR / REMOVER ===== -->

<div id="telaEditorItens" class="tela">

<h2 style="margin-bottom:10px">
Editar / Remover Itens
</h2>

<div id="listaEditor"
style="
width:100%;
max-width:520px;
overflow:auto;
">
</div>

</div>

<!-- ===== BANNER PROMO ===== -->

<div id="bannerPromo"
style="
display:none;
position:fixed;
top:0;
left:0;
width:100%;
background:#d32f2f;
color:white;
text-align:center;
padding:6px;
font-weight:700;
z-index:1000;
">
PROMO
</div>
<script type="module">

/* ======================================
CONFIG
====================================== */

const ADMIN_SENHA = "1234"
let WHATSAPP_LOJA = "5599999999999" // editar
let PIX_CHAVE = "SUA_CHAVE_PIX"

/* ======================================
ESTADO
====================================== */

let carrinho=[]
let abaAtual=null
let mesaDetectada=null
let pedidosCache=[]

let historicoTelas=["telaInicial"]

let cardapio={
"Past√©is":[
{nome:"Pastel Carne",preco:12},
{nome:"Pastel Queijo",preco:11}
],
"Lanches":[{nome:"X-Burger",preco:18}],
"Por√ß√µes":[{nome:"Batata",preco:22}],
"Bebidas":[{nome:"Refri",preco:6}]
}

const FRETES={
Centro:5,
Industrial:8,
Jardim:6
}

/* ======================================
UTIL
====================================== */

function qs(id){return document.getElementById(id)}

function mostrar(id){
document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))
qs(id).classList.add("ativa")
historicoTelas.push(id)
}

/* ======================================
VOLTAR UNIVERSAL
====================================== */

window.voltarUniversal=()=>{

historicoTelas.pop()

let ultima = historicoTelas.pop()
if(!ultima) ultima="telaInicial"

mostrar(ultima)

}

/* ======================================
ZOOM OFF
====================================== */

document.addEventListener("dblclick",
e=>e.preventDefault(),{passive:false})

/* ======================================
QR MESA
====================================== */

let u=new URL(location.href)
mesaDetectada=u.searchParams.get("mesa")

/* ======================================
TELAS
====================================== */

window.abrirCardapio=()=>{
mostrar("telaCardapio")
renderAbas()
}

window.loginAdmin=()=>{
let s=prompt("Senha admin")
if(s!==ADMIN_SENHA) return
mostrar("telaAdmin")
}

/* ======================================
ABAS
====================================== */

function renderAbas(){

let d=qs("abas")
d.innerHTML=""

Object.keys(cardapio).forEach(nome=>{

let b=document.createElement("button")
b.className="aba"
b.innerText=nome

b.onclick=()=>{

if(abaAtual===nome){
abaAtual=null
renderItens([])
b.classList.remove("ativa")
return
}

abaAtual=nome
document.querySelectorAll(".aba")
.forEach(x=>x.classList.remove("ativa"))
b.classList.add("ativa")

renderItens(cardapio[nome])

}

d.appendChild(b)

})

}

/* ======================================
ITENS
====================================== */

function renderItens(lista){

let d=qs("lista")
d.innerHTML=""

lista.forEach(item=>{

let el=document.createElement("div")
el.className="item"
if(item.promocao) el.classList.add("promocao")

el.innerHTML=`
<div class="itemInfo">
${item.img?`<img src="${item.img}">`:""}
<div>
<b>${item.promocao?"üî• ":""}${item.nome}</b><br>
R$ ${item.preco.toFixed(2)}
</div>
</div>
<button class="btnAdd">+</button>
`

el.querySelector("button").onclick=
()=>addCarrinho(item)

d.appendChild(el)

})

}

/* ======================================
CARRINHO
====================================== */

function abrirCarrinhoAuto(){
qs("carrinho").classList.add("aberto")
}

window.toggleCarrinho=()=>{
qs("carrinho").classList.toggle("aberto")
}

function addCarrinho(item){

let ex=carrinho.find(
i=>i.nome===item.nome)

if(ex) ex.qtd++
else carrinho.push({...item,qtd:1})

abrirCarrinhoAuto()
renderCarrinho()

}

window.removerItem=(nome)=>{

carrinho=carrinho.filter(
i=>i.nome!==nome)

renderCarrinho()

if(!carrinho.length)
qs("carrinho").classList.remove("aberto")

}

function renderCarrinho(){

let d=qs("cLista")
d.innerHTML=""

let total=0
let qtd=0

carrinho.forEach(i=>{

total+=i.preco*i.qtd
qtd+=i.qtd

let row=document.createElement("div")
row.className="cItem"

row.innerHTML=`
<span>${i.qtd}x ${i.nome}</span>
<span>
R$ ${(i.preco*i.qtd).toFixed(2)}
<button onclick="removerItem('${i.nome}')">x</button>
</span>
`

d.appendChild(row)

})

qs("total").innerText=total.toFixed(2)
qs("qtd").innerText=qtd

atualizarPixPreview(total)

}

/* ======================================
PIX PREVIEW
====================================== */

function atualizarPixPreview(total){

let frete=parseFloat(qs("frete").value||0)
let v = total + frete
qs("pixValorTxt").innerText=v.toFixed(2)

}

/* ======================================
CHECKOUT UI
====================================== */

qs("tipoPedido").onchange=e=>{
let ent=e.target.value==="entrega"
qs("boxEndereco").style.display=
ent?"block":"none"
qs("frete").value = ent?5:0
renderCarrinho()
}

qs("bairro").onchange=e=>{
let v=FRETES[e.target.value]
if(v) qs("frete").value=v
renderCarrinho()
}

qs("pagamento").onchange=e=>{

let p=e.target.value

qs("boxPix").style.display=
(p==="PIX")?"block":"none"

qs("boxTroco").style.display=
(p==="Dinheiro")?"block":"none"

qs("pixChaveTxt").innerText=PIX_CHAVE

}

/* ======================================
CHECKOUT
====================================== */

window.irCheckout=()=>{
if(!carrinho.length) return
mostrar("telaCheckout")
renderCarrinho()
}

/* ======================================
ADMIN ‚Äî EDITOR ITENS
====================================== */

window.abrirEditorItens=()=>{

let div=qs("listaEditor")
div.innerHTML=""

Object.keys(cardapio)
.forEach(aba=>{

cardapio[aba]
.forEach(item=>{

let row=document.createElement("div")
row.className="item"

row.innerHTML=`
<div>
<b>${aba}</b><br>
${item.nome}<br>
R$ ${item.preco}
</div>
<div>
<button onclick="editarItem('${aba}','${item.nome}')">
Editar
</button>
<button onclick="removerItemAdmin('${aba}','${item.nome}')">
Remover
</button>
</div>
`

div.appendChild(row)

})

})

mostrar("telaEditorItens")

}

window.editarItem=(aba,nome)=>{

let i=cardapio[aba]
.find(x=>x.nome===nome)
if(!i) return

i.preco=parseFloat(
prompt("Pre√ßo:",i.preco))

salvarLocal()
abrirEditorItens()

}

window.removerItemAdmin=(aba,nome)=>{

cardapio[aba]=cardapio[aba]
.filter(x=>x.nome!==nome)

salvarLocal()
abrirEditorItens()

}

/* ======================================
ADMIN BASICO
====================================== */

window.adminNovaAba=()=>{
let n=prompt("Nome aba")
if(!n) return
cardapio[n]=[]
salvarLocal()
renderAbas()
}

window.adminNovoItem=()=>{
let a=prompt("Aba")
if(!cardapio[a]) return
let n=prompt("Nome")
let p=parseFloat(prompt("Pre√ßo"))
cardapio[a].push({nome:n,preco:p})
salvarLocal()
renderItens(cardapio[a])
}

/* ======================================
LOCAL BACKUP
====================================== */

function salvarLocal(){
localStorage.setItem(
"recanto_data",
JSON.stringify({cardapio,pedidosCache})
)
}

function carregarLocal(){
let d=localStorage.getItem("recanto_data")
if(d){
let o=JSON.parse(d)
cardapio=o.cardapio||cardapio
pedidosCache=o.pedidosCache||[]
}
}

carregarLocal()
renderAbas()

/* ======================================
FIREBASE
====================================== */

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore, collection, addDoc,
onSnapshot, updateDoc, doc
} from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig = {
apiKey: "COLE_AQUI",
authDomain: "COLE_AQUI",
projectId: "COLE_AQUI",
storageBucket: "COLE_AQUI",
messagingSenderId: "COLE_AQUI",
appId: "COLE_AQUI"
}

const app = initializeApp(firebaseConfig)
const db = getFirestore(app)

/* ======================================
FINALIZAR PEDIDO
====================================== */

window.finalizarPedido = async ()=>{

let nome=qs("nome").value
let tel=qs("telefone").value
let tipo=qs("tipoPedido").value
let pag=qs("pagamento").value

if(!nome||!tel){
alert("Preencha nome e telefone")
return
}

let totalItens = carrinho.reduce(
(s,i)=>s+i.preco*i.qtd,0)

let frete=parseFloat(qs("frete").value||0)
let total = totalItens + frete

let pedido={
cliente:{nome,tel},
mesa:mesaDetectada,
tipo,
pagamento:pag,
troco:qs("troco").value||"",
endereco:{
rua:qs("rua").value,
bairro:qs("bairro").value,
numero:qs("numero").value
},
itens:carrinho,
total,
data:new Date().toISOString(),
status:"novo"
}

await addDoc(
collection(db,"pedidos"),
pedido
)

pedidosCache.push(pedido)
salvarLocal()

/* ===== WHATSAPP TEXTO ===== */

let txt="ü•ü RECANTO DO PASTEL\n\n"

carrinho.forEach(i=>{
txt+=`${i.qtd}x ${i.nome} ‚Äî R$ ${(i.qtd*i.preco).toFixed(2)}\n`
})

txt+=`\nFrete: R$ ${frete.toFixed(2)}`
txt+=`\nTOTAL: R$ ${total.toFixed(2)}`
txt+=`\nPagamento: ${pag}`
txt+=`\nCliente: ${nome}`

if(tipo==="entrega"){
txt+=`\nEntrega: ${pedido.endereco.rua}, `
+ `${pedido.endereco.numero} `
+ `- ${pedido.endereco.bairro}`
}

if(pag==="PIX"){
txt+=`\nPIX: ${PIX_CHAVE}`
}

if(pag==="Dinheiro" && pedido.troco){
txt+=`\nTroco: ${pedido.troco}`
}

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(txt)}`)

/* reset */

carrinho=[]
renderCarrinho()
qs("carrinho").classList.remove("aberto")
mostrar("telaInicial")

}

/* ======================================
PEDIDOS AO VIVO ADMIN
====================================== */

onSnapshot(
collection(db,"pedidos"),
snap=>{

let div=qs("adminPedidos")
div.innerHTML=""

snap.forEach(d=>{

let p=d.data()

let box=document.createElement("div")
box.style.background="#616161"
box.style.padding="8px"
box.style.marginBottom="6px"
box.style.borderRadius="8px"

box.innerHTML=`
<b>${p.cliente.nome}</b><br>
R$ ${p.total.toFixed(2)}<br>
Status: ${p.status}<br>
<button onclick="marcarPronto(
'${d.id}',
'${p.cliente.tel}'
)">
Pedido Pronto
</button>
`

div.appendChild(box)

})

})

/* ======================================
MARCAR PRONTO
====================================== */

window.marcarPronto=async(id,tel)=>{

await updateDoc(
doc(db,"pedidos",id),
{status:"pronto"}
)

window.open(
`https://wa.me/${tel}?text=${
encodeURIComponent("Seu pedido est√° pronto! ü•ü")}`
)

}

/* ======================================
PROMO / BANNER
====================================== */

window.adminPromoItem=()=>{
let a=prompt("Aba")
let n=prompt("Item")
let i=cardapio[a]
.find(x=>x.nome===n)
if(i) i.promocao=true
salvarLocal()
renderItens(cardapio[a])
}

window.adminBanner=()=>{
let t=prompt("Texto banner")
let b=qs("bannerPromo")
if(!t){b.style.display="none";return}
b.innerText=t
b.style.display="block"
}

/* ======================================
RELAT√ìRIOS + CSV
====================================== */

function soma(fn){
return pedidosCache
.filter(fn)
.reduce((s,p)=>s+p.total,0)
}

window.relatorioHoje=()=>{
let h=new Date().toDateString()
alert("Hoje R$ "+
soma(p=>
new Date(p.data)
.toDateString()===h
).toFixed(2))
}

window.relatorioMes=()=>{
let m=new Date().getMonth()
alert("M√™s R$ "+
soma(p=>
new Date(p.data).getMonth()===m
).toFixed(2))
}

window.relatorioAno=()=>{
let a=new Date().getFullYear()
alert("Ano R$ "+
soma(p=>
new Date(p.data).getFullYear()===a
).toFixed(2))
}

window.zerarRelatorios=()=>{
if(confirm("Zerar dados?")){
pedidosCache=[]
salvarLocal()
}
}

window.exportarCSV=()=>{

let l=["data,total"]

pedidosCache.forEach(p=>{
l.push(`${p.data},${p.total}`)
})

let blob=new Blob([l.join("\n")])
let a=document.createElement("a")
a.href=URL.createObjectURL(blob)
a.download="relatorio.csv"
a.click()

}

/* ======================================
INIT FINAL
====================================== */

renderAbas()

</script>
</body>
</html>
