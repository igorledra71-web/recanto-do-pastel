<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<style>
:root{
--bg:#fdf6ee;
--card:#fff;
--accent:#c4632a;
--accent2:#e8854a;
--accent-light:#f5dcc8;
--text:#3a2a1a;
--text2:#7a6a5a;
--border:#e8ddd0;
--shadow:0 2px 12px rgba(60,40,20,.08);
--radius:16px;
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Poppins',sans-serif;
-webkit-tap-highlight-color:transparent;
}

html,body{
height:100%;
background:var(--bg);
overflow-x:hidden;
color:var(--text);
}

button{
transition:transform .15s ease,box-shadow .15s ease,opacity .15s ease;
cursor:pointer;
-webkit-user-select:none;
user-select:none;
}

button:active{
transform:scale(.94) !important;
opacity:.85;
}

/* =========================
TELAS
========================= */

.tela{
position:fixed;
inset:0;
display:none;
flex-direction:column;
align-items:center;
padding:20px;
padding-bottom:80px;
overflow-y:auto;
overflow-x:hidden;
z-index:100;
background:var(--bg);
animation:fadeIn .35s ease;
}

.tela.ativa{
display:flex;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(12px)}
to{opacity:1;transform:translateY(0)}
}

@keyframes slideUp{
from{opacity:0;transform:translateY(20px)}
to{opacity:1;transform:translateY(0)}
}

@keyframes slideRight{
from{transform:translateX(100%)}
to{transform:translateX(0)}
}

/* =========================
TELA ESCOLHA
========================= */

#telaEscolha{
justify-content:center;
background:linear-gradient(160deg,#f5e6d0 0%,#e8c9a8 40%,#c4632a 100%);
color:var(--text);
text-align:center;
padding-bottom:20px;
}

.logoTopo{
width:85%;
max-width:320px;
margin-bottom:30px;
filter:drop-shadow(0 8px 24px rgba(60,30,10,.3));
animation:slideUp .6s ease;
}

#telaEscolha h1{
color:white;
font-size:clamp(20px,5vw,28px);
text-shadow:0 2px 8px rgba(60,30,10,.3);
margin-bottom:24px;
animation:slideUp .6s ease .1s both;
}

.btnEscolha{
background:white;
color:var(--accent);
padding:18px 24px;
border-radius:var(--radius);
font-size:clamp(16px,4vw,20px);
font-weight:800;
border:none;
width:100%;
max-width:360px;
margin-top:12px;
box-shadow:0 4px 16px rgba(60,30,10,.15);
animation:slideUp .5s ease .2s both;
}

/* =========================
CARD√ÅPIO
========================= */

#telaCardapio{
background:var(--bg);
padding-top:16px;
}

.topo{
width:100%;
max-width:760px;
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:14px;
padding:0 4px;
}

.topo b{
font-size:clamp(18px,5vw,24px);
color:var(--text);
}

.btnCarrinho{
background:var(--accent);
color:white;
border:none;
padding:12px 20px;
border-radius:var(--radius);
font-weight:800;
font-size:14px;
box-shadow:0 3px 10px rgba(196,99,42,.3);
}

/* =========================
BUSCA
========================= */

.buscaInput{
width:100%;
max-width:760px;
padding:14px 18px;
padding-left:44px;
border-radius:var(--radius);
border:2px solid var(--border);
font-size:14px;
margin-bottom:14px;
background:white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%237a6a5a' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E") no-repeat 14px center;
color:var(--text);
}

.buscaInput:focus{
outline:none;
border-color:var(--accent);
box-shadow:0 0 0 3px rgba(196,99,42,.12);
}

/* =========================
ABAS (HIDDEN, replaced by accordion)
========================= */

.abas{
display:none;
}

/* =========================
ACCORDION CATEGORIES
========================= */

.lista{
width:100%;
max-width:760px;
display:flex;
flex-direction:column;
gap:10px;
padding-bottom:100px;
}

.categoriaHeader{
width:100%;
background:white;
border:2px solid var(--border);
border-radius:var(--radius);
padding:16px 20px;
font-size:clamp(15px,3.5vw,17px);
font-weight:800;
color:var(--text);
text-align:left;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:var(--shadow);
}

.categoriaHeader::after{
content:'‚ñ∏';
font-size:18px;
color:var(--accent);
transition:transform .3s ease;
flex-shrink:0;
margin-left:10px;
}

.categoriaHeader.aberta{
background:var(--accent);
color:white;
border-color:var(--accent);
}

.categoriaHeader.aberta::after{
content:'‚ñæ';
color:white;
}

.categoriaItens{
display:none;
flex-direction:column;
gap:10px;
padding:6px 0;
animation:slideUp .3s ease;
}

.categoriaItens.visivel{
display:flex;
}

.item{
background:white;
border-radius:14px;
padding:16px;
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
border:1px solid var(--border);
box-shadow:0 1px 6px rgba(60,40,20,.04);
animation:slideUp .25s ease;
}

.itemInfo{
flex:1;
}

.itemNome{
font-size:clamp(14px,3.2vw,16px);
font-weight:700;
color:var(--text);
line-height:1.3;
}

.btnImprimir{
width:100%;
padding:12px;
margin-top:8px;
border:2px solid var(--accent2);
background:transparent;
color:var(--accent2);
font-size:14px;
font-weight:700;
border-radius:12px;
cursor:pointer;
transition:all .2s;
}
.btnImprimir:active{
transform:scale(.96);
background:var(--accent2);
color:#fff;
}

.adicionaisGrid{
display:grid;
grid-template-columns:1fr 1fr;
gap:6px;
margin-bottom:16px;
max-height:40vh;
overflow-y:auto;
padding:4px;
}
.adicionalLabel{
display:flex;
align-items:center;
gap:6px;
font-size:14px;
color:var(--text);
padding:8px;
background:#fdf6ee;
border-radius:8px;
cursor:pointer;
}
.adicionalLabel input{
width:18px;
height:18px;
accent-color:var(--accent);
}

.btnMaisItens{
width:100%;
padding:14px;
margin-top:12px;
border:2px dashed var(--accent);
background:transparent;
color:var(--accent);
font-size:15px;
font-weight:700;
border-radius:12px;
cursor:pointer;
transition:all .2s;
}
.btnMaisItens:active{
transform:scale(.96);
}

.itemNum{
color:var(--accent);
font-weight:700;
font-size:clamp(13px,3vw,15px);
opacity:0.85;
}

.itemDesc{
font-size:12px;
color:var(--text2);
margin-top:2px;
line-height:1.3;
}

.itemPrecos{
display:flex;
gap:8px;
flex-wrap:wrap;
margin-top:4px;
}

.itemPreco{
font-size:14px;
font-weight:800;
color:var(--accent);
}

.btnAdd{
background:var(--accent);
color:white;
border:none;
border-radius:12px;
padding:10px 16px;
font-weight:800;
font-size:13px;
white-space:nowrap;
flex-shrink:0;
box-shadow:0 2px 8px rgba(196,99,42,.2);
}

/* =========================
CARRINHO
========================= */

#carrinho{
position:fixed;
top:0;
right:-100%;
width:92%;
max-width:420px;
height:100%;
background:white;
box-shadow:-4px 0 24px rgba(60,30,10,.15);
transition:right .35s cubic-bezier(.4,0,.2,1);
display:flex;
flex-direction:column;
z-index:900;
border-top-left-radius:24px;
border-bottom-left-radius:24px;
}

#carrinho.aberto{
right:0;
}

.carrinhoHeader{
padding:20px;
font-weight:900;
font-size:18px;
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:1px solid var(--border);
color:var(--text);
}

.carrinhoFechar{
background:var(--accent-light);
border:none;
border-radius:10px;
padding:8px 14px;
font-weight:800;
color:var(--accent);
font-size:16px;
}

.cLista{
flex:1;
overflow:auto;
padding:16px;
display:flex;
flex-direction:column;
gap:12px;
}

.cItem{
background:var(--bg);
border-radius:14px;
padding:14px;
display:flex;
flex-direction:column;
gap:8px;
border:1px solid var(--border);
}

.cItemNome{
font-size:15px;
font-weight:700;
color:var(--text);
}

.cItemPreco{
color:var(--accent);
font-weight:800;
font-size:14px;
}

.qtdControle{
display:flex;
align-items:center;
justify-content:center;
gap:14px;
margin-top:4px;
}

.btnQtd{
width:36px;
height:36px;
border-radius:50%;
border:none;
font-size:18px;
font-weight:900;
display:flex;
align-items:center;
justify-content:center;
}

.btnQtdMenos{
background:var(--accent-light);
color:var(--accent);
}

.btnQtdMais{
background:var(--accent);
color:white;
}

.qtdNum{
font-size:18px;
font-weight:900;
min-width:30px;
text-align:center;
color:var(--text);
}

.carrinhoFooter{
padding:16px;
border-top:1px solid var(--border);
background:white;
}

.carrinhoFrete{
font-weight:800;
color:var(--accent);
margin-bottom:6px;
font-size:14px;
}

.carrinhoTotal{
font-size:18px;
font-weight:900;
color:var(--text);
margin-bottom:12px;
}

.btnFinalizarCarrinho{
width:100%;
padding:16px;
border-radius:var(--radius);
font-size:16px;
font-weight:900;
background:var(--accent);
color:white;
border:none;
box-shadow:0 4px 14px rgba(196,99,42,.3);
}

/* =========================
CHECKOUT
========================= */

#telaCheckout{
background:var(--bg);
}

#telaCheckout h2{
font-size:clamp(18px,5vw,24px);
color:var(--text);
margin-bottom:16px;
}

.checkoutResumo{
width:100%;
max-width:760px;
background:white;
border-radius:var(--radius);
padding:20px;
border:1px solid var(--border);
margin-bottom:18px;
box-shadow:var(--shadow);
}

.checkoutResumo .titulo{
font-weight:900;
font-size:16px;
margin-bottom:12px;
color:var(--text);
}

.form{
width:100%;
max-width:760px;
display:flex;
flex-direction:column;
gap:12px;
}

input,select{
padding:14px 16px;
border-radius:12px;
border:2px solid var(--border);
font-size:14px;
width:100%;
background:white;
color:var(--text);
font-family:'Poppins',sans-serif;
transition:border-color .2s;
}

input:focus,select:focus{
outline:none;
border-color:var(--accent);
box-shadow:0 0 0 3px rgba(196,99,42,.1);
}

/* =========================
PIX BOX
========================= */

.pixBox{
background:white;
border-radius:var(--radius);
padding:20px;
display:flex;
flex-direction:column;
gap:12px;
border:2px solid var(--border);
box-shadow:var(--shadow);
}

.pixBox .pixTitulo{
font-weight:900;
font-size:16px;
color:var(--text);
}

.pixBox .pixChave{
font-size:16px;
font-weight:800;
color:var(--accent);
word-break:break-all;
}

.pixBox .pixValor{
font-weight:900;
font-size:16px;
color:var(--text);
}

.btnCopiarPix{
background:var(--accent);
color:white;
border:none;
padding:14px;
border-radius:12px;
font-weight:800;
font-size:14px;
width:100%;
box-shadow:0 3px 10px rgba(196,99,42,.25);
}

.btnComprovante{
background:#5a3e2b;
color:white;
border:none;
padding:14px;
border-radius:12px;
font-weight:800;
font-size:14px;
width:100%;
margin-top:4px;
box-shadow:0 3px 10px rgba(90,62,43,.25);
}

.btnEnviarPedido{
width:100%;
padding:16px;
border-radius:var(--radius);
font-size:16px;
font-weight:900;
background:#5a3e2b;
color:white;
border:none;
box-shadow:0 4px 14px rgba(90,62,43,.3);
}

/* =========================
OBS ITEM
========================= */

.obsItem{
font-size:12px;
color:var(--text2);
font-style:italic;
margin-top:2px;
}

/* =========================
ADMIN
========================= */

#telaAdmin{
background:#2a1f14;
color:#f0e6da;
}

#telaAdmin h2{
color:#f0e6da;
font-size:clamp(18px,5vw,24px);
}

.adminBox{
background:#3a2f24;
padding:18px;
border-radius:var(--radius);
margin-bottom:14px;
width:100%;
max-width:760px;
border:1px solid #4a3f34;
}

.adminBox b{
color:#f0e6da;
font-size:15px;
}

.adminBtn{
background:#4a3f34;
border:none;
color:#f0e6da;
padding:14px;
border-radius:12px;
margin-top:8px;
width:100%;
font-weight:800;
font-size:14px;
}

.adminBtn:active{
background:#5a4f44;
}

.adminTabs{
display:flex;
gap:8px;
margin-bottom:12px;
width:100%;
}

.adminTab{
flex:1;
padding:14px 10px;
border-radius:12px;
border:2px solid #4a3f34;
background:#3a2f24;
color:#f0e6da;
font-weight:800;
font-size:14px;
text-align:center;
position:relative;
}

.adminTab.ativo{
background:var(--accent);
border-color:var(--accent);
color:white;
}

.adminBadge{
position:absolute;
top:-6px;
right:-6px;
background:#e74c3c;
color:white;
font-size:11px;
font-weight:900;
min-width:22px;
height:22px;
border-radius:11px;
display:none;
align-items:center;
justify-content:center;
padding:0 6px;
}

.adminBadge.visivel{
display:flex;
}

.pedidoCard{
background:#4a3f34;
border-radius:12px;
padding:14px;
margin-bottom:10px;
}

.pedidoCard .pedidoNome{
font-weight:900;
font-size:15px;
color:#f0e6da;
}

.pedidoCard .pedidoInfo{
font-size:13px;
color:#c0b0a0;
margin-top:4px;
line-height:1.5;
}

.pedidoCard .pedidoItens{
margin-top:8px;
font-size:13px;
color:#d0c0b0;
}

.pedidoCard .pedidoTotal{
margin-top:8px;
font-weight:900;
color:#4caf50;
font-size:15px;
}

.btnDeliveryCaminho{
background:var(--accent);
color:white;
border:none;
padding:10px 14px;
border-radius:10px;
font-weight:800;
font-size:13px;
margin-top:8px;
width:100%;
}

/* =========================
BOT√ïES FIXOS
========================= */

.btnConfig{
position:fixed;
top:14px;
right:14px;
z-index:9999;
font-size:18px;
background:white;
border:none;
border-radius:12px;
padding:10px 12px;
box-shadow:0 2px 10px rgba(60,30,10,.12);
color:var(--text);
cursor:pointer;
}

.btnReload{
position:fixed;
bottom:16px;
right:16px;
z-index:3000;
background:rgba(255,255,255,0.85);
border:none;
border-radius:50%;
width:42px;
height:42px;
font-size:18px;
box-shadow:0 2px 8px rgba(60,30,10,.15);
cursor:pointer;
transition:all .2s;
}
.btnReload:active{
transform:scale(.9) rotate(180deg);
}

.btnVoltar{
position:fixed;
bottom:16px;
left:16px;
z-index:3000;
background:var(--accent);
color:white;
border:none;
border-radius:12px;
padding:12px 16px;
font-weight:900;
font-size:14px;
box-shadow:0 3px 12px rgba(196,99,42,.3);
}

/* =========================
TOAST
========================= */

.toast{
position:fixed;
bottom:90px;
left:50%;
transform:translateX(-50%) translateY(20px);
background:var(--accent);
color:white;
padding:12px 28px;
border-radius:30px;
font-weight:700;
font-size:14px;
z-index:9999;
opacity:0;
transition:all .3s ease;
pointer-events:none;
box-shadow:0 4px 16px rgba(196,99,42,.35);
white-space:nowrap;
}

.toast.mostrar{
opacity:1;
transform:translateX(-50%) translateY(0);
}

/* =========================
MODAL TAMANHO
========================= */

.modalOverlay{
position:fixed;
inset:0;
background:rgba(60,40,20,.5);
display:flex;
align-items:center;
justify-content:center;
z-index:5000;
animation:fadeIn .2s ease;
backdrop-filter:blur(4px);
}

.modalBox{
background:white;
border-radius:20px;
padding:28px;
width:90%;
max-width:360px;
text-align:center;
box-shadow:0 8px 32px rgba(60,30,10,.2);
animation:slideUp .3s ease;
}

.modalBox h3{
font-size:clamp(18px,4vw,22px);
margin-bottom:20px;
color:var(--text);
}

.modalBtnTam{
width:100%;
padding:16px;
border-radius:14px;
font-size:16px;
font-weight:900;
border:none;
margin-bottom:10px;
}

.modalBtnP{
background:var(--accent2);
color:white;
}

.modalBtnG{
background:var(--accent);
color:white;
}

.modalBtnCancelar{
background:var(--accent-light);
color:var(--accent);
font-size:14px;
padding:12px;
}

.mesasGrid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:12px;
width:100%;
max-width:500px;
}

.mesaBtn{
background:#4a3f34;
border:2px solid #5a4f44;
border-radius:16px;
padding:20px 10px;
text-align:center;
color:#f0e6da;
font-weight:900;
font-size:14px;
display:flex;
flex-direction:column;
align-items:center;
gap:6px;
}

.mesaBtn .mesaIcon{
font-size:28px;
}

.mesaBtn:active{
background:var(--accent);
border-color:var(--accent);
}

.modalPratoFeito{
background:white;
border-radius:20px;
padding:28px;
width:90%;
max-width:400px;
text-align:center;
box-shadow:0 8px 32px rgba(60,30,10,.2);
animation:slideUp .3s ease;
}

.modalPratoFeito h3{
font-size:18px;
margin-bottom:8px;
color:var(--text);
}

.modalPratoFeito .pfDesc{
font-size:13px;
color:var(--text2);
margin-bottom:16px;
}

.pfOption{
display:flex;
align-items:center;
gap:10px;
padding:12px;
background:var(--bg);
border-radius:12px;
margin-bottom:8px;
font-weight:700;
color:var(--text);
font-size:15px;
cursor:pointer;
}

.pfOption input[type="checkbox"]{
width:20px;
height:20px;
accent-color:var(--accent);
}

.pfPrecoExtra{
font-size:13px;
color:var(--accent);
font-weight:900;
margin:12px 0;
}

/* =========================
RESPONSIVE
========================= */

@media(min-width:768px){
.tela{padding:30px 40px;padding-bottom:80px}
.item{padding:18px 22px}
.categoriaHeader{padding:18px 24px;font-size:18px}
}

@media(max-width:380px){
.tela{padding:14px 10px;padding-bottom:70px}
.categoriaHeader{padding:14px 16px;font-size:14px}
.item{padding:12px;gap:8px}
.btnAdd{padding:8px 12px;font-size:12px}
.btnVoltar{bottom:12px;left:12px;padding:10px 12px;font-size:12px}
.btnConfig{top:10px;right:10px;padding:8px 10px;font-size:16px}
}

/* =========================
IMPRESS√ÉO CUPOM T√âRMICO (80mm)
========================= */
@media print {
body, html {
margin:0 !important;
padding:0 !important;
background:#fff !important;
}
.tela, #carrinho, .btnVoltar, .btnAdmin, header, footer, nav {
display:none !important;
}
#cupomImpressao {
display:block !important;
width:72mm;
margin:0 auto;
padding:2mm;
font-family:'Courier New',monospace;
font-size:14px;
color:#000;
background:#fff;
}
.cupomLinha {
text-align:center;
margin:0;
padding:1px 0;
}
.cupomTitulo {
font-size:20px;
font-weight:900;
letter-spacing:1px;
margin-bottom:4px;
}
.cupomSub {
font-size:16px;
font-weight:700;
margin:6px 0 2px;
border-top:1px dashed #000;
border-bottom:1px dashed #000;
padding:4px 0;
}
.cupomItem {
text-align:left;
font-size:14px;
padding:2px 0;
}
.cupomObs {
text-align:left;
font-size:12px;
padding-left:8px;
font-style:italic;
}
.cupomTotal {
font-size:20px;
font-weight:900;
margin-top:6px;
border-top:2px solid #000;
padding-top:6px;
}
.cupomSep {
border-top:1px dashed #000;
margin:4px 0;
}
.cupomModo {
font-size:18px;
font-weight:900;
margin:4px 0;
padding:4px;
border:2px solid #000;
}
.cupomInfo {
font-size:14px;
text-align:left;
padding:2px 0;
}
}

#cupomImpressao {
display:none;
}

</style>
</head>
<body>

<button class="btnConfig" onclick="abrirAdmin()">‚öôÔ∏è</button>
<button class="btnVoltar" onclick="voltarTela()">‚Üê</button>
<button class="btnReload" onclick="location.reload()" title="Atualizar">üîÑ</button>

<!-- =========================
TELA ESCOLHA
========================= -->

<div id="telaEscolha" class="tela ativa">

<img src="logo-recanto.png" class="logoTopo">

<h1 style="margin-bottom:20px">
Fa√ßa seu pedido!
</h1>

<button class="btnEscolha" id="btnDeliveryMain" onclick="tentarDelivery()">
üõµ Delivery
</button>

<div id="deliveryFechado" style="display:none;text-align:center;width:100%;max-width:400px;margin-top:20px">
<div style="background:white;border-radius:16px;padding:24px;box-shadow:0 4px 16px rgba(60,30,10,.15)">
<div style="font-size:40px;margin-bottom:12px">üïê</div>
<p id="msgFechado" style="font-weight:800;color:#3a2a1a;font-size:16px;margin-bottom:16px"></p>
<button class="btnEscolha" onclick="location.href='https://wa.me/5549991610137'" style="background:var(--accent);color:white;font-size:15px;padding:14px;margin-top:0">
üí¨ Fale conosco no WhatsApp
</button>
</div>
</div>

</div>

<!-- =========================
TELA CARD√ÅPIO
========================= -->

<div id="telaCardapio" class="tela">

<div class="topo">
<b>Card√°pio</b>

<button class="adminBtn"
style="max-width:160px;background:#ff5722"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<input type="text" id="buscaCardapio" class="buscaInput" placeholder="Buscar no card√°pio..." oninput="filtrarCardapio()">
<div id="abas" class="abas"></div>
<div id="lista" class="lista"></div>

</div>

<!-- =========================
CARRINHO
========================= -->

<div id="carrinho">

<div style="padding:18px;font-weight:900;font-size:18px;display:flex;justify-content:space-between">
Seu Pedido
<button onclick="toggleCarrinho()" style="background:#ddd;border:none;border-radius:8px;padding:6px 10px">X</button>
</div>

<div id="cLista" class="cLista"></div>

<div style="padding:16px">

<div id="linhaFrete" style="display:none;font-weight:900;color:#c62828;margin-bottom:6px">
üöö Frete: R$ <span id="freteTxt">0.00</span>
</div>

<b style="font-size:18px">
Total: R$ <span id="total">0.00</span>
</b>

</div>

<button class="btnFinalizarCarrinho" onclick="irCheckout()">
FINALIZAR PEDIDO
</button>

</div>
<!-- =========================
TELA CHECKOUT
========================= -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:16px">
Finalizar Pedido
</h2>

<div class="checkoutResumo">

<div style="font-weight:900;margin-bottom:10px">
Resumo do Pedido
</div>

<div id="checkoutItens"></div>

<div style="margin-top:10px;font-weight:900">
Total: R$ <span id="checkoutTotal">0.00</span>
</div>

</div>

<div class="form">

<input type="hidden" id="tipoPedido" value="entrega">

<input id="nome" placeholder="Nome do cliente">
<input id="telefone" placeholder="Telefone">

<div id="boxEndereco">
<input id="rua" placeholder="Rua">
<input id="bairro" placeholder="Bairro">
<input id="numero" placeholder="N√∫mero">
</div>

<select id="pagamento">
<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>
</select>

<div id="boxTroco" style="display:none">
<input id="troco" placeholder="Troco para quanto?">
</div>

<!-- =========================
PIX
========================= -->

<div id="boxPix" class="pixBox" style="display:none">

<div class="pixTitulo">Chave PIX</div>

<div style="font-size:16px;font-weight:900;word-break:break-all">
<span id="pixChaveTxt"></span>
</div>

<button class="btnCopiarPix" onclick="copiarPix()">
COPIAR CHAVE PIX
</button>

<div style="font-weight:900">
Valor: R$ <span id="pixValorTxt">0.00</span>
</div>

<button class="btnComprovante"
onclick="abrirZapComprovante()">
Enviar comprovante no WhatsApp
</button>

<label style="display:flex;gap:6px;align-items:center;justify-content:center;font-size:14px">
<input type="checkbox" id="pixJaEnviei" style="width:auto">
J√° enviei comprovante
</label>

<input type="file"
id="pixArquivo"
accept="image/*,application/pdf">

</div>

<button class="btnEnviarPedido"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>

<!-- =========================
TELA ADMIN
========================= -->

<div id="telaAdmin" class="tela">

<h2>Painel Admin</h2>

<div class="adminBox">
<b>Pedidos ao Vivo</b>

<div class="adminTabs" style="margin-top:12px">
<button class="adminTab ativo" id="tabDelivery" onclick="trocarAbaAdmin('delivery')">
Delivery
<span class="adminBadge" id="badgeDelivery">0</span>
</button>
<button class="adminTab" id="tabLocal" onclick="trocarAbaAdmin('local')">
Local
<span class="adminBadge" id="badgeLocal">0</span>
</button>
</div>

<div id="adminPedidosDelivery"></div>
<div id="adminPedidosLocal" style="display:none"></div>
</div>

<div class="adminBox">
<b>Atendimento no Local</b>
<button class="adminBtn" onclick="abrirMesas()">üçΩÔ∏è Card√°pio (Mesas)</button>
<button class="adminBtn" onclick="abrirPedidosLocal()">üìã Pedidos no Local</button>
</div>

<div class="adminBox">
<b>Relat√≥rios</b>
<button class="adminBtn" onclick="relatorioHoje()">Hoje</button>
<button class="adminBtn" onclick="relatorioMes()">M√™s</button>
<button class="adminBtn" onclick="relatorioAno()">Ano</button>
<button class="adminBtn" onclick="exportarExcel()">Exportar Excel</button>
<button class="adminBtn" onclick="zerarRelatorios()">Zerar Dados</button>
</div>

<div class="adminBox">
<b>Gerenciar Card√°pio</b>
<button class="adminBtn" onclick="adminNovaAba()">Nova Aba</button>
<button class="adminBtn" onclick="abrirNovoProdutoUI()">Adicionar Produto</button>
<button class="adminBtn" onclick="abrirEditorItens()">Editar / Remover Itens</button>
<button class="adminBtn" onclick="abrirRemoverAbaUI()">Remover Aba</button>
</div>

</div>

<!-- =========================
TELA MESAS (ADMIN)
========================= -->

<div id="telaMesas" class="tela" style="background:#2a1f14">

<h2 style="color:#f0e6da;margin-bottom:20px">Selecione a Mesa</h2>

<div class="mesasGrid">
</div>

<button class="btnVoltar" style="position:static;margin-top:16px" onclick="mostrar('telaAdmin')">‚Üê Voltar ao Admin</button>

</div>

<!-- =========================
TELA PEDIDOS LOCAL (ADMIN)
========================= -->

<div id="telaPedidosLocal" class="tela" style="background:#2a1f14">

<h2 style="color:#f0e6da;margin-bottom:20px">Pedidos no Local</h2>

<div id="listaPedidosLocal" style="width:100%;max-width:760px"></div>

<button class="btnVoltar" style="position:static;margin-top:16px" onclick="mostrar('telaAdmin')">‚Üê Voltar ao Admin</button>

</div>

<!-- =========================
TELA NOVO PRODUTO
========================= -->

<div id="uiNovoProduto" class="tela">

<h2 style="margin-bottom:16px">Adicionar Produto</h2>

<div class="form" style="max-width:760px">
<select id="novoProdAba"></select>
<input id="novoProdNome" placeholder="Nome do produto (sem P/G)">
<input id="novoProdDesc" placeholder="Descri√ß√£o (ex: Mussarela, bacon e or√©gano)">
<div style="display:flex;gap:10px">
<input id="novoProdPrecoP" type="number" step="0.01" placeholder="Pre√ßo P (ex: 17.00)" style="flex:1">
<input id="novoProdPrecoG" type="number" step="0.01" placeholder="Pre√ßo G (ex: 22.00)" style="flex:1">
</div>
<p style="font-size:12px;color:#7a6a5a;margin:4px 0">Se n√£o tiver tamanhos, preencha s√≥ o Pre√ßo P como pre√ßo √∫nico</p>
<button class="btnFinalizarCarrinho" onclick="confirmarNovoProduto()">ADICIONAR PRODUTO</button>
<button class="btnVoltar" style="position:static;margin-top:10px" onclick="mostrar('telaAdmin')">&larr; Voltar ao Admin</button>
</div>

</div>

<!-- =========================
TELA EDITOR DE ITENS
========================= -->

<div id="telaEditorItens" class="tela">

<h2 style="margin-bottom:16px">Editar / Remover Itens</h2>

<div id="listaEditor" style="width:100%;max-width:760px"></div>

<button class="btnVoltar" style="position:static;margin-top:16px" onclick="mostrar('telaAdmin')">&larr; Voltar ao Admin</button>

</div>

<!-- =========================
TELA REMOVER ABA
========================= -->

<div id="uiRemoverAba" class="tela">

<h2 style="margin-bottom:16px">Remover Aba</h2>

<div id="listaAbasRemover" style="width:100%;max-width:760px"></div>

<button class="btnVoltar" style="position:static;margin-top:16px" onclick="mostrar('telaAdmin')">&larr; Voltar ao Admin</button>

</div>

<!-- =========================
IN√çCIO SCRIPT
========================= -->

<script type="module">

/* =========================
CONFIGURA√á√ïES
========================= */

const ADMIN_SENHA = "1234"
let WHATSAPP_LOJA = "5549991610137"
let PIX_CHAVE = "pix-recanto@pix"

let modoPedido = null
let categoriaAtual = ""
let valorFrete = 0
let pixComprovanteOK = false
let primeiraCarga = true

let carrinho = []
let mesaSelecionada = null
let pedidosCache = []

function isDeliveryAberto(){
let agora = new Date()
let dia = agora.getDay()
let hora = agora.getHours()
let minuto = agora.getMinutes()
let tempoAtual = hora * 60 + minuto

if(dia === 1 || dia === 2) return {aberto:false, motivo:"Segunda e ter√ßa estamos fechados.\nDelivery de quarta a domingo, das 18:30 √†s 23:00."}

let abertura = 18 * 60 + 30
let fechamento = 23 * 60

if(tempoAtual < abertura || tempoAtual >= fechamento){
return {aberto:false, motivo:"Delivery dispon√≠vel das 18:30 √†s 23:00.\nEntre em contato conosco para fazer seu pedido!"}
}

return {aberto:true}
}

/* =========================
FIREBASE
========================= */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore,
collection,
addDoc,
onSnapshot,
getDocs,
deleteDoc
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig = {
apiKey:"AIzaSyCE6daBipSq0Xjxt3ofW9anxMdN-AecI4w",
authDomain:"recanto-do-pastel-bcea2.firebaseapp.com",
projectId:"recanto-do-pastel-bcea2",
storageBucket:"recanto-do-pastel-bcea2.firebasestorage.app",
messagingSenderId:"304374292790",
appId:"1:304374292790:web:5bd235b7c0419a8dfe1397"
}

const app = initializeApp(firebaseConfig)
const db = getFirestore(app)

/* =========================
UTIL
========================= */

const qs = id => document.getElementById(id)
/* =========================
CONTROLE DE TELAS
========================= */

window.mostrar = function mostrar(id){

document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))

qs(id).classList.add("ativa")

/* sempre fechar carrinho ao trocar tela */
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"

}

/* =========================
RESET TOTAL DO SISTEMA
========================= */

function resetarSistema(){

carrinho = []
valorFrete = 0
pixComprovanteOK = false

/* limpar carrinho visual */
if(qs("cLista")) qs("cLista").innerHTML=""
if(qs("qtd")) qs("qtd").innerText="0"
if(qs("total")) qs("total").innerText="0.00"
if(qs("checkoutItens")) qs("checkoutItens").innerHTML=""
if(qs("checkoutTotal")) qs("checkoutTotal").innerText="0.00"
if(qs("linhaFrete")) qs("linhaFrete").style.display="none"

/* limpar formul√°rios */
if(qs("nome")) qs("nome").value=""
if(qs("telefone")) qs("telefone").value=""
if(qs("rua")) qs("rua").value=""
if(qs("bairro")) qs("bairro").value=""
if(qs("numero")) qs("numero").value=""
if(qs("troco")) qs("troco").value=""

if(qs("pixJaEnviei")) qs("pixJaEnviei").checked=false
if(qs("pixArquivo")) qs("pixArquivo").value=""

if(qs("boxPix")) qs("boxPix").style.display="none"
if(qs("boxTroco")) qs("boxTroco").style.display="none"

modoPedido = null

}

/* =========================
BOT√ïES PRINCIPAIS
========================= */

window.voltarTela = ()=>{
let telaAtual = document.querySelector(".tela.ativa")
let telasAdmin = ["telaMesas","telaPedidosLocal","uiNovoProduto","telaEditorItens","uiRemoverAba"]
/* Se gar√ßom est√° no card√°pio/checkout de mesa, voltar pra mesas */
if(mesaSelecionada && telaAtual && (telaAtual.id === "telaCardapio" || telaAtual.id === "telaCheckout")){
carrinho = []
renderCarrinho()
mesaSelecionada = null
mostrar("telaMesas")
return
}
if(telaAtual && telasAdmin.includes(telaAtual.id)){
mostrar("telaAdmin")
return
}
if(telaAtual && telaAtual.id === "telaAdmin"){
mostrar("telaEscolha")
return
}
resetarSistema()
if(qs("deliveryFechado")) qs("deliveryFechado").style.display = "none"
if(qs("btnDeliveryMain")) qs("btnDeliveryMain").style.display = ""
mesaSelecionada = null
mostrar("telaEscolha")
}

window.abrirAdmin = ()=>{
let s = prompt("Senha admin")
if(s !== ADMIN_SENHA){
alert("Senha incorreta")
return
}
mostrar("telaAdmin")
}

/* =========================
ESCOLHER MODO
========================= */

window.tentarDelivery = ()=>{
let status = isDeliveryAberto()
if(!status.aberto){
qs("deliveryFechado").style.display = "block"
qs("msgFechado").innerText = status.motivo
qs("btnDeliveryMain").style.display = "none"
return
}
resetarSistema()
modoPedido = "delivery"
mostrar("telaCardapio")
renderAbas()
}

window.definirModo = (modo)=>{
resetarSistema()
modoPedido = modo
mostrar("telaCardapio")
renderAbas()
}

/* =========================
CARD√ÅPIO COMPLETO
========================= */

let cardapio = {

"Past√©is Salgados P":[
{nome:"Aipim c/ Bacon P",preco:17,desc:"Mussarela, aipim, bacon e or√©gano",num:1},
{nome:"Bacon P",preco:17,desc:"Mussarela, bacon e or√©gano",num:2},
{nome:"Br√≥colis P",preco:17,desc:"Mussarela, br√≥colis e or√©gano",num:3},
{nome:"Calabresa P",preco:17,desc:"Mussarela, calabresa e or√©gano",num:4},
{nome:"Camar√£o P",preco:20,desc:"Mussarela, camar√£o e or√©gano",num:5},
{nome:"Carne P",preco:17,desc:"Mussarela, carne, azeitonas, palmito, ovo e catupiry",num:6},
{nome:"Carne c/ Ovos P",preco:17,desc:"Mussarela, carne e ovos",num:7},
{nome:"Cora√ß√£o de Frango P",preco:18,desc:"Mussarela, cora√ß√£o de frango, catupiry e or√©gano",num:8},
{nome:"Crocante P",preco:17,desc:"Mussarela, batata palha e catupiry",num:9},
{nome:"Frango c/ Catupiry P",preco:17,desc:"Mussarela, frango, catupiry e or√©gano",num:10},
{nome:"Lombinho P",preco:17,desc:"Mussarela, lombinho e or√©gano",num:11},
{nome:"Milho P",preco:17,desc:"Mussarela, milho e or√©gano",num:12},
{nome:"Napolitana P",preco:17,desc:"Mussarela, tomate e or√©gano",num:13},
{nome:"Ovo P",preco:17,desc:"Mussarela, ovo e or√©gano",num:14},
{nome:"Palmito P",preco:17,desc:"Mussarela, palmito e or√©gano",num:15},
{nome:"Paulista P",preco:17,desc:"Mussarela, palmito, or√©gano, milho e ervilha",num:16},
{nome:"Portuguesa P",preco:17,desc:"Mussarela, presunto, cebola, ovo, azeitona e or√©gano",num:17},
{nome:"Quatro Queijos P",preco:17,desc:"Mussarela, parmes√£o, cheddar, catupiry e or√©gano",num:18},
{nome:"Romana P",preco:17,desc:"Mussarela, presunto, ovo e or√©gano",num:19},
{nome:"Pizza P",preco:17,desc:"Mussarela, presunto, or√©gano e tomate",num:20},
{nome:"Hot Dog P",preco:17,desc:"Mussarela, salsicha, milho, ervilha e batata palha",num:21},
{nome:"Do Chef P",preco:17,desc:"Mussarela, frango, bacon, tomate e or√©gano",num:22},
{nome:"Vegetariana P",preco:17,desc:"Mussarela, br√≥colis, tomate, cenoura, palmito e or√©gano",num:23},
{nome:"Strogonoff P",preco:17,desc:"Mussarela, frango ao molho e or√©gano",num:24},
{nome:"Especial (5 Sabores) P",preco:18,desc:"Escolha 5 sabores entre os ingredientes dispon√≠veis",num:25}
],

"Past√©is Salgados G":[
{nome:"Aipim c/ Bacon G",preco:22,desc:"Mussarela, aipim, bacon e or√©gano",num:1},
{nome:"Bacon G",preco:22,desc:"Mussarela, bacon e or√©gano",num:2},
{nome:"Br√≥colis G",preco:22,desc:"Mussarela, br√≥colis e or√©gano",num:3},
{nome:"Calabresa G",preco:22,desc:"Mussarela, calabresa e or√©gano",num:4},
{nome:"Camar√£o G",preco:29,desc:"Mussarela, camar√£o e or√©gano",num:5},
{nome:"Carne G",preco:22,desc:"Mussarela, carne, azeitonas, palmito, ovo e catupiry",num:6},
{nome:"Carne c/ Ovos G",preco:22,desc:"Mussarela, carne e ovos",num:7},
{nome:"Cora√ß√£o de Frango G",preco:22,desc:"Mussarela, cora√ß√£o de frango, catupiry e or√©gano",num:8},
{nome:"Crocante G",preco:22,desc:"Mussarela, batata palha e catupiry",num:9},
{nome:"Frango c/ Catupiry G",preco:22,desc:"Mussarela, frango, catupiry e or√©gano",num:10},
{nome:"Lombinho G",preco:22,desc:"Mussarela, lombinho e or√©gano",num:11},
{nome:"Milho G",preco:22,desc:"Mussarela, milho e or√©gano",num:12},
{nome:"Napolitana G",preco:22,desc:"Mussarela, tomate e or√©gano",num:13},
{nome:"Ovo G",preco:22,desc:"Mussarela, ovo e or√©gano",num:14},
{nome:"Palmito G",preco:22,desc:"Mussarela, palmito e or√©gano",num:15},
{nome:"Paulista G",preco:22,desc:"Mussarela, palmito, or√©gano, milho e ervilha",num:16},
{nome:"Portuguesa G",preco:22,desc:"Mussarela, presunto, cebola, ovo, azeitona e or√©gano",num:17},
{nome:"Quatro Queijos G",preco:22,desc:"Mussarela, parmes√£o, cheddar, catupiry e or√©gano",num:18},
{nome:"Romana G",preco:22,desc:"Mussarela, presunto, ovo e or√©gano",num:19},
{nome:"Pizza G",preco:22,desc:"Mussarela, presunto, or√©gano e tomate",num:20},
{nome:"Hot Dog G",preco:22,desc:"Mussarela, salsicha, milho, ervilha e batata palha",num:21},
{nome:"Do Chef G",preco:22,desc:"Mussarela, frango, bacon, tomate e or√©gano",num:22},
{nome:"Vegetariana G",preco:22,desc:"Mussarela, br√≥colis, tomate, cenoura, palmito e or√©gano",num:23},
{nome:"Strogonoff G",preco:22,desc:"Mussarela, frango ao molho e or√©gano",num:24},
{nome:"Especial (5 Sabores) G",preco:24,desc:"Escolha 5 sabores entre os ingredientes dispon√≠veis",num:25}
],

"Past√©is Doces P":[
{nome:"Banana P",preco:17,desc:"Mussarela, banana e canela",num:1},
{nome:"Chocolate Preto P",preco:17,desc:"Mussarela e chocolate preto",num:2},
{nome:"Chocolate Branco P",preco:17,desc:"Mussarela e chocolate branco",num:3},
{nome:"Krot P",preco:17,desc:"Chocolate preto, amendoim e leite condensado",num:4},
{nome:"Morango P",preco:17,desc:"Mussarela, morango e leite condensado",num:5},
{nome:"Prest√≠gio P",preco:17,desc:"Mussarela, chocolate preto e coco",num:6},
{nome:"Romeu e Julieta P",preco:17,desc:"Mussarela e goiabada",num:7},
{nome:"Sedu√ß√£o P",preco:17,desc:"Chocolate branco, morango e leite condensado",num:8},
{nome:"Sonho de Valsa P",preco:17,desc:"Mussarela, sonho de valsa e leite condensado",num:9},
{nome:"Mocinha P",preco:17,desc:"Mussarela, doce de leite e coco ralado",num:10},
{nome:"Charge P",preco:17,desc:"Mussarela, doce de leite e amendoim",num:11},
{nome:"Bob Marley P",preco:17,desc:"Mussarela, brigadeiro e confetes",num:12},
{nome:"Choquito P",preco:17,desc:"Mussarela, chocolate preto e branco e flocos de arroz",num:13},
{nome:"Dois Amores P",preco:17,desc:"Mussarela, chocolate preto e branco",num:14},
{nome:"Ouro Branco P",preco:17,desc:"Queijo e ouro branco",num:15}
],

"Past√©is Doces G":[
{nome:"Banana G",preco:22,desc:"Mussarela, banana e canela",num:1},
{nome:"Chocolate Preto G",preco:22,desc:"Mussarela e chocolate preto",num:2},
{nome:"Chocolate Branco G",preco:22,desc:"Mussarela e chocolate branco",num:3},
{nome:"Krot G",preco:22,desc:"Chocolate preto, amendoim e leite condensado",num:4},
{nome:"Morango G",preco:22,desc:"Mussarela, morango e leite condensado",num:5},
{nome:"Prest√≠gio G",preco:22,desc:"Mussarela, chocolate preto e coco",num:6},
{nome:"Romeu e Julieta G",preco:22,desc:"Mussarela e goiabada",num:7},
{nome:"Sedu√ß√£o G",preco:22,desc:"Chocolate branco, morango e leite condensado",num:8},
{nome:"Sonho de Valsa G",preco:22,desc:"Mussarela, sonho de valsa e leite condensado",num:9},
{nome:"Mocinha G",preco:22,desc:"Mussarela, doce de leite e coco ralado",num:10},
{nome:"Charge G",preco:22,desc:"Mussarela, doce de leite e amendoim",num:11},
{nome:"Bob Marley G",preco:22,desc:"Mussarela, brigadeiro e confetes",num:12},
{nome:"Choquito G",preco:22,desc:"Mussarela, chocolate preto e branco e flocos de arroz",num:13},
{nome:"Dois Amores G",preco:22,desc:"Mussarela, chocolate preto e branco",num:14},
{nome:"Ouro Branco G",preco:22,desc:"Queijo e ouro branco",num:15}
],

"Lanches":[
{nome:"X-Burguer",preco:16,desc:"P√£o, hamb√∫rguer, presunto e queijo"},
{nome:"X-Salada",preco:22,desc:"P√£o, hamb√∫rguer, presunto, queijo, alface, tomate, milho, ervilha e maionese"},
{nome:"X-Bacon",preco:28,desc:"P√£o, hamb√∫rguer, presunto, queijo, alface, tomate, milho, ervilha, maionese e bacon"},
{nome:"X-Calabresa",preco:28,desc:"P√£o, hamb√∫rguer, calabresa, presunto, queijo, alface, tomate, milho, ervilha e maionese"},
{nome:"X-Egg",preco:28,desc:"P√£o, hamb√∫rguer, ovo, presunto, queijo, alface, tomate, milho, ervilha e maionese"},
{nome:"X-Dog",preco:28,desc:"P√£o, hamb√∫rguer, salsicha, presunto, queijo, alface, tomate, milho, ervilha e maionese"},
{nome:"X-Tudo",preco:38,desc:"P√£o, hamb√∫rguer, bacon, calabresa, salsicha, ovo, presunto, queijo, alface, tomate, milho, ervilha e maionese"}
],

"Por√ß√µes Inteira":[
{nome:"Anel de Cebola",preco:28,desc:"Por√ß√£o inteira de an√©is de cebola empanados"},
{nome:"Polenta",preco:26,desc:"Por√ß√£o inteira de polenta frita"},
{nome:"Aipim",preco:26,desc:"Por√ß√£o inteira de aipim frito"},
{nome:"Fritas",preco:26,desc:"Por√ß√£o inteira de batata frita"},
{nome:"Til√°pia",preco:50,desc:"Por√ß√£o inteira de til√°pia frita"},
{nome:"Bolinho de Bacalhau",preco:42,desc:"Por√ß√£o inteira de bolinho de bacalhau"},
{nome:"Camar√£o",preco:70,desc:"Por√ß√£o inteira de camar√£o"}
],

"Por√ß√µes Meia":[
{nome:"Anel de Cebola (Meia)",preco:17,desc:"Meia por√ß√£o de an√©is de cebola empanados"},
{nome:"Polenta (Meia)",preco:16,desc:"Meia por√ß√£o de polenta frita"},
{nome:"Aipim (Meia)",preco:16,desc:"Meia por√ß√£o de aipim frito"},
{nome:"Fritas (Meia)",preco:16,desc:"Meia por√ß√£o de batata frita"},
{nome:"Til√°pia (Meia)",preco:25,desc:"Meia por√ß√£o de til√°pia frita"},
{nome:"Bolinho de Bacalhau (Meia)",preco:24,desc:"Meia por√ß√£o de bolinho de bacalhau"}
],

"Prato Feito":[
{nome:"Prato Feito",preco:30,desc:"Arroz, salada, fritas e ovo. Escolha: frango, bife ou peixe (adicional +R$8,00 cada prote√≠na extra). Somente de quarta a sexta ao meio dia",pratoFeito:true},
{nome:"Prato Feito (Meia)",preco:25,desc:"Meia por√ß√£o. Arroz, salada, fritas e ovo. Escolha: frango, bife ou peixe (adicional +R$8,00 cada prote√≠na extra). Somente de quarta a sexta ao meio dia",pratoFeito:true}
],

"Bebidas":[
{nome:"Brahma",preco:12,desc:"Cerveja Brahma"},
{nome:"Original",preco:15,desc:"Cerveja Original"},
{nome:"Kaiser",preco:9,desc:"Cerveja Kaiser"},
{nome:"Heineken",preco:16,desc:"Cerveja Heineken"},
{nome:"√Ågua Mineral",preco:4,desc:"√Ågua mineral com ou sem g√°s"},
{nome:"Vinho Ta√ßa",preco:10,desc:"Ta√ßa de vinho tinto, suave ou seco"}
],

"Refrigerantes":[
{nome:"KS",preco:5,desc:"Refrigerante KS"},
{nome:"Lata",preco:6,desc:"Refrigerante lata"},
{nome:"600ml",preco:9,desc:"Refrigerante 600ml"},
{nome:"1 Litro",preco:11,desc:"Refrigerante 1 litro"}
],

"Sucos":[
{nome:"Abacaxi",preco:9,desc:"Suco natural de abacaxi"},
{nome:"Abacaxi c/ Hortel√£",preco:9,desc:"Suco natural de abacaxi com hortel√£"},
{nome:"Manga",preco:9,desc:"Suco natural de manga"},
{nome:"Morango",preco:9,desc:"Suco natural de morango"},
{nome:"Uva",preco:9,desc:"Suco natural de uva"},
{nome:"Lim√£o",preco:9,desc:"Suco natural de lim√£o"},
{nome:"Maracuj√°",preco:9,desc:"Suco natural de maracuj√°"}
],

"Doses":[
{nome:"Campari",preco:8,desc:"Dose de Campari"},
{nome:"Jack Daniels",preco:15,desc:"Dose de Jack Daniels"}
],

"Caipiras":[
{nome:"Vinho",preco:22,desc:"Caipira de vinho"},
{nome:"Bacardi",preco:22,desc:"Caipira de Bacardi"},
{nome:"Raiska",preco:22,desc:"Caipira de Raiska"},
{nome:"Steinhaeger",preco:22,desc:"Caipira de Steinhaeger"}
],

"Batidas":[
{nome:"Batida",preco:14,desc:"Batida de frutas"}
],

"Vitaminas":[
{nome:"Vitamina",preco:12,desc:"Vitamina de frutas"}
]

}
/* =========================
BLOQUEIO DE ABAS NO DELIVERY
========================= */

function abaPermitida(aba){

if(modoPedido !== "delivery") return true

let nome = aba.toLowerCase()

if(
nome.includes("sucos") ||
nome.includes("doses") ||
nome.includes("caip") ||
nome.includes("batida") ||
nome.includes("vitamina")
){
return false
}

return true

}

/* =========================
RENDER ABAS
========================= */

function renderAbas(){

qs("abas").innerHTML=""
qs("lista").innerHTML=""

let categoriasAgrupadas = agruparCategorias()

Object.keys(categoriasAgrupadas).forEach((nomeGrupo)=>{

let grupo = categoriasAgrupadas[nomeGrupo]

let header = document.createElement("button")
header.className = "categoriaHeader"
header.innerText = nomeGrupo

let container = document.createElement("div")
container.className = "categoriaItens"

renderItensAcordeon(grupo, container)

header.onclick = ()=>{
let aberta = header.classList.toggle("aberta")
container.classList.toggle("visivel")

if(!aberta) return

document.querySelectorAll(".categoriaHeader").forEach(h=>{
if(h !== header){
h.classList.remove("aberta")
}
})
document.querySelectorAll(".categoriaItens").forEach(c=>{
if(c !== container){
c.classList.remove("visivel")
}
})
}

qs("lista").appendChild(header)
qs("lista").appendChild(container)

})

}

const ORDEM_ABAS = [
"Past√©is Salgados","Past√©is Doces","Lanches","Por√ß√µes Inteira","Por√ß√µes Meia",
"Prato Feito","Bebidas","Refrigerantes","Sucos","Doses","Caipiras","Batidas","Vitaminas"
]

function agruparCategorias(){

let grupos = {}

let abasP = {}
let abasG = {}

Object.keys(cardapio).forEach(aba=>{
if(aba.endsWith(" P")) abasP[aba.replace(" P","")] = aba
if(aba.endsWith(" G")) abasG[aba.replace(" G","")] = aba
})

let processados = new Set()

Object.keys(cardapio).forEach(aba=>{

if(!abaPermitida(aba)) return
if(processados.has(aba)) return

let nomeBase = aba.replace(" P","").replace(" G","")

if(aba.endsWith(" P") && abasG[nomeBase]){
let nomeGrupo = nomeBase
if(!grupos[nomeGrupo]) grupos[nomeGrupo] = {}

let listaP = cardapio[aba]
let listaG = cardapio[abasG[nomeBase]]

listaP.forEach(item=>{
let base = item.nome.replace(" P","")
if(!grupos[nomeGrupo][base]) grupos[nomeGrupo][base] = {}
grupos[nomeGrupo][base]["P"] = item.preco
grupos[nomeGrupo][base]["desc"] = item.desc || ""
if(item.num) grupos[nomeGrupo][base]["num"] = item.num
if(nomeGrupo.startsWith("Past√©is")) grupos[nomeGrupo][base]["_isPastel"] = true
})

listaG.forEach(item=>{
let base = item.nome.replace(" G","")
if(!grupos[nomeGrupo][base]) grupos[nomeGrupo][base] = {}
grupos[nomeGrupo][base]["G"] = item.preco
if(!grupos[nomeGrupo][base]["desc"]) grupos[nomeGrupo][base]["desc"] = item.desc || ""
if(nomeGrupo.startsWith("Past√©is")) grupos[nomeGrupo][base]["_isPastel"] = true
})

processados.add(aba)
processados.add(abasG[nomeBase])

} else if(aba.endsWith(" G") && abasP[nomeBase]){
return
} else {
if(!grupos[aba]) grupos[aba] = {}

cardapio[aba].forEach(item=>{
if(!grupos[aba][item.nome]) grupos[aba][item.nome] = {}
grupos[aba][item.nome]["√önico"] = item.preco
grupos[aba][item.nome]["desc"] = item.desc || ""
grupos[aba][item.nome]["pratoFeito"] = item.pratoFeito || false
})

processados.add(aba)
}

})

return grupos
}

function renderItensAcordeon(grupo, container){

container.innerHTML = ""

Object.keys(grupo).forEach(nomeBase=>{

let tamanhos = grupo[nomeBase]

let el = document.createElement("div")
el.className = "item"

let infoDiv = document.createElement("div")
infoDiv.className = "itemInfo"

let nomeEl = document.createElement("div")
nomeEl.className = "itemNome"
if(tamanhos.num){
let numSpan = document.createElement("span")
numSpan.className = "itemNum"
numSpan.textContent = tamanhos.num + ". "
nomeEl.appendChild(numSpan)
}
nomeEl.appendChild(document.createTextNode(nomeBase))
infoDiv.appendChild(nomeEl)

if(tamanhos.desc){
let descEl = document.createElement("div")
descEl.className = "itemDesc"
descEl.textContent = tamanhos.desc
infoDiv.appendChild(descEl)
}

let precosDiv = document.createElement("div")
precosDiv.className = "itemPrecos"

Object.keys(tamanhos).filter(t=> t!=="desc" && t!=="pratoFeito" && t!=="num" && t!=="_isPastel" && t!=="_categoria").forEach(t=>{
let span = document.createElement("span")
span.className = "itemPreco"
span.textContent = (t === "√önico" ? "" : t + " ") + "R$ " + tamanhos[t].toFixed(2)
precosDiv.appendChild(span)
})

infoDiv.appendChild(precosDiv)
el.appendChild(infoDiv)

let btn = document.createElement("button")
btn.className = "btnAdd"
btn.textContent = "Adicionar"

btn.onclick = ()=>{
categoriaAtual = tamanhos._categoria || ""
if(tamanhos.pratoFeito){
mostrarModalPratoFeito(nomeBase, tamanhos["√önico"] || tamanhos[Object.keys(tamanhos).filter(t=>t!=="desc"&&t!=="pratoFeito")[0]])
return
}
if(tamanhos["P"] && tamanhos["G"]){
mostrarModalTamanho(nomeBase, tamanhos)
} else if(Object.keys(tamanhos).length > 1 && tamanhos["√önico"] === undefined){
let keys = Object.keys(tamanhos)
let preco = tamanhos[keys[0]]
pedirObservacao(nomeBase, preco)
} else {
let preco = tamanhos["√önico"] || tamanhos["P"] || tamanhos["G"] || tamanhos["Meia"] || tamanhos[Object.keys(tamanhos)[0]]
pedirObservacao(nomeBase, preco)
}
}

el.appendChild(btn)
container.appendChild(el)

})

}

/* =========================
ORGANIZAR TAMANHOS (P / G / √öNICO)
========================= */

function organizarTamanhos(lista){

let agrupado = {}

lista.forEach(item=>{

let base = item.nome
.replace(" P","")
.replace(" G","")

if(!agrupado[base]){
agrupado[base] = {}
}

if(item.nome.includes(" P")){
agrupado[base]["P"] = item.preco
}
else if(item.nome.includes(" G")){
agrupado[base]["G"] = item.preco
}
else{
agrupado[base]["√önico"] = item.preco
}

})

return agrupado

}

/* =========================
FUN√á√ÉO ADICIONAR CARRINHO
========================= */

function addCarrinho(produto){

if(categoriaAtual) produto.categoria = categoriaAtual

let existe = carrinho.find(
i => i.nome === produto.nome && i.obs === (produto.obs || "")
)

if(existe){
existe.qtd++
}else{
carrinho.push({
nome: produto.nome,
preco: produto.preco,
qtd: 1,
obs: produto.obs || ""
})
}

qs("carrinho").classList.add("aberto")
document.body.style.overflow="hidden"

renderCarrinho()

mostrarToast(produto.nome + " adicionado!")

}

/* =========================
TOTAL ITENS
========================= */

function totalItens(){
return carrinho.reduce((s,i)=> s + (i.preco * i.qtd), 0)
}

/* =========================
TOTAL GERAL
========================= */

function totalGeral(){
return totalItens() + valorFrete
}

/* =========================
REMOVER ITEM
========================= */

window.removerItem = (nome)=>{

carrinho = carrinho.filter(i=> i.nome !== nome)

renderCarrinho()

if(!carrinho.length){
fecharCarrinho()
}

}

/* =========================
ABRIR / FECHAR CARRINHO
========================= */

window.toggleCarrinho = ()=>{

let aberto = qs("carrinho").classList.toggle("aberto")

document.body.style.overflow = aberto ? "hidden" : "auto"

}

/* =========================
FECHAR CARRINHO FOR√áADO
========================= */

function fecharCarrinho(){
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"
}

/* =========================
FRETE AUTOM√ÅTICO
========================= */

function calcularFreteAutomatico(){

if(modoPedido !== "delivery"){
valorFrete = 0
return
}

let bairro = qs("bairro")?.value || ""
bairro = bairro.toLowerCase()

if(
bairro.includes("igaras") ||
bairro.includes("igarinha")
){
valorFrete = 10
}else{
valorFrete = 8
}

}

/* Atualiza frete ao digitar */

setTimeout(()=>{

if(qs("bairro")){

qs("bairro").addEventListener("input",()=>{

calcularFreteAutomatico()
renderCarrinho()
renderCheckoutResumo()

})

}

},500)

/* =========================
RENDER CARRINHO
========================= */

function renderCarrinho(){

qs("cLista").innerHTML=""

let qtdTotal = 0

carrinho.forEach((i, idx)=>{

qtdTotal += i.qtd

let div = document.createElement("div")
div.className="cItem"

let obsHtml = i.obs ? `<div class="obsItem">Obs: ${i.obs}</div>` : ""

div.innerHTML = `
<div style="width:100%">
<b style="font-size:17px">
${i.nome}
</b>
${obsHtml}
<br>
<span style="color:#ff5722;font-weight:700">
R$ ${(i.qtd * i.preco).toFixed(2)}
</span>
</div>

<div class="qtdControle">
<button class="btnQtd btnQtdMenos" onclick="alterarQtd(${idx}, -1)">-</button>
<span class="qtdNum">${i.qtd}</span>
<button class="btnQtd btnQtdMais" onclick="alterarQtd(${idx}, 1)">+</button>
</div>
`

qs("cLista").appendChild(div)

})

if(carrinho.length > 0 && (modoPedido === "delivery" || modoPedido === "local" || mesaSelecionada)){
let btnMais = document.createElement("button")
btnMais.className = "btnMaisItens"
btnMais.innerHTML = "+ Adicionar mais itens"
btnMais.onclick = ()=>{ fecharCarrinho() }
qs("cLista").appendChild(btnMais)
}

qs("qtd").innerText = qtdTotal
qs("total").innerText = totalGeral().toFixed(2)

if(valorFrete > 0){

qs("linhaFrete").style.display="block"
qs("freteTxt").innerText = valorFrete.toFixed(2)

}else{

qs("linhaFrete").style.display="none"

}

renderCheckoutResumo()

}

/* =========================
RESUMO CHECKOUT
========================= */

function renderCheckoutResumo(){

if(!qs("checkoutItens")) return

qs("checkoutItens").innerHTML=""

carrinho.forEach(i=>{

let d = document.createElement("div")
d.style.marginBottom="6px"
d.style.textAlign="center"

let obsCheckout = i.obs ? `<div class="obsItem">Obs: ${i.obs}</div>` : ""

d.innerHTML = `
<span style="font-weight:600">
${i.qtd}x ${i.nome}
</span>
${obsCheckout}
 ‚Äî
<span style="color:#ff5722;font-weight:700">
R$ ${(i.qtd * i.preco).toFixed(2)}
</span>
`

qs("checkoutItens").appendChild(d)

})

if(valorFrete > 0){

let freteDiv = document.createElement("div")
freteDiv.style.marginTop="8px"
freteDiv.style.fontWeight="700"
freteDiv.style.color="#c62828"

freteDiv.innerText =
`Taxa de entrega: R$ ${valorFrete.toFixed(2)}`

qs("checkoutItens").appendChild(freteDiv)

}

if(qs("checkoutTotal")){
qs("checkoutTotal").innerText =
totalGeral().toFixed(2)
}

}
/* =========================
IR PARA CHECKOUT
========================= */

window.irCheckout = ()=>{

if(mesaSelecionada){
finalizarPedidoLocal()
return
}

if(!carrinho.length) return

fecharCarrinho()

mostrar("telaCheckout")

if(qs("boxEndereco")) qs("boxEndereco").style.display="block"

renderCheckoutResumo()

atualizarPix()

if(qs("pagamento")){
qs("pagamento").dispatchEvent(new Event("change"))
}

}

/* =========================
TIPO PEDIDO (LOCAL / ENTREGA)
========================= */

if(qs("tipoPedido") && qs("tipoPedido").tagName === "SELECT"){

qs("tipoPedido").onchange = e=>{

let tipo = e.target.value

if(tipo === "entrega"){

modoPedido = "delivery"

qs("boxEndereco").style.display="block"

}else{

modoPedido = "local"

qs("boxEndereco").style.display="none"

valorFrete = 0

}

calcularFreteAutomatico()
renderCarrinho()
renderCheckoutResumo()

}

}

/* =========================
PAGAMENTO
========================= */

if(qs("pagamento")){

qs("pagamento").onchange = e=>{

let p = e.target.value

if(qs("boxPix")){
qs("boxPix").style.display = (p === "PIX") ? "block" : "none"
}

if(qs("boxTroco")){
qs("boxTroco").style.display = (p === "Dinheiro") ? "block" : "none"
}

pixComprovanteOK = false

if(qs("pixJaEnviei")){
qs("pixJaEnviei").checked = false
}

renderCheckoutResumo()

}

}

/* =========================
ATUALIZAR PIX
========================= */

function atualizarPix(){

if(qs("pixValorTxt")){
qs("pixValorTxt").innerText = totalGeral().toFixed(2)
}

if(qs("pixChaveTxt")){
qs("pixChaveTxt").innerText = PIX_CHAVE
}

}

/* =========================
COPIAR PIX
========================= */

window.copiarPix = ()=>{

navigator.clipboard.writeText(PIX_CHAVE)
.then(()=>{
alert("Chave PIX copiada com sucesso ‚úÖ")
})
.catch(()=>{
alert("N√£o foi poss√≠vel copiar automaticamente.")
})

}

/* =========================
CONFIRMA√á√ÉO COMPROVANTE
========================= */

if(qs("pixArquivo")){

qs("pixArquivo").onchange = ()=>{
if(qs("pixArquivo").files.length > 0){
pixComprovanteOK = true
}
}

}

if(qs("pixJaEnviei")){

qs("pixJaEnviei").onchange = e=>{
pixComprovanteOK = e.target.checked
}

}

/* =========================
WHATSAPP COMPROVANTE
========================= */

window.abrirZapComprovante = ()=>{

let valor = totalGeral().toFixed(2)

let texto =
`Comprovante PIX - Recanto do Pastel\nValor: R$ ${valor}`

location.href = `https://wa.me/${WHATSAPP_LOJA}?text=${encodeURIComponent(texto)}`

pixComprovanteOK = true

}

/* =========================
MONTAR MENSAGEM WHATSAPP
========================= */

function montarMensagemWhatsApp(pedido){

let msg = `ü•ü *RECANTO DO PASTEL*\n\n`

msg += `üë§ Cliente: ${pedido.cliente.nome}\n`
msg += `üì± Telefone: ${pedido.cliente.tel}\n`
msg += `üì¶ Tipo: ${pedido.modo === "delivery" ? "Delivery" : "Local"}\n`
msg += `üí≥ Pagamento: ${pedido.pagamento || "PIX"}\n`
if(pedido.troco) msg += `üíµ Troco para: R$ ${pedido.troco}\n`

if(pedido.modo === "delivery" && pedido.endereco){
let e = pedido.endereco
if(e.rua) msg += `üìç Endere√ßo: ${e.rua}, ${e.numero || ""} - ${e.bairro || ""}\n`
} else {
if(pedido.cliente.mesa) msg += `üçΩÔ∏è Mesa: ${pedido.cliente.mesa}\n`
}

msg += `\nüßæ *Itens:*\n`

pedido.itens.forEach(i=>{
msg += `‚Ä¢ ${i.qtd}x ${i.nome} - R$ ${(i.qtd * i.preco).toFixed(2)}\n`
if(i.obs) msg += `  üìù Obs: ${i.obs}\n`
})

if(pedido.frete > 0){
msg += `\nüöö Frete: R$ ${pedido.frete.toFixed(2)}`
}

msg += `\n\nüí∞ *TOTAL: R$ ${pedido.total.toFixed(2)}*`

return msg

}

/* =========================
FINALIZAR PEDIDO
========================= */

let bloqueioFinalizacao = false

window.finalizarPedido = async()=>{

if(bloqueioFinalizacao) return
bloqueioFinalizacao = true

if(!modoPedido) modoPedido = "delivery"

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){

alert("Preencha nome e telefone")
bloqueioFinalizacao = false
return

}

if(tipo === "entrega" && pag === "PIX" && !pixComprovanteOK){

alert("Envie o comprovante PIX para finalizar")
bloqueioFinalizacao = false
return

}

/* Montar pedido */

let mesa = qs("mesaInput")?.value || ""
let rua = qs("rua")?.value || ""
let bairro = qs("bairro")?.value || ""
let numEnd = qs("numero")?.value || ""

let pedido = {
cliente:{nome,tel,mesa},
endereco:{rua,bairro,numero:numEnd},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
pagamento:pag,
troco: (pag === "Dinheiro") ? (qs("troco")?.value || "") : "",
data:new Date().toISOString(),
visto:false
}

/* Salvar no Firebase */

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log("Erro ao salvar:",e)
}

/* Enviar WhatsApp */
let mensagem = montarMensagemWhatsApp(pedido)

location.href = `https://wa.me/${WHATSAPP_LOJA}?text=${encodeURIComponent(mensagem)}`

/* Reset total */

resetarSistema()

mostrar("telaEscolha")

setTimeout(()=>{
bloqueioFinalizacao = false
},2000)

}
/* =========================
MESAS (ADMIN)
========================= */

window.abrirMesas = ()=>{
mostrar("telaMesas")
let grid = document.querySelector(".mesasGrid")
if(!grid) return
grid.innerHTML = ""
for(let i = 1; i <= 18; i++){
let btn = document.createElement("button")
btn.className = "mesaBtn"
btn.innerHTML = `<span class="mesaIcon">üçΩÔ∏è</span>Mesa ${i}`
btn.onclick = ()=>{
mesaSelecionada = i
modoPedido = "local"
carrinho = []
renderCarrinho()
mostrar("telaCardapio")
renderAbas()
}
grid.appendChild(btn)
}
}

/* =========================
IR CHECKOUT (OVERRIDE)
========================= */

let _irCheckoutOriginal = null

/* =========================
FINALIZAR PEDIDO LOCAL (GAR√áOM)
========================= */

window.finalizarPedidoLocal = async()=>{
if(!carrinho.length){
alert("Carrinho vazio")
return
}

let pedido = {
cliente:{nome:"Mesa " + mesaSelecionada, tel:"", mesa:String(mesaSelecionada)},
itens:carrinho,
total:totalGeral(),
frete:0,
modo:"local",
pagamento:"",
data:new Date().toISOString(),
visto:false
}

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log("Erro ao salvar:",e)
}

alert("Pedido da Mesa " + mesaSelecionada + " enviado!\n\nüñ®Ô∏è O pedido ser√° impresso automaticamente na impressora da loja.")
carrinho = []
renderCarrinho()
mesaSelecionada = null
mostrar("telaAdmin")
}

/* =========================
PEDIDOS NO LOCAL (ADMIN)
========================= */

window.abrirPedidosLocal = ()=>{
mostrar("telaPedidosLocal")
renderPedidosLocal()
}

function renderPedidosLocal(){
let box = document.getElementById("listaPedidosLocal")
if(!box) return
box.innerHTML = ""

let locais = pedidosCache.filter(p => p.modo === "local")
if(!locais.length){
box.innerHTML = "<div style='color:#7a6a5a;text-align:center;padding:20px'>Nenhum pedido local</div>"
return
}

locais.forEach(p=>{
let itensHtml = ""
;(p.itens || []).forEach(i=>{
itensHtml += `‚Ä¢ ${i.qtd}x ${escHtml(i.nome)} - R$ ${(i.qtd * i.preco).toFixed(2)}<br>`
if(i.obs) itensHtml += `&nbsp;&nbsp;üìù ${escHtml(i.obs)}<br>`
})

box.innerHTML += `<div class="pedidoCard">
<div class="pedidoNome">üçΩÔ∏è ${escHtml(p.cliente?.nome || "Mesa")}</div>
<div class="pedidoInfo">üïê ${escHtml(new Date(p.data).toLocaleString())}</div>
<div class="pedidoItens">${itensHtml}</div>
<div class="pedidoTotal">üí∞ R$ ${Number(p.total).toFixed(2)}</div>
</div>`
})
}

/* =========================
PRATO FEITO MODAL
========================= */

function mostrarModalPratoFeito(nomeItem, precoBase){
let overlay = document.createElement("div")
overlay.className = "modalOverlay"
overlay.onclick = e=>{ if(e.target === overlay) overlay.remove() }

overlay.innerHTML = `<div class="modalPratoFeito">
<h3>üçΩÔ∏è ${nomeItem}</h3>
<div class="pfDesc">Arroz, salada, fritas e ovo.<br>Escolha a prote√≠na (adicional de +R$8 por prote√≠na extra):</div>

<label class="pfOption"><input type="checkbox" value="Frango" class="pfCheck"> üçó Frango</label>
<label class="pfOption"><input type="checkbox" value="Bife" class="pfCheck"> ü•© Bife</label>
<label class="pfOption"><input type="checkbox" value="Peixe" class="pfCheck"> üêü Peixe</label>

<div class="pfPrecoExtra" id="pfPrecoInfo">Valor: R$ ${precoBase.toFixed(2)}</div>

<button class="modalBtnTam modalBtnG" style="margin-top:8px" id="pfConfirmar">ADICIONAR</button>
<button class="modalBtnTam modalBtnCancelar" onclick="this.closest('.modalOverlay').remove()">Cancelar</button>
</div>`

document.body.appendChild(overlay)

let checks = overlay.querySelectorAll(".pfCheck")
let precoInfo = overlay.querySelector("#pfPrecoInfo")
let btnConfirmar = overlay.querySelector("#pfConfirmar")

function atualizarPrecoPF(){
let selecionados = [...checks].filter(c=>c.checked).length
let extra = selecionados > 1 ? (selecionados - 1) * 8 : 0
let total = precoBase + extra
precoInfo.textContent = "Valor: R$ " + total.toFixed(2) + (extra > 0 ? " (+" + extra.toFixed(2) + " extra)" : "")
}

checks.forEach(c=>c.addEventListener("change", atualizarPrecoPF))

btnConfirmar.onclick = ()=>{
let selecionados = [...checks].filter(c=>c.checked)
if(!selecionados.length){
alert("Escolha pelo menos uma prote√≠na")
return
}
let nomes = selecionados.map(c=>c.value)
let extra = selecionados.length > 1 ? (selecionados.length - 1) * 8 : 0
let precoFinal = precoBase + extra
let obsProteinas = "Prote√≠na: " + nomes.join(", ")

addCarrinho({nome:nomeItem, preco:precoFinal, obs:obsProteinas})
overlay.remove()
mostrarToast(nomeItem + " adicionado!")
}
}

/* =========================
SOM DE NOTIFICA√á√ÉO (ADMIN)
========================= */

const audioNotificacao = new Audio(
"https://actions.google.com/sounds/v1/alarms/notification.ogg"
)

/* =========================
PEDIDOS AO VIVO (FIREBASE)
========================= */

let abaAdminAtiva = "delivery"
let pedidosNaoVistosDelivery = 0
let pedidosNaoVistosLocal = 0

window.trocarAbaAdmin = (tipo)=>{

abaAdminAtiva = tipo

let tabD = document.getElementById("tabDelivery")
let tabL = document.getElementById("tabLocal")
let boxD = document.getElementById("adminPedidosDelivery")
let boxL = document.getElementById("adminPedidosLocal")

if(tipo === "delivery"){
tabD.classList.add("ativo")
tabL.classList.remove("ativo")
boxD.style.display = "block"
boxL.style.display = "none"
pedidosNaoVistosDelivery = 0
let badge = document.getElementById("badgeDelivery")
if(badge){ badge.classList.remove("visivel"); badge.textContent = "0" }
} else {
tabL.classList.add("ativo")
tabD.classList.remove("ativo")
boxL.style.display = "block"
boxD.style.display = "none"
pedidosNaoVistosLocal = 0
let badge = document.getElementById("badgeLocal")
if(badge){ badge.classList.remove("visivel"); badge.textContent = "0" }
}

}

window.enviarACaminho = (tel, nome)=>{
let texto = `Ol√° ${nome}! Seu pedido do *Recanto do Pastel* est√° a caminho! ü•üüõµ`
location.href = `https://wa.me/55${tel.replace(/\D/g,"")}?text=${encodeURIComponent(texto)}`
}

function escHtml(s){
if(!s) return ""
return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")
}

window.reimprimirPedido = (docId)=>{
let p = pedidosMap[docId]
if(p) imprimirCupom(p)
else alert("Pedido n√£o encontrado")
}

function renderPedidoCard(p, docId){

let nome = escHtml(p.cliente?.nome || "Sem nome")
let tel = escHtml(p.cliente?.tel || "")
let mesa = escHtml(p.cliente?.mesa || "")
let pagamento = escHtml(p.pagamento || "PIX")
let dataStr = escHtml(new Date(p.data).toLocaleString())

let infoHtml = ""

infoHtml += `üì± ${tel}<br>`

if(p.modo === "delivery"){
let end = p.endereco || {}
let rua = escHtml(end.rua || "")
let num = escHtml(end.numero || "")
let bairro = escHtml(end.bairro || "")
if(rua) infoHtml += `üìç ${rua}, ${num} - ${bairro}<br>`
} else {
if(mesa) infoHtml += `üçΩÔ∏è Mesa: ${mesa}<br>`
}

infoHtml += `üí≥ ${pagamento}<br>`
if(p.troco) infoHtml += `üíµ Troco para: R$ ${escHtml(p.troco)}<br>`
infoHtml += `üïê ${dataStr}`

let itensHtml = ""
;(p.itens || []).forEach(i=>{
let nomeItem = escHtml(i.nome)
let obsItem = escHtml(i.obs)
itensHtml += `‚Ä¢ ${i.qtd}x ${nomeItem} - R$ ${(i.qtd * i.preco).toFixed(2)}<br>`
if(obsItem) itensHtml += `&nbsp;&nbsp;üìù ${obsItem}<br>`
})

let telLimpo = (p.cliente?.tel || "").replace(/\D/g,"")
let nomeLimpo = escHtml(p.cliente?.nome || "")

let btnHtml = ""
if(p.modo === "delivery" && telLimpo){
btnHtml = `<button class="btnDeliveryCaminho" data-tel="${telLimpo}" data-nome="${nomeLimpo}" onclick="enviarACaminho(this.dataset.tel,this.dataset.nome)">üõµ Enviar "A caminho" no WhatsApp</button>`
}

return `<div class="pedidoCard">
<div class="pedidoNome">üë§ ${nome}</div>
<div class="pedidoInfo">${infoHtml}</div>
<div class="pedidoItens">${itensHtml}</div>
<div class="pedidoTotal">üí∞ R$ ${Number(p.total).toFixed(2)}</div>
${btnHtml}
<button class="btnImprimir" onclick="reimprimirPedido('${docId}')">üñ®Ô∏è Imprimir</button>
</div>`

}

let pedidoIdsVistos = new Set()
let pedidosMap = {}

onSnapshot(collection(db,"pedidos"), snap => {

pedidosCache = []

let boxD = document.getElementById("adminPedidosDelivery")
let boxL = document.getElementById("adminPedidosLocal")

if(boxD) boxD.innerHTML = ""
if(boxL) boxL.innerHTML = ""

let countDeliveryNovos = 0
let countLocalNovos = 0

let hoje = new Date().toDateString()
let pedidosParaImprimir = []

snap.forEach(doc => {

let p = doc.data()
let docId = doc.id

pedidosCache.push(p)
pedidosMap[docId] = p

let pedidoHoje = new Date(p.data).toDateString() === hoje
if(!pedidoHoje){
pedidoIdsVistos.add(docId)
return
}

let card = renderPedidoCard(p, docId)

if(p.modo === "delivery"){
if(boxD) boxD.innerHTML += card
if(!pedidoIdsVistos.has(docId) && !primeiraCarga){
countDeliveryNovos++
pedidosParaImprimir.push(p)
}
} else {
if(boxL) boxL.innerHTML += card
if(!pedidoIdsVistos.has(docId) && !primeiraCarga){
countLocalNovos++
pedidosParaImprimir.push(p)
}
}

pedidoIdsVistos.add(docId)

})

if(!primeiraCarga){

if(countDeliveryNovos > 0 && abaAdminAtiva !== "delivery"){
pedidosNaoVistosDelivery += countDeliveryNovos
let badge = document.getElementById("badgeDelivery")
if(badge){ badge.textContent = pedidosNaoVistosDelivery; badge.classList.add("visivel") }
}

if(countLocalNovos > 0 && abaAdminAtiva !== "local"){
pedidosNaoVistosLocal += countLocalNovos
let badge = document.getElementById("badgeLocal")
if(badge){ badge.textContent = pedidosNaoVistosLocal; badge.classList.add("visivel") }
}

if(countDeliveryNovos > 0 || countLocalNovos > 0){
audioNotificacao.play().catch(()=>{})
}

/* Auto-imprimir novos pedidos no computador da loja */
if(pedidosParaImprimir.length > 0){
let fila = pedidosParaImprimir.slice()
let idx = 0
function imprimirFila(){
if(idx >= fila.length) return
imprimirCupom(fila[idx])
idx++
if(idx < fila.length) setTimeout(imprimirFila, 2000)
}
imprimirFila()
}

}

if(boxD && boxD.innerHTML === "") boxD.innerHTML = "<div style='color:#7a6a5a;text-align:center;padding:20px'>Nenhum pedido delivery</div>"
if(boxL && boxL.innerHTML === "") boxL.innerHTML = "<div style='color:#7a6a5a;text-align:center;padding:20px'>Nenhum pedido local</div>"

primeiraCarga = false

})

/* =========================
IMPRESS√ÉO DE CUPOM
========================= */

function imprimirCupom(pedido){

let div = document.getElementById("cupomImpressao")
if(!div) return

let dataObj = new Date(pedido.data)
let dataStr = dataObj.toLocaleDateString("pt-BR")
let horaStr = dataObj.toLocaleTimeString("pt-BR")

let modoTxt = pedido.modo === "delivery" ? "DELIVERY" : "LOCAL"

let html = ""

html += '<div class="cupomLinha cupomTitulo">RECANTO DO PASTEL</div>'
html += '<div class="cupomSep"></div>'

html += '<div class="cupomLinha cupomModo">' + modoTxt + '</div>'

if(pedido.modo === "local" && pedido.cliente.mesa){
html += '<div class="cupomLinha" style="font-size:18px;font-weight:900">MESA ' + escHtml(pedido.cliente.mesa) + '</div>'
}

html += '<div class="cupomSep"></div>'

html += '<div class="cupomInfo">Data: ' + dataStr + '</div>'
html += '<div class="cupomInfo">Hora: ' + horaStr + '</div>'

if(pedido.modo === "delivery"){
html += '<div class="cupomSep"></div>'
html += '<div class="cupomInfo">Cliente: ' + escHtml(pedido.cliente.nome || "") + '</div>'
html += '<div class="cupomInfo">Tel: ' + escHtml(pedido.cliente.tel || "") + '</div>'
if(pedido.endereco){
let e = pedido.endereco
if(e.rua) html += '<div class="cupomInfo">End: ' + escHtml(e.rua) + ', ' + escHtml(e.numero || "") + '</div>'
if(e.bairro) html += '<div class="cupomInfo">Bairro: ' + escHtml(e.bairro) + '</div>'
}
html += '<div class="cupomInfo">Pagamento: ' + escHtml(pedido.pagamento || "PIX") + '</div>'
if(pedido.troco) html += '<div class="cupomInfo">Troco para: R$ ' + escHtml(pedido.troco) + '</div>'
}

html += '<div class="cupomLinha cupomSub">ITENS</div>'

;(pedido.itens || []).forEach(i => {
html += '<div class="cupomItem">' + i.qtd + 'x ' + escHtml(i.nome) + '</div>'
html += '<div class="cupomItem" style="text-align:right">R$ ' + (i.qtd * i.preco).toFixed(2) + '</div>'
if(i.obs) html += '<div class="cupomObs">  -> ' + escHtml(i.nome) + ': ' + escHtml(i.obs) + '</div>'
})

if(pedido.frete > 0){
html += '<div class="cupomSep"></div>'
html += '<div class="cupomItem">Frete: R$ ' + pedido.frete.toFixed(2) + '</div>'
}

html += '<div class="cupomLinha cupomTotal">TOTAL: R$ ' + Number(pedido.total).toFixed(2) + '</div>'

html += '<div class="cupomSep"></div>'
html += '<div class="cupomLinha" style="font-size:11px;margin-top:6px">Obrigado pela preferencia!</div>'
html += '<div class="cupomLinha" style="font-size:11px">Recanto do Pastel</div>'

div.innerHTML = html

setTimeout(()=>{
window.print()
},300)

}

/* =========================
RELAT√ìRIOS
========================= */

function somaPedidos(filtro){

return pedidosCache
.filter(filtro)
.reduce((s,p)=> s + Number(p.total || 0), 0)

}

window.relatorioHoje = ()=>{

let hoje = new Date().toDateString()

let total = somaPedidos(p =>
new Date(p.data).toDateString() === hoje
)

alert("Total Hoje: R$ " + total.toFixed(2))

}

window.relatorioMes = ()=>{

let mes = new Date().getMonth()
let ano = new Date().getFullYear()

let total = somaPedidos(p => {

let d = new Date(p.data)
return d.getMonth() === mes && d.getFullYear() === ano

})

alert("Total do M√™s: R$ " + total.toFixed(2))

}

window.relatorioAno = ()=>{

let ano = new Date().getFullYear()

let total = somaPedidos(p =>
new Date(p.data).getFullYear() === ano
)

alert("Total do Ano: R$ " + total.toFixed(2))

}

/* =========================
EXPORTAR CSV COMPLETO
========================= */

window.exportarExcel = ()=>{

let csv = "cliente,item,quantidade,valor_unitario,total_pedido,data\n"

let totalGeralRel = 0

pedidosCache.forEach(p => {

totalGeralRel += Number(p.total) || 0

;(p.itens || []).forEach(it => {

csv += `${p.cliente.nome},`
csv += `${it.nome},`
csv += `${it.qtd},`
csv += `${it.preco},`
csv += `${p.total},`
csv += `${p.data}\n`

})

})

csv += `\n,,,,TOTAL VENDIDO,${totalGeralRel.toFixed(2)}\n`

let blob = new Blob([csv],{type:"text/csv"})
let a = document.createElement("a")

a.href = URL.createObjectURL(blob)
a.download = "relatorio_recanto_do_pastel.csv"
a.click()

}

/* =========================
ZERAR TODOS OS PEDIDOS
========================= */

window.zerarRelatorios = async()=>{

if(!confirm("Deseja apagar TODOS os pedidos?")) return

let snap = await getDocs(collection(db,"pedidos"))

for(let doc of snap.docs){
await deleteDoc(doc.ref)
}

alert("Pedidos apagados com sucesso")

}

/* =========================
ADMIN - NOVA ABA
========================= */

window.adminNovaAba = ()=>{

let nome = prompt("Nome da nova aba")

if(!nome) return

if(cardapio[nome]){
alert("Essa aba j√° existe.")
return
}

cardapio[nome] = []

salvarCardapioFirebase()

renderAbas()

alert("Aba criada com sucesso")

}

/* =========================
ADMIN - ABRIR NOVO PRODUTO UI
========================= */

window.abrirNovoProdutoUI = ()=>{

qs("novoProdAba").innerHTML = ""

let abasVistas = new Set()
Object.keys(cardapio).forEach(aba => {
let base = aba.replace(" P","").replace(" G","")
if(abasVistas.has(base)) return
abasVistas.add(base)

let temPG = cardapio[base + " P"] && cardapio[base + " G"]
let opt = document.createElement("option")
opt.value = temPG ? base + " P" : aba
opt.innerText = base
opt.dataset.temPG = temPG ? "1" : "0"

qs("novoProdAba").appendChild(opt)

})

mostrar("uiNovoProduto")

}

/* =========================
CONFIRMAR NOVO PRODUTO
========================= */

window.confirmarNovoProduto = ()=>{

let nome = qs("novoProdNome").value.trim()
let desc = qs("novoProdDesc").value.trim()
let precoP = parseFloat(qs("novoProdPrecoP").value)
let precoG = parseFloat(qs("novoProdPrecoG").value)
let aba = qs("novoProdAba").value

if(!nome || isNaN(precoP)){
alert("Preencha o nome e pelo menos o pre√ßo P.")
return
}

/* Se a aba tem P/G (ex: Past√©is Salgados), adiciona em ambas */
let abaBase = aba.replace(" P","").replace(" G","")
let abaP = abaBase + " P"
let abaG = abaBase + " G"

if(cardapio[abaP] && cardapio[abaG] && !isNaN(precoG)){
cardapio[abaP].push({nome: nome + " P", preco: precoP, desc: desc})
cardapio[abaG].push({nome: nome + " G", preco: precoG, desc: desc})
} else {
cardapio[aba].push({nome: nome, preco: precoP, desc: desc})
}

salvarCardapioFirebase()

qs("novoProdNome").value=""
qs("novoProdDesc").value=""
qs("novoProdPrecoP").value=""
qs("novoProdPrecoG").value=""

mostrar("telaAdmin")

alert("Produto adicionado!")

}

/* =========================
ADMIN - EDITAR PRODUTOS
========================= */

window.abrirEditorItens = ()=>{

qs("listaEditor").innerHTML = ""

Object.keys(cardapio).forEach(aba => {

cardapio[aba].forEach((produto,index)=>{

let el = document.createElement("div")
el.className = "adminBox"

el.innerHTML = `
<b>${aba}</b><br>
${produto.nome} ‚Äî R$ ${produto.preco}
<br>
<button class="adminBtn"
onclick="editarProduto('${aba}',${index})">
Editar
</button>
<button class="adminBtn"
onclick="removerProduto('${aba}',${index})">
Remover
</button>
`

qs("listaEditor").appendChild(el)

})

})

mostrar("telaEditorItens")

}

window.editarProduto = (aba,index)=>{

let novoNome = prompt("Novo nome:",
cardapio[aba][index].nome)

let novoPreco = prompt("Novo pre√ßo:",
cardapio[aba][index].preco)

if(!novoNome || isNaN(parseFloat(novoPreco))) return

cardapio[aba][index].nome = novoNome
cardapio[aba][index].preco = parseFloat(novoPreco)

salvarCardapioFirebase()
abrirEditorItens()

}

window.removerProduto = (aba,index)=>{

if(!confirm("Remover produto?")) return

cardapio[aba].splice(index,1)

salvarCardapioFirebase()
abrirEditorItens()

}
/* =========================
ADMIN - REMOVER ABA UI
========================= */

window.abrirRemoverAbaUI = ()=>{

qs("listaAbasRemover").innerHTML = ""

Object.keys(cardapio).forEach(aba => {

let el = document.createElement("div")
el.className = "adminBox"

el.innerHTML = `
<b>${aba}</b>
<button class="adminBtn"
onclick="removerAbaConfirmada('${aba}')">
Remover Aba
</button>
`

qs("listaAbasRemover").appendChild(el)

})

mostrar("uiRemoverAba")

}

/* =========================
REMOVER ABA CONFIRMA√á√ÉO
========================= */

window.removerAbaConfirmada = async (aba)=>{

if(!confirm(`Remover a aba "${aba}"?`)) return

delete cardapio[aba]

await salvarCardapioFirebase()

mostrar("telaAdmin")

alert("Aba removida com sucesso")

}

/* =========================
SALVAR CARD√ÅPIO FIREBASE
========================= */

async function salvarCardapioFirebase(){

try{

/* apagar tudo */
let snap = await getDocs(collection(db,"cardapio"))

for(let doc of snap.docs){
await deleteDoc(doc.ref)
}

/* salvar novamente */
for(let aba in cardapio){

await addDoc(collection(db,"cardapio"),{
nomeAba:aba,
itens:cardapio[aba]
})

}

}catch(e){
console.log("Erro salvar card√°pio:",e)
}

}

/* =========================
CARREGAR CARD√ÅPIO FIREBASE
========================= */

async function carregarCardapioFirebase(){

try{

let snap = await getDocs(collection(db,"cardapio"))

if(snap.empty) return

let novoCardapio = {}

snap.forEach(doc => {

let d = doc.data()

novoCardapio[d.nomeAba] = d.itens || []

})

cardapio = novoCardapio

}catch(e){
console.log("Erro carregar card√°pio:",e)
}

}

/* =========================
TOAST NOTIFICATION
========================= */

function mostrarToast(texto){
let t = qs("toast")
if(!t) return
t.innerText = texto
t.classList.add("mostrar")
setTimeout(()=>{
t.classList.remove("mostrar")
},1800)
}

/* =========================
MODAL TAMANHO P/G
========================= */

function mostrarModalTamanho(nomeBase, tamanhos){

let overlay = document.createElement("div")
overlay.className = "modalOverlay"

overlay.innerHTML = `
<div class="modalBox">
<h3>${nomeBase}</h3>
<button class="modalBtnTam modalBtnP" data-tam="P">
Pequeno - R$ ${tamanhos["P"].toFixed(2)}
</button>
<button class="modalBtnTam modalBtnG" data-tam="G">
Grande - R$ ${tamanhos["G"].toFixed(2)}
</button>
<button class="modalBtnTam modalBtnCancelar" data-tam="cancelar">
Cancelar
</button>
</div>
`

overlay.querySelector('[data-tam="P"]').onclick = ()=>{
document.body.removeChild(overlay)
if(tamanhos._isPastel && !nomeBase.includes("Especial") && !nomeBase.includes("Camar√£o")){
mostrarModalAdicionais(nomeBase, "P", tamanhos["P"])
} else {
pedirObservacao(nomeBase + " P", tamanhos["P"])
}
}

overlay.querySelector('[data-tam="G"]').onclick = ()=>{
document.body.removeChild(overlay)
if(tamanhos._isPastel && !nomeBase.includes("Especial") && !nomeBase.includes("Camar√£o")){
mostrarModalAdicionais(nomeBase, "G", tamanhos["G"])
} else {
pedirObservacao(nomeBase + " G", tamanhos["G"])
}
}

overlay.querySelector('[data-tam="cancelar"]').onclick = ()=>{
document.body.removeChild(overlay)
}

document.body.appendChild(overlay)

}


/* =========================
ADICIONAIS DE PASTEL
========================= */

const ADICIONAIS_PASTEL = [
"Frango","Aipim","Bacon","Calabresa","Carne","Lombinho",
"Cora√ß√£o de Frango","Presunto","Ovo","Ervilha","Tomate",
"Palmito","Azeitona","Catupiry","Batata Palha","Br√≥colis",
"Cenoura Ralada","Salsicha","Or√©gano","Cheddar","Cebola","Alho",
"Mussarela","Milho"
]

const PRECO_COM_ADICIONAIS = { P: 18, G: 24 }

function mostrarModalAdicionais(nomeBase, tamanho, precoOriginal){

let overlay = document.createElement("div")
overlay.className = "modalOverlay"

let listHtml = ADICIONAIS_PASTEL.map((a,i) =>
`<label class="adicionalLabel"><input type="checkbox" value="${a}" class="adicionalCheck"> ${a}</label>`
).join("")

overlay.innerHTML = `
<div class="modalBox" style="max-height:80vh;overflow-y:auto">
<h3>${nomeBase} ${tamanho}</h3>
<p style="font-size:13px;color:#7a6a5a;margin-bottom:10px">Adicionais (1 gr√°tis, a partir de 2: R$ ${PRECO_COM_ADICIONAIS[tamanho].toFixed(2)})</p>
<div class="adicionaisGrid">${listHtml}</div>
<button class="modalBtnTam modalBtnG" id="btnConfirmAdc">Confirmar</button>
<button class="modalBtnTam modalBtnCancelar" id="btnCancelAdc">Sem adicionais</button>
</div>
`

overlay.querySelector("#btnConfirmAdc").onclick = ()=>{
let selecionados = [...overlay.querySelectorAll(".adicionalCheck:checked")].map(c=>c.value)
let precoFinal = precoOriginal
if(selecionados.length >= 2){
precoFinal = PRECO_COM_ADICIONAIS[tamanho]
}
let nomeFinal = nomeBase + " " + tamanho
if(selecionados.length > 0){
nomeFinal += " + " + selecionados.join(", ")
}
document.body.removeChild(overlay)
pedirObservacao(nomeFinal, precoFinal)
}

overlay.querySelector("#btnCancelAdc").onclick = ()=>{
document.body.removeChild(overlay)
pedirObservacao(nomeBase + " " + tamanho, precoOriginal)
}

document.body.appendChild(overlay)
}

/* =========================
PEDIR OBSERVA√á√ÉO DO ITEM
========================= */

function pedirObservacao(nome, preco){

let obs = prompt("Observa√ß√£o (opcional):\nEx: sem cebola, bem passado...")

addCarrinho({
nome: nome,
preco: preco,
obs: obs || ""
})

}

/* =========================
FILTRAR CARD√ÅPIO (BUSCA)
========================= */

window.filtrarCardapio = ()=>{

let busca = qs("buscaCardapio")?.value?.toLowerCase() || ""

if(!busca){
renderAbas()
return
}

qs("lista").innerHTML = ""

let categoriasAgrupadas = agruparCategorias()

Object.keys(categoriasAgrupadas).forEach(nomeGrupo=>{

let grupo = categoriasAgrupadas[nomeGrupo]
let encontrados = {}

Object.keys(grupo).forEach(nomeBase=>{
if(nomeBase.toLowerCase().includes(busca)){
encontrados[nomeBase] = grupo[nomeBase]
}
})

if(Object.keys(encontrados).length === 0) return

let label = document.createElement("div")
label.style.cssText = "font-size:13px;font-weight:700;color:var(--text2);padding:4px 0;margin-top:8px"
label.textContent = nomeGrupo
qs("lista").appendChild(label)

Object.keys(encontrados).forEach(nomeBase=>{

let tamanhos = encontrados[nomeBase]

let el = document.createElement("div")
el.className = "item"

let infoDiv = document.createElement("div")
infoDiv.className = "itemInfo"

let nomeEl = document.createElement("div")
nomeEl.className = "itemNome"
nomeEl.textContent = nomeBase
infoDiv.appendChild(nomeEl)

let precosDiv = document.createElement("div")
precosDiv.className = "itemPrecos"

Object.keys(tamanhos).filter(t=> t!=="desc" && t!=="pratoFeito" && t!=="num" && t!=="_isPastel" && t!=="_categoria").forEach(t=>{
let span = document.createElement("span")
span.className = "itemPreco"
span.textContent = (t === "√önico" ? "" : t + " ") + "R$ " + tamanhos[t].toFixed(2)
precosDiv.appendChild(span)
})

infoDiv.appendChild(precosDiv)
el.appendChild(infoDiv)

let btn = document.createElement("button")
btn.className = "btnAdd"
btn.textContent = "Adicionar"

btn.onclick = ()=>{
if(tamanhos["P"] && tamanhos["G"]){
mostrarModalTamanho(nomeBase, tamanhos)
} else {
let preco = tamanhos["√önico"] || tamanhos["P"] || tamanhos["G"] || tamanhos[Object.keys(tamanhos)[0]]
pedirObservacao(nomeBase, preco)
}
}

el.appendChild(btn)
qs("lista").appendChild(el)

})

})

}

/* =========================
ALTERAR QUANTIDADE (+/-)
========================= */

window.alterarQtd = (idx, delta)=>{

if(idx < 0 || idx >= carrinho.length) return

carrinho[idx].qtd += delta

if(carrinho[idx].qtd <= 0){
carrinho.splice(idx, 1)
}

renderCarrinho()

if(!carrinho.length){
fecharCarrinho()
}

}

/* =========================
INIT FINAL DO SISTEMA
========================= */

async function initSistema(){

await carregarCardapioFirebase()

renderAbas()

resetarSistema()

mostrar("telaEscolha")

}

initSistema()

/* =========================
FIM DEFINITIVO DO SCRIPT
========================= */
</script>
<div id="toast" class="toast"></div>

<div id="cupomImpressao"></div>

</body>
</html>
