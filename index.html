<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
html,body{height:100%;background:#fff7e6}

/* ===== TELAS ===== */

.tela{
position:fixed;
inset:0;
display:none;
flex-direction:column;
align-items:center;
padding:14px;
overflow:auto;
}
.tela.ativa{display:flex}

/* ===== BOT√ÉO VOLTAR ===== */

.btnVoltarGlobal{
position:fixed;
bottom:12px;
left:12px;
z-index:3000;
background:#333;
color:white;
border:none;
border-radius:14px;
padding:12px 16px;
font-weight:700;
}

/* ===== INICIAL ===== */

#telaInicial{
justify-content:center;
text-align:center;
background:linear-gradient(180deg,#ff9800,#ff5722);
color:white;
}

.logo{
font-size:clamp(24px,6vw,36px);
font-weight:700;
margin-bottom:20px;
}

.btnPrincipal{
background:white;
color:#ff5722;
padding:16px;
border-radius:14px;
font-size:18px;
font-weight:700;
border:none;
width:100%;
max-width:320px;
}

/* ===== CARD√ÅPIO ===== */

.topo{
width:100%;
max-width:680px;
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
gap:8px;
}

.abas{
display:flex;
gap:8px;
overflow-x:auto;
width:100%;
max-width:680px;
}

.aba{
background:#ffe0b2;
border:none;
padding:10px 14px;
border-radius:20px;
font-weight:600;
white-space:nowrap;
}

.lista{
width:100%;
max-width:680px;
display:flex;
flex-direction:column;
gap:10px;
padding-bottom:120px;
}

.item{
background:white;
border-radius:14px;
padding:10px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
gap:10px;
}

.btnAdd{
background:#4caf50;
color:white;
border:none;
border-radius:10px;
padding:10px 14px;
font-weight:700;
}

/* ===== BOT√ïES ===== */

.btn{
border:none;
border-radius:12px;
padding:14px;
font-weight:700;
width:100%;
max-width:680px;
}

.btnPrim{background:#ff5722;color:white}
.btnSec{background:#ccc;color:#000}

/* ===== CARRINHO ===== */

#carrinho{
position:fixed;
right:-100%;
top:0;
width:100%;
max-width:420px;
height:100%;
background:white;
box-shadow:-4px 0 12px rgba(0,0,0,0.25);
transition:.3s;
display:flex;
flex-direction:column;
z-index:2000;
}
#carrinho.aberto{right:0}

.cLista{
flex:1;
overflow:auto;
padding:10px;
}

.cItem{
display:flex;
justify-content:space-between;
margin-bottom:8px;
gap:8px;
}

/* ===== FORM ===== */

.form{
width:100%;
max-width:680px;
display:flex;
flex-direction:column;
gap:12px;
}

input,select{
padding:14px;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
width:100%;
}

/* ===== ADMIN ===== */

#telaAdmin{
background:#212121;
color:white;
}

.adminBox{
background:#424242;
padding:12px;
border-radius:12px;
margin-bottom:12px;
width:100%;
max-width:680px;
}

.adminBtn{
background:#ff9800;
border:none;
color:white;
padding:12px;
border-radius:10px;
margin-top:6px;
width:100%;
font-weight:700;
}

</style>
</head>
<body>
<button class="btnVoltarGlobal" onclick="voltarUniversal()">‚Üê VOLTAR</button>

<!-- =========================
TELA INICIAL
========================= -->

<div id="telaInicial" class="tela ativa">
<div class="logo">ü•ü Recanto do Pastel</div>

<button class="btnPrincipal"
onclick="abrirCardapio()">
FAZER PEDIDO
</button>

<button class="btn btnSec"
style="margin-top:12px"
onclick="loginAdmin()">
PAINEL ADMIN
</button>
</div>

<!-- =========================
CARD√ÅPIO
========================= -->

<div id="telaCardapio" class="tela">

<div class="topo">
<b>Card√°pio</b>

<button class="btn btnPrim"
style="max-width:180px"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<div id="abas" class="abas"></div>

<div id="lista" class="lista"></div>

</div>

<!-- =========================
CARRINHO LATERAL
========================= -->

<div id="carrinho">

<div style="padding:16px;font-weight:700">
Seu Pedido
<button style="float:right"
onclick="toggleCarrinho()">X</button>
</div>

<div id="cLista" class="cLista"></div>

<div style="padding:12px">

<div id="linhaFreteCarrinho"
style="display:none;margin-bottom:6px">
Frete: R$
<span id="freteCarrinhoTxt">0.00</span>
</div>

<b>
Total R$
<span id="total">0.00</span>
</b>

</div>

<button class="btn btnPrim"
onclick="irCheckout()">
FINALIZAR
</button>

</div>
<!-- =========================
CHECKOUT
========================= -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:10px">
Finalizar Pedido
</h2>

<div class="form">

<select id="tipoPedido">
<option value="local">
Consumir no local
</option>

<option value="entrega">
Entrega
</option>
</select>

<!-- MESA OPCIONAL -->

<div id="boxMesa">
<input id="mesaInput"
placeholder="N√∫mero da mesa (opcional)">
</div>

<input id="nome"
placeholder="Nome do cliente">

<input id="telefone"
placeholder="Telefone">

<!-- ENDERE√áO ENTREGA -->

<div id="boxEndereco"
style="display:none">

<input id="rua"
placeholder="Rua">

<input id="bairro"
placeholder="Bairro">

<input id="numero"
placeholder="N√∫mero">

</div>

<select id="pagamento">

<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>

</select>

<!-- TROCO -->

<div id="boxTroco"
style="display:none">

<input id="troco"
placeholder="Troco para quanto?">

</div>

<!-- PIX AUTO MOSTRAR -->

<div id="boxPix"
style="
display:none;
background:#e8f5e9;
padding:12px;
border-radius:12px;
font-weight:700;
">

Chave PIX:<br>
<span id="pixChaveTxt"></span>

<br><br>

Valor PIX:<br>
R$ <span id="pixValorTxt">0.00</span>

</div>

<!-- FRETE TRAVADO -->

<input id="frete"
value="0"
readonly>

<button class="btn btnPrim"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>
<!-- =========================
PAINEL ADMIN
========================= -->

<div id="telaAdmin" class="tela">

<h2 style="margin-bottom:12px">
Painel Admin
</h2>

<div class="adminBox">

<b>Card√°pio</b>

<button class="adminBtn"
onclick="adminNovaAba()">
Nova Aba
</button>

<button class="adminBtn"
onclick="adminNovoItem()">
Novo Item
</button>

<button class="adminBtn"
onclick="abrirEditorItens()">
Editar / Remover Itens
</button>

</div>

<div class="adminBox">

<b>Promo√ß√µes</b>

<button class="adminBtn"
onclick="adminPromoItem()">
Marcar Item Promo
</button>

<button class="adminBtn"
onclick="adminBanner()">
Banner Promo
</button>

</div>

<div class="adminBox">

<b>Pedidos ao Vivo</b>

<div id="adminPedidos"></div>

</div>

<div class="adminBox">

<b>Relat√≥rios</b>

<button class="adminBtn"
onclick="relatorioHoje()">
Hoje
</button>

<button class="adminBtn"
onclick="relatorioMes()">
M√™s
</button>

<button class="adminBtn"
onclick="relatorioAno()">
Ano
</button>

<button class="adminBtn"
onclick="exportarCSV()">
Exportar Excel
</button>

<button class="adminBtn"
onclick="zerarRelatorios()">
Zerar Dados
</button>

</div>

</div>

<!-- =========================
EDITOR ITENS
========================= -->

<div id="telaEditorItens" class="tela">

<h2 style="margin-bottom:10px">
Editar / Remover Itens
</h2>

<div id="listaEditor"
class="lista"></div>

</div>

<!-- =========================
BANNER PROMO TOPO
========================= -->

<div id="bannerPromo"
style="
display:none;
position:fixed;
top:0;
left:0;
width:100%;
background:#d32f2f;
color:white;
text-align:center;
padding:8px;
font-weight:700;
z-index:3500;
">
PROMO
</div>
<script type="module">

/* =========================
CONFIG
========================= */

const ADMIN_SENHA="1234"
let WHATSAPP_LOJA="5599999999999"
let PIX_CHAVE="pix-recanto-exemplo@pix"

/* =========================
FIREBASE ‚Äî COLE SUAS CHAVES
========================= */

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore, collection, addDoc,
onSnapshot, updateDoc, doc
} from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig={
apiKey:"COLE_AQUI",
authDomain:"COLE_AQUI",
projectId:"COLE_AQUI",
storageBucket:"COLE_AQUI",
messagingSenderId:"COLE_AQUI",
appId:"COLE_AQUI"
}

const app=initializeApp(firebaseConfig)
const db=getFirestore(app)

/* =========================
ESTADO
========================= */

let carrinho=[]
let pedidosCache=[]
let historico=["telaInicial"]
let abaAtual=null

let cardapio={
"Past√©is":[
{nome:"Pastel Carne",preco:12},
{nome:"Pastel Queijo",preco:11}
],
"Bebidas":[
{nome:"Refri",preco:6}
]
}

/* =========================
UTIL
========================= */

function qs(id){return document.getElementById(id)}

function mostrar(id){
document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))
qs(id).classList.add("ativa")
historico.push(id)
}

window.voltarUniversal=()=>{
historico.pop()
let prev=historico.pop()||"telaInicial"
mostrar(prev)
}

/* =========================
CARD√ÅPIO
========================= */

window.abrirCardapio=()=>{
mostrar("telaCardapio")
renderAbas()
}

function renderAbas(){
let d=qs("abas")
d.innerHTML=""
Object.keys(cardapio).forEach(nome=>{
let b=document.createElement("button")
b.className="aba"
b.innerText=nome
b.onclick=()=>renderItens(cardapio[nome])
d.appendChild(b)
})
}

function renderItens(lista){
let d=qs("lista")
d.innerHTML=""
lista.forEach(item=>{
let el=document.createElement("div")
el.className="item"
el.innerHTML=`
<div><b>${item.nome}</b><br>
R$ ${item.preco.toFixed(2)}</div>
<button class="btnAdd">+</button>`
el.querySelector("button").onclick=
()=>addCarrinho(item)
d.appendChild(el)
})
}

/* =========================
CARRINHO + FRETE
========================= */

function totalItens(){
return carrinho.reduce(
(s,i)=>s+i.preco*i.qtd,0)
}

function freteAtual(){
return parseFloat(qs("frete").value||0)
}

function totalGeral(){
return totalItens()+freteAtual()
}

function addCarrinho(item){
let ex=carrinho.find(i=>i.nome===item.nome)
if(ex) ex.qtd++
else carrinho.push({...item,qtd:1})
qs("carrinho").classList.add("aberto")
renderCarrinho()
}

window.removerItem=(nome)=>{
carrinho=carrinho.filter(i=>i.nome!==nome)
renderCarrinho()
if(!carrinho.length)
qs("carrinho").classList.remove("aberto")
}

window.toggleCarrinho=()=>{
qs("carrinho").classList.toggle("aberto")
}

function renderCarrinho(){

let d=qs("cLista")
d.innerHTML=""
let qtd=0

carrinho.forEach(i=>{
qtd+=i.qtd
let row=document.createElement("div")
row.className="cItem"
row.innerHTML=`
<span>${i.qtd}x ${i.nome}</span>
<span>
R$ ${(i.qtd*i.preco).toFixed(2)}
<button onclick="removerItem('${i.nome}')">x</button>
</span>`
d.appendChild(row)
})

/* frete visual */

if(freteAtual()>0){
qs("linhaFreteCarrinho").style.display="block"
qs("freteCarrinhoTxt").innerText=
freteAtual().toFixed(2)
}else{
qs("linhaFreteCarrinho").style.display="none"
}

qs("qtd").innerText=qtd
qs("total").innerText=totalGeral().toFixed(2)

atualizarPixPreview()
}

/* =========================
CHECKOUT UI
========================= */

qs("tipoPedido").onchange=e=>{
let ent=e.target.value==="entrega"
qs("boxEndereco").style.display=
ent?"block":"none"
qs("boxMesa").style.display=
ent?"none":"block"
qs("frete").value = ent?5:0
renderCarrinho()
}

qs("pagamento").onchange=e=>{
let p=e.target.value
qs("boxPix").style.display=
(p==="PIX")?"block":"none"
qs("boxTroco").style.display=
(p==="Dinheiro")?"block":"none"
atualizarPixPreview()
}

function atualizarPixPreview(){
qs("pixValorTxt").innerText=
totalGeral().toFixed(2)
qs("pixChaveTxt").innerText=
PIX_CHAVE
}

window.irCheckout=()=>{
if(!carrinho.length) return
mostrar("telaCheckout")
atualizarPixPreview()
}

/* =========================
FINALIZAR PEDIDO
========================= */

window.finalizarPedido=async()=>{

let nome=qs("nome").value
let tel=qs("telefone").value
if(!nome||!tel){
alert("Preencha nome e telefone")
return
}

let pedido={
cliente:{nome,tel},
mesa:qs("mesaInput").value||"",
tipo:qs("tipoPedido").value,
pagamento:qs("pagamento").value,
troco:qs("troco").value||"",
endereco:{
rua:qs("rua").value,
bairro:qs("bairro").value,
numero:qs("numero").value
},
itens:carrinho,
frete:freteAtual(),
total:totalGeral(),
data:new Date().toISOString(),
status:"novo"
}

await addDoc(collection(db,"pedidos"),pedido)

let txt="ü•ü RECANTO DO PASTEL\n\n"

carrinho.forEach(i=>{
txt+=`${i.qtd}x ${i.nome} ‚Äî R$ ${(i.qtd*i.preco).toFixed(2)}\n`
})

txt+=`\nFrete: R$ ${pedido.frete.toFixed(2)}`
txt+=`\nTOTAL: R$ ${pedido.total.toFixed(2)}`
txt+=`\nPagamento: ${pedido.pagamento}`
txt+=`\nCliente: ${nome}`

if(pedido.mesa)
txt+=`\nMesa: ${pedido.mesa}`

if(pedido.pagamento==="PIX")
txt+=`\nPIX: ${PIX_CHAVE}`

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(txt)}`)

carrinho=[]
renderCarrinho()
qs("carrinho").classList.remove("aberto")
mostrar("telaInicial")

}

/* =========================
ADMIN
========================= */

window.loginAdmin=()=>{
let s=prompt("Senha admin")
if(s!==ADMIN_SENHA) return
mostrar("telaAdmin")
}

window.adminNovaAba=()=>{
let n=prompt("Nome aba")
if(!n) return
cardapio[n]=[]
renderAbas()
}

window.adminNovoItem=()=>{
let a=prompt("Aba")
if(!cardapio[a]) return
let n=prompt("Nome")
let p=parseFloat(prompt("Pre√ßo"))
cardapio[a].push({nome:n,preco:p})
renderItens(cardapio[a])
}

window.abrirEditorItens=()=>{
let d=qs("listaEditor")
d.innerHTML=""
Object.keys(cardapio).forEach(a=>{
cardapio[a].forEach(i=>{
let el=document.createElement("div")
el.className="item"
el.innerHTML=`
<div>${a}<br>${i.nome}</div>
<button onclick="removerItemAdmin('${a}','${i.nome}')">
Remover</button>`
d.appendChild(el)
})
})
mostrar("telaEditorItens")
}

window.removerItemAdmin=(a,n)=>{
cardapio[a]=cardapio[a].filter(x=>x.nome!==n)
abrirEditorItens()
}

/* =========================
PEDIDOS AO VIVO
========================= */

onSnapshot(collection(db,"pedidos"),snap=>{
let div=qs("adminPedidos")
if(!div) return
div.innerHTML=""
snap.forEach(d=>{
let p=d.data()
let el=document.createElement("div")
el.className="adminBox"
el.innerHTML=`
${p.cliente.nome}<br>
R$ ${p.total.toFixed(2)}<br>
<button onclick="marcarPronto('${d.id}','${p.cliente.tel}')">
Pronto</button>`
div.appendChild(el)
})
})

window.marcarPronto=async(id,tel)=>{
await updateDoc(doc(db,"pedidos",id),
{status:"pronto"})
window.open(
`https://wa.me/${tel}?text=Pedido pronto`)
}

/* =========================
RELAT√ìRIO CSV
========================= */

window.exportarCSV=()=>{
let l=["data,total"]
pedidosCache.forEach(p=>{
l.push(`${p.data},${p.total}`)
})
let blob=new Blob([l.join("\n")])
let a=document.createElement("a")
a.href=URL.createObjectURL(blob)
a.download="relatorio.csv"
a.click()
}

/* =========================
INIT
========================= */

renderAbas()

</script>
</body>
</html>
