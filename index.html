<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Poppins;
}

html,body{
height:100%;
background:#fff7e6;
overflow-x:hidden;
}

/* =========================
RESET AUTOM√ÅTICO VISUAL
========================= */

.hidden{
display:none!important;
}

/* =========================
TELAS
========================= */

.tela{
position:fixed;
inset:0;
display:none;
flex-direction:column;
align-items:center;
padding:20px;
overflow:auto;
z-index:100;
text-align:center;
background:#fff7e6;
}

.tela.ativa{
display:flex;
}

/* =========================
TELA ESCOLHA
========================= */

#telaEscolha{
justify-content:center;
background:linear-gradient(180deg,#ff9800,#ff5722);
color:white;
}

.logoTopo{
width:95%;
max-width:420px;
margin-bottom:25px;
filter:drop-shadow(0 10px 20px rgba(0,0,0,.35));
}

.btnEscolha{
background:white;
color:#ff5722;
padding:20px;
border-radius:18px;
font-size:20px;
font-weight:900;
border:none;
width:100%;
max-width:360px;
margin-top:18px;
box-shadow:0 6px 14px rgba(0,0,0,.2);
transition:.2s;
}

.btnEscolha:active{
transform:scale(.97);
}

/* =========================
CARD√ÅPIO
========================= */

#telaCardapio{
background:#fff7e6;
}

.topo{
width:100%;
max-width:760px;
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:16px;
}

.topo b{
font-size:22px;
}

.abas{
display:flex;
gap:10px;
overflow-x:auto;
width:100%;
max-width:760px;
margin-bottom:16px;
padding-bottom:4px;
}

.aba{
background:#ffcc80;
border:none;
padding:14px 20px;
border-radius:22px;
font-weight:900;
font-size:14px;
white-space:nowrap;
color:#bf360c;
cursor:pointer;
transition:.2s;
}

.aba:active{
transform:scale(.95);
}

.lista{
width:100%;
max-width:760px;
display:flex;
flex-direction:column;
gap:20px;
padding-bottom:200px;
}

.item{
background:white;
border-radius:22px;
padding:22px;
display:flex;
flex-direction:column;
align-items:center;
gap:12px;
box-shadow:0 8px 18px rgba(0,0,0,.15);
}

.itemNome{
font-size:20px;
font-weight:900;
color:#e65100;
text-align:center;
}

.itemPreco{
font-size:22px;
font-weight:900;
color:#2e7d32;
}

.btnAdd{
background:#4caf50;
color:white;
border:none;
border-radius:16px;
padding:14px 22px;
font-weight:900;
font-size:16px;
margin-top:8px;
cursor:pointer;
transition:.2s;
}

.btnAdd:active{
transform:scale(.95);
}

/* =========================
CARRINHO
========================= */

#carrinho{
position:fixed;
top:0;
right:-100%;
width:95%;
max-width:420px;
height:100%;
background:#f7f7f7;
box-shadow:-8px 0 24px rgba(0,0,0,.25);
transition:.35s;
display:flex;
flex-direction:column;
z-index:900;
border-top-left-radius:20px;
border-bottom-left-radius:20px;
}

#carrinho.aberto{
right:0;
}

.cLista{
flex:1;
overflow:auto;
padding:18px;
display:flex;
flex-direction:column;
gap:16px;
}

.cItem{
background:white;
border-radius:18px;
padding:16px;
display:flex;
flex-direction:column;
gap:6px;
box-shadow:0 3px 10px rgba(0,0,0,.15);
text-align:center;
}

.btnFinalizarCarrinho{
margin:14px;
padding:18px;
border-radius:18px;
font-size:18px;
font-weight:900;
background:#ff5722;
color:white;
border:none;
cursor:pointer;
transition:.2s;
}

.btnFinalizarCarrinho:active{
transform:scale(.96);
}
/* =========================
CHECKOUT
========================= */

#telaCheckout{
background:#fff7e6;
}

.checkoutResumo{
width:100%;
max-width:760px;
background:white;
border-radius:22px;
padding:20px;
box-shadow:0 8px 18px rgba(0,0,0,.15);
margin-bottom:18px;
}

.form{
width:100%;
max-width:760px;
display:flex;
flex-direction:column;
gap:16px;
}

input,select,textarea{
padding:16px;
border-radius:16px;
border:1px solid #ccc;
font-size:16px;
width:100%;
}

/* =========================
PIX BOX (visual mais clean)
========================= */

.pixBox{
background:#f5f5f5;
border-radius:20px;
padding:18px;
display:flex;
flex-direction:column;
gap:12px;
border:1px solid #ddd;
}

.btnCopiarPix{
background:#1565c0;
color:white;
border:none;
padding:14px;
border-radius:14px;
font-weight:900;
font-size:16px;
cursor:pointer;
}

/* =========================
ADMIN
========================= */

#telaAdmin{
background:#212121;
color:white;
}

.adminBox{
background:#424242;
padding:18px;
border-radius:18px;
margin-bottom:18px;
width:100%;
max-width:760px;
}

.adminBtn{
background:#ff9800;
border:none;
color:white;
padding:16px;
border-radius:16px;
margin-top:10px;
width:100%;
font-weight:900;
font-size:16px;
cursor:pointer;
}

/* =========================
BOT√ïES FIXOS
========================= */

.btnConfig{
position:fixed;
top:14px;
right:16px;
z-index:4000;
font-size:22px;
background:white;
border:none;
border-radius:14px;
padding:10px;
box-shadow:0 4px 12px rgba(0,0,0,.2);
cursor:pointer;
}

.btnVoltar{
position:fixed;
bottom:16px;
left:16px;
z-index:3000;
background:#333;
color:white;
border:none;
border-radius:14px;
padding:12px 16px;
font-weight:900;
cursor:pointer;
}

/* =========================
FINAL DO CSS
========================= */

</style>
</head>
<body>

<button class="btnConfig" onclick="abrirAdmin()">‚öôÔ∏è</button>
<button class="btnVoltar" onclick="voltarTela()">‚Üê</button>

<!-- =========================
TELA ESCOLHA
========================= -->

<div id="telaEscolha" class="tela ativa">

<img src="logo-recanto.png" class="logoTopo">

<h1 style="margin-bottom:20px">
Como deseja pedir?
</h1>

<button class="btnEscolha"
onclick="definirModo('local')">
üçΩ Consumir no Local
</button>

<button class="btnEscolha"
onclick="definirModo('delivery')">
üõµ Delivery
</button>

</div>

<!-- =========================
TELA CARD√ÅPIO
========================= -->

<div id="telaCardapio" class="tela">

<div class="topo">
<b>Card√°pio</b>

<button class="adminBtn"
style="max-width:200px;background:#ff5722"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<div id="abas" class="abas"></div>
<div id="lista" class="lista"></div>

</div>

<!-- =========================
CARRINHO
========================= -->

<div id="carrinho">

<div style="
padding:20px;
font-weight:900;
font-size:20px;
display:flex;
justify-content:space-between;
align-items:center">

Seu Pedido

<button onclick="toggleCarrinho()"
style="
background:#ccc;
border:none;
border-radius:10px;
padding:8px 10px">
X
</button>

</div>

<div id="cLista" class="cLista"></div>

<div style="padding:18px">

<div id="linhaFrete"
style="
display:none;
margin-bottom:10px;
font-weight:900;
color:#c62828">

üöö Taxa de Entrega:
R$ <span id="freteTxt">0.00</span>

</div>

<b style="font-size:22px">
Total:
R$ <span id="total">0.00</span>
</b>

</div>

<button class="btnFinalizarCarrinho"
onclick="irCheckout()">
FINALIZAR PEDIDO
</button>

</div>
<!-- =========================
TELA CHECKOUT
========================= -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:16px">
Finalizar Pedido
</h2>

<div class="checkoutResumo">

<div style="font-weight:900;margin-bottom:10px;font-size:18px">
Resumo do Pedido
</div>

<div id="checkoutItens"></div>

<div style="margin-top:12px;font-weight:900;font-size:18px">
Total: R$ <span id="checkoutTotal">0.00</span>
</div>

</div>

<div class="form">

<select id="tipoPedido">
<option value="local">Consumir no local</option>
<option value="entrega">Entrega</option>
</select>

<div id="boxMesa">
<input id="mesaInput" placeholder="N√∫mero da mesa (opcional)">
</div>

<input id="nome" placeholder="Nome do cliente">
<input id="telefone" placeholder="Telefone">

<div id="boxEndereco" style="display:none">

<input id="rua" placeholder="Rua">
<input id="bairro" placeholder="Bairro">
<input id="numero" placeholder="N√∫mero">

</div>

<select id="pagamento">
<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>
</select>

<div id="boxTroco" style="display:none">
<input id="troco" placeholder="Troco para quanto?">
</div>

<!-- =========================
PIX
========================= -->

<div id="boxPix" class="pixBox" style="display:none">

<div style="font-weight:900">Chave PIX</div>

<div style="font-size:18px;font-weight:900">
<span id="pixChaveTxt"></span>
</div>

<button class="btnCopiarPix" onclick="copiarPix()">
COPIAR CHAVE PIX
</button>

<div style="font-weight:900">
Valor: R$ <span id="pixValorTxt">0.00</span>
</div>

<button class="adminBtn"
style="background:#25d366"
onclick="abrirZapComprovante()">
Enviar comprovante no WhatsApp
</button>

<label style="display:flex;gap:8px;align-items:center;justify-content:center">
<input type="checkbox" id="pixJaEnviei">
J√° enviei comprovante
</label>

<input type="file"
id="pixArquivo"
accept="image/*,application/pdf">

</div>

<button class="btnFinalizarCarrinho"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>

<!-- =========================
TELA ADMIN
========================= -->

<div id="telaAdmin" class="tela">

<h2 style="margin-bottom:18px">Painel Admin</h2>

<div class="adminBox">

<b>Pedidos ao Vivo</b>

<div id="adminPedidos"
style="margin-top:12px;font-size:14px"></div>

</div>

<div class="adminBox">

<b>Relat√≥rios</b>

<button class="adminBtn" onclick="relatorioHoje()">Hoje</button>
<button class="adminBtn" onclick="relatorioMes()">M√™s</button>
<button class="adminBtn" onclick="relatorioAno()">Ano</button>
<button class="adminBtn" onclick="exportarExcel()">Exportar Excel</button>
<button class="adminBtn" onclick="zerarRelatorios()">Zerar Dados</button>

</div>

<div class="adminBox">

<b>Gerenciar Card√°pio</b>

<button class="adminBtn" onclick="adminNovaAba()">Nova Aba</button>
<button class="adminBtn" onclick="abrirNovoProdutoUI()">Adicionar Produto</button>
<button class="adminBtn" onclick="abrirEditorItens()">Editar Produtos</button>
<button class="adminBtn" onclick="abrirRemoverAbaUI()">Remover Aba</button>

</div>

</div>

<!-- =========================
EDITOR PRODUTOS
========================= -->

<div id="telaEditorItens" class="tela">
<h2 style="margin-bottom:18px">Editor de Produtos</h2>
<div id="listaEditor" class="lista"></div>
</div>

<!-- =========================
REMOVER ABA
========================= -->

<div id="uiRemoverAba" class="tela">
<h2 style="margin-bottom:18px">Remover Aba</h2>
<div id="listaAbasRemover" class="lista"></div>
</div>

<!-- =========================
NOVO PRODUTO
========================= -->

<div id="uiNovoProduto" class="tela">

<h2 style="margin-bottom:18px">Novo Produto</h2>

<div class="form">

<input id="novoProdNome" placeholder="Nome do produto">
<input id="novoProdPreco" placeholder="Pre√ßo">

<select id="novoProdAba"></select>

<button class="btnFinalizarCarrinho"
onclick="confirmarNovoProduto()">
Salvar Produto
</button>

</div>

</div>

<!-- =========================
IN√çCIO SCRIPT
========================= -->

<script type="module">

/* =========================
CONFIGURA√á√ïES
========================= */

const ADMIN_SENHA = "1234"
let WHATSAPP_LOJA = "5549991610137"
let PIX_CHAVE = "pix-recanto@pix"

let modoPedido = null
let valorFrete = 0
let pixComprovanteOK = false
let primeiraCarga = true

let carrinho = []
let pedidosCache = []
/* =========================
FIREBASE
========================= */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore,
collection,
addDoc,
onSnapshot,
getDocs,
deleteDoc
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig = {
apiKey:"AIzaSyCE6daBipSq0Xjxt3ofW9anxMdN-AecI4w",
authDomain:"recanto-do-pastel-bcea2.firebaseapp.com",
projectId:"recanto-do-pastel-bcea2",
storageBucket:"recanto-do-pastel-bcea2.firebasestorage.app",
messagingSenderId:"304374292790",
appId:"1:304374292790:web:5bd235b7c0419a8dfe1397"
}

const app = initializeApp(firebaseConfig)
const db = getFirestore(app)

/* =========================
UTIL
========================= */

const qs = id => document.getElementById(id)

/* =========================
CONTROLE DE TELAS
========================= */

function mostrar(id){
document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))
qs(id).classList.add("ativa")
}

/* Fecha carrinho sempre que troca tela */
function fecharCarrinho(){
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"
}

/* Voltar sempre reinicia escolha */
window.voltarTela = ()=>{
fecharCarrinho()
resetarSistema()
mostrar("telaEscolha")
}

window.abrirAdmin = ()=>{
let s = prompt("Senha admin")
if(s !== ADMIN_SENHA){
alert("Senha incorreta")
return
}
fecharCarrinho()
mostrar("telaAdmin")
}

/* =========================
RESET COMPLETO
========================= */

function resetarSistema(){
carrinho=[]
valorFrete=0
pixComprovanteOK=false
modoPedido=null
renderCarrinho()
qs("lista").innerHTML=""
qs("abas").innerHTML=""
}

/* =========================
CARD√ÅPIO COMPLETO
========================= */

let cardapio = {

/* =========================
PAST√âIS SALGADOS P
========================= */

"Past√©is Salgados P":[
{nome:"Aipim c/ Bacon P",preco:17},
{nome:"Bacon P",preco:17},
{nome:"Br√≥colis P",preco:17},
{nome:"Calabresa P",preco:17},
{nome:"Camar√£o P",preco:20},
{nome:"Carne P",preco:17},
{nome:"Carne c/ Ovos P",preco:17},
{nome:"Cora√ß√£o de Frango P",preco:18},
{nome:"Crocante P",preco:17},
{nome:"Frango c/ Catupiry P",preco:17},
{nome:"Lombinho P",preco:17},
{nome:"Milho P",preco:17},
{nome:"Napolitana P",preco:17},
{nome:"Ovo P",preco:17},
{nome:"Palmito P",preco:17},
{nome:"Paulista P",preco:17},
{nome:"Portuguesa P",preco:17},
{nome:"Quatro Queijos P",preco:17},
{nome:"Romana P",preco:17},
{nome:"Pizza P",preco:17},
{nome:"Hot Dog P",preco:17},
{nome:"Do Chef P",preco:17},
{nome:"Vegetariana P",preco:17},
{nome:"Strogonoff P",preco:17},
{nome:"Especial (5 Sabores) P",preco:18}
],

/* =========================
PAST√âIS SALGADOS G
========================= */

"Past√©is Salgados G":[
{nome:"Aipim c/ Bacon G",preco:22},
{nome:"Bacon G",preco:22},
{nome:"Br√≥colis G",preco:22},
{nome:"Calabresa G",preco:22},
{nome:"Camar√£o G",preco:29},
{nome:"Carne G",preco:22},
{nome:"Carne c/ Ovos G",preco:22},
{nome:"Cora√ß√£o de Frango G",preco:22},
{nome:"Crocante G",preco:22},
{nome:"Frango c/ Catupiry G",preco:22},
{nome:"Lombinho G",preco:22},
{nome:"Milho G",preco:22},
{nome:"Napolitana G",preco:22},
{nome:"Ovo G",preco:22},
{nome:"Palmito G",preco:22},
{nome:"Paulista G",preco:22},
{nome:"Portuguesa G",preco:22},
{nome:"Quatro Queijos G",preco:22},
{nome:"Romana G",preco:22},
{nome:"Pizza G",preco:22},
{nome:"Hot Dog G",preco:22},
{nome:"Do Chef G",preco:22},
{nome:"Vegetariana G",preco:22},
{nome:"Strogonoff G",preco:22},
{nome:"Especial (5 Sabores) G",preco:24}
],

/* =========================
PAST√âIS DOCES P
========================= */

"Past√©is Doces P":[
{nome:"Banana P",preco:17},
{nome:"Chocolate Preto P",preco:17},
{nome:"Chocolate Branco P",preco:17},
{nome:"Krot P",preco:17},
{nome:"Morango P",preco:17},
{nome:"Prest√≠gio P",preco:17},
{nome:"Romeu e Julieta P",preco:17},
{nome:"Sedu√ß√£o P",preco:17},
{nome:"Sonho de Valsa P",preco:17},
{nome:"Mocinha P",preco:17},
{nome:"Charge P",preco:17},
{nome:"Bob Marley P",preco:17},
{nome:"Choquito P",preco:17},
{nome:"Dois Amores P",preco:17},
{nome:"Ouro Branco P",preco:17}
],

/* =========================
PAST√âIS DOCES G
========================= */

"Past√©is Doces G":[
{nome:"Banana G",preco:22},
{nome:"Chocolate Preto G",preco:22},
{nome:"Chocolate Branco G",preco:22},
{nome:"Krot G",preco:22},
{nome:"Morango G",preco:22},
{nome:"Prest√≠gio G",preco:22},
{nome:"Romeu e Julieta G",preco:22},
{nome:"Sedu√ß√£o G",preco:22},
{nome:"Sonho de Valsa G",preco:22},
{nome:"Mocinha G",preco:22},
{nome:"Charge G",preco:22},
{nome:"Bob Marley G",preco:22},
{nome:"Choquito G",preco:22},
{nome:"Dois Amores G",preco:22},
{nome:"Ouro Branco G",preco:22}
],

/* =========================
LANCHES
========================= */

"Lanches":[
{nome:"X-Burger",preco:16},
{nome:"X-Salada",preco:22},
{nome:"X-Bacon",preco:28},
{nome:"X-Calabresa",preco:28},
{nome:"X-Egg",preco:28},
{nome:"X-Dog",preco:28},
{nome:"X-Tudo",preco:38}
],

/* =========================
POR√á√ïES
========================= */

"Por√ß√µes Inteira":[
{nome:"Anel de Cebola",preco:28},
{nome:"Polenta",preco:26},
{nome:"Aipim",preco:26},
{nome:"Fritas",preco:26},
{nome:"Til√°pia",preco:50},
{nome:"Bolinho de Bacalhau",preco:42},
{nome:"Camar√£o",preco:70}
],

"Por√ß√µes Meia":[
{nome:"Anel de Cebola (Meia)",preco:17},
{nome:"Polenta (Meia)",preco:16},
{nome:"Aipim (Meia)",preco:16},
{nome:"Fritas (Meia)",preco:16},
{nome:"Til√°pia (Meia)",preco:25},
{nome:"Bolinho de Bacalhau (Meia)",preco:24}
],

"Prato Feito":[
{nome:"Prato Feito",preco:30}
],

/* =========================
BEBIDAS
========================= */

"Bebidas":[
{nome:"Brahma",preco:12},
{nome:"Original",preco:15},
{nome:"Kaiser",preco:9},
{nome:"Heineken",preco:16},
{nome:"√Ågua Mineral",preco:4},
{nome:"Vinho Ta√ßa",preco:10}
],

"Refrigerantes":[
{nome:"KS",preco:5},
{nome:"Lata",preco:6},
{nome:"600ml",preco:9},
{nome:"1 Litro",preco:11}
],

"Sucos":[
{nome:"Abacaxi",preco:9},
{nome:"Abacaxi c/ Hortel√£",preco:9},
{nome:"Manga",preco:9},
{nome:"Morango",preco:9},
{nome:"Uva",preco:9},
{nome:"Lim√£o",preco:9},
{nome:"Maracuj√°",preco:9}
],

"Doses":[
{nome:"Campari",preco:8},
{nome:"Jack Daniels",preco:15}
],

"Caipiras":[
{nome:"Vinho",preco:22},
{nome:"Bacardi",preco:22},
{nome:"Raiska",preco:22},
{nome:"Steinhaeger",preco:22}
],

"Batidas":[
{nome:"Batida",preco:14}
],

"Vitaminas":[
{nome:"Vitamina",preco:12}
]

}
/* =========================
ESCOLHER MODO
========================= */

window.definirModo = (modo)=>{
modoPedido = modo

/* limpa qualquer estado anterior */
resetarSistema()

mostrar("telaCardapio")
renderAbas()
}

/* =========================
FILTRO DELIVERY (REMOVE ABAS INTEIRAS)
========================= */

function abaPermitidaDelivery(nomeAba){

if(modoPedido !== "delivery") return true

let a = nomeAba.toLowerCase()

if(
a.includes("sucos") ||
a.includes("doses") ||
a.includes("caip") ||
a.includes("batida") ||
a.includes("vitamina")
){
return false
}

return true
}

/* =========================
RENDER ABAS
========================= */

function renderAbas(){

qs("abas").innerHTML=""
qs("lista").innerHTML=""

Object.keys(cardapio).forEach(aba=>{

if(!abaPermitidaDelivery(aba)) return

let btn = document.createElement("button")
btn.className="aba"
btn.innerText = aba

btn.onclick = ()=>{
renderItens(aba)
}

qs("abas").appendChild(btn)

})

}

/* =========================
RENDER ITENS
========================= */

function renderItens(aba){

qs("lista").innerHTML=""

if(!cardapio[aba]) return

cardapio[aba].forEach(produto=>{

let el = document.createElement("div")
el.className="item"

el.innerHTML = `
<div class="itemNome">${produto.nome}</div>
<div class="itemPreco">
R$ ${produto.preco.toFixed(2)}
</div>
<button class="btnAdd">Adicionar</button>
`

el.querySelector("button").onclick=()=>{
addCarrinho(produto)
}

qs("lista").appendChild(el)

})

}

/* =========================
CARRINHO
========================= */

function totalItens(){
return carrinho.reduce((s,i)=>s+i.preco*i.qtd,0)
}

function totalGeral(){
return totalItens() + valorFrete
}

function addCarrinho(produto){

let existe = carrinho.find(i=>i.nome===produto.nome)

if(existe){
existe.qtd++
}else{
carrinho.push({...produto,qtd:1})
}

qs("carrinho").classList.add("aberto")
document.body.style.overflow="hidden"

renderCarrinho()
}

window.removerItem = nome=>{
carrinho = carrinho.filter(i=>i.nome!==nome)
renderCarrinho()

if(!carrinho.length){
fecharCarrinho()
}
}

window.toggleCarrinho = ()=>{
let aberto = qs("carrinho").classList.toggle("aberto")
document.body.style.overflow = aberto ? "hidden" : "auto"
}

/* =========================
FRETE AUTOM√ÅTICO
========================= */

function calcularFreteAutomatico(){

if(modoPedido !== "delivery"){
valorFrete = 0
return
}

let bairro = qs("bairro")?.value || ""
bairro = bairro.toLowerCase()

if(
bairro.includes("igaras") ||
bairro.includes("igarinha")
){
valorFrete = 10
}else{
valorFrete = 8
}

}

/* =========================
RENDER CARRINHO
========================= */

function renderCarrinho(){

qs("cLista").innerHTML=""
let qtdTotal = 0

carrinho.forEach(i=>{
qtdTotal += i.qtd

let div = document.createElement("div")
div.className="cItem"

div.innerHTML=`
<div style="text-align:center;width:100%">
<b style="font-size:17px">${i.qtd}x ${i.nome}</b><br>
<span style="color:#e65100;font-weight:700">
R$ ${(i.qtd*i.preco).toFixed(2)}
</span>
</div>
<button onclick="removerItem('${i.nome}')">X</button>
`

qs("cLista").appendChild(div)
})

qs("qtd").innerText=qtdTotal
qs("total").innerText=totalGeral().toFixed(2)

/* exibir frete */

if(valorFrete>0){
qs("linhaFrete").style.display="block"
qs("freteTxt").innerText=valorFrete.toFixed(2)
}else{
qs("linhaFrete").style.display="none"
}

renderCheckoutResumo()
}

/* =========================
IR PARA CHECKOUT
========================= */

window.irCheckout = ()=>{

if(!carrinho.length) return

fecharCarrinho()
mostrar("telaCheckout")
renderCheckoutResumo()
atualizarPix()

if(qs("pagamento")){
qs("pagamento")
.dispatchEvent(new Event("change"))
}

}

/* =========================
FINALIZAR PEDIDO
========================= */

window.finalizarPedido = async()=>{

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){
alert("Preencha nome e telefone")
return
}

if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX para finalizar")
return
}

/* monta pedido */

let pedido = {
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
data:new Date().toISOString()
}

/* salva firebase */

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log(e)
}

/* mensagem whatsapp limpa */

let txt = "*RECANTO DO PASTEL*%0A%0A"

carrinho.forEach(i=>{
txt += `${i.qtd}x ${i.nome} - R$ ${(i.qtd*i.preco).toFixed(2)}%0A`
})

if(valorFrete>0){
txt += `%0ATaxa entrega: R$ ${valorFrete.toFixed(2)}%0A`
}

txt += `%0ATotal: R$ ${pedido.total.toFixed(2)}`

window.open(`https://wa.me/${WHATSAPP_LOJA}?text=${txt}`)

/* RESET COMPLETO */

resetarSistema()
fecharCarrinho()
mostrar("telaEscolha")

}
/* =========================
FECHAR CARRINHO FOR√áADO
========================= */

function fecharCarrinho(){
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"
}

/* =========================
RESET TOTAL DO SISTEMA
========================= */

function resetarSistema(){

/* limpa carrinho */
carrinho = []
valorFrete = 0
pixComprovanteOK = false

/* limpa campos */
if(qs("nome")) qs("nome").value=""
if(qs("telefone")) qs("telefone").value=""
if(qs("rua")) qs("rua").value=""
if(qs("bairro")) qs("bairro").value=""
if(qs("numero")) qs("numero").value=""
if(qs("troco")) qs("troco").value=""
if(qs("mesaInput")) qs("mesaInput").value=""

/* reset selects */
if(qs("tipoPedido")) qs("tipoPedido").value="local"
if(qs("pagamento")) qs("pagamento").value="PIX"

/* esconde blocos */
if(qs("boxEndereco")) qs("boxEndereco").style.display="none"
if(qs("boxMesa")) qs("boxMesa").style.display="block"
if(qs("boxTroco")) qs("boxTroco").style.display="none"
if(qs("boxPix")) qs("boxPix").style.display="none"

/* limpa listas */
if(qs("checkoutItens")) qs("checkoutItens").innerHTML=""
if(qs("lista")) qs("lista").innerHTML=""
if(qs("abas")) qs("abas").innerHTML=""

/* limpa totais */
if(qs("total")) qs("total").innerText="0.00"
if(qs("checkoutTotal")) qs("checkoutTotal").innerText="0.00"
if(qs("qtd")) qs("qtd").innerText="0"

}

/* =========================
CORRIGIR VOLTAR TELA
========================= */

window.voltarTela = ()=>{

fecharCarrinho()
resetarSistema()
mostrar("telaEscolha")

}

/* =========================
CORRIGIR TROCA DE TIPO PEDIDO
========================= */

if(qs("tipoPedido")){

qs("tipoPedido").onchange = e=>{

let tipo = e.target.value

if(tipo==="entrega"){

modoPedido="delivery"
qs("boxEndereco").style.display="block"
qs("boxMesa").style.display="none"

}else{

modoPedido="local"
qs("boxEndereco").style.display="none"
qs("boxMesa").style.display="block"
valorFrete=0

}

calcularFreteAutomatico()
renderCarrinho()
renderCheckoutResumo()

}

}

/* =========================
CORRIGIR PAGAMENTO
========================= */

if(qs("pagamento")){

qs("pagamento").onchange = e=>{

let p = e.target.value

if(qs("boxPix")){
qs("boxPix").style.display =
(p==="PIX") ? "block" : "none"
}

if(qs("boxTroco")){
qs("boxTroco").style.display =
(p==="Dinheiro") ? "block" : "none"
}

pixComprovanteOK=false

if(qs("pixJaEnviei")){
qs("pixJaEnviei").checked=false
}

renderCheckoutResumo()

}

}

/* =========================
GARANTIR FECHAMENTO AUTOM√ÅTICO
AO MUDAR DE TELA
========================= */

function mostrar(id){

document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))

qs(id).classList.add("ativa")

/* sempre fechar carrinho ao trocar tela */
if(id !== "telaCardapio"){
fecharCarrinho()
}

}

/* =========================
GARANTIR QUE N√ÉO FIQUE
ABA SELECIONADA AP√ìS RESET
========================= */

function limparAbasVisual(){

let abas = document.querySelectorAll(".aba")
abas.forEach(a=>a.classList.remove("ativa"))

}

/* =========================
QUANDO ENTRAR NO CARD√ÅPIO
COME√áA SEM ITENS ABERTOS
========================= */

window.definirModo = (modo)=>{

modoPedido = modo

resetarSistema()
mostrar("telaCardapio")
renderAbas()

}

/* =========================
AO INICIAR APP
GARANTE TELA INICIAL
========================= */

document.addEventListener("DOMContentLoaded",()=>{
mostrar("telaEscolha")
resetarSistema()
})

/* =========================
AJUSTE VISUAL PROFISSIONAL
========================= */

/* fundo mais limpo */
html,body{
background:#f5f5f5;
}

/* topo */
.topo b{
color:#222;
}

/* abas elegantes */
.aba{
background:#eeeeee;
color:#333;
border:1px solid #ddd;
transition:0.2s;
}

.aba:hover{
background:#e0e0e0;
}

.aba.ativa{
background:#ff5722;
color:white;
border-color:#ff5722;
}

/* itens */
.item{
border:1px solid #e0e0e0;
box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.itemNome{
color:#222;
}

.itemPreco{
color:#ff5722;
font-size:22px;
}

/* bot√£o adicionar */
.btnAdd{
background:#ff5722;
transition:0.2s;
}

.btnAdd:hover{
background:#e64a19;
}

/* carrinho */
#carrinho{
background:white;
}

.cItem{
border:1px solid #eee;
box-shadow:none;
}

/* checkout */
.checkoutResumo{
border:1px solid #eee;
box-shadow:none;
}

/* bot√µes admin mais discretos */
.adminBtn{
background:#333;
}

.adminBtn:hover{
background:#111;
}

/* bot√£o finalizar */
.btnFinalizarCarrinho{
background:#ff5722;
}

/* =========================
MARCAR ABA ATIVA
========================= */

function renderAbas(){

qs("abas").innerHTML=""

Object.keys(cardapio).forEach(aba=>{

let btn = document.createElement("button")
btn.className="aba"
btn.innerText = aba

btn.onclick = ()=>{

document.querySelectorAll(".aba")
.forEach(a=>a.classList.remove("ativa"))

btn.classList.add("ativa")
renderItens(aba)

}

qs("abas").appendChild(btn)

})

}

/* =========================
ENVIO WHATSAPP PROFISSIONAL
========================= */

function montarMensagemWhatsApp(pedido){

let texto = "üìã *RECANTO DO PASTEL*\n\n"

texto += `üë§ Cliente: ${pedido.cliente.nome}\n`
texto += `üìû Telefone: ${pedido.cliente.tel}\n`
texto += `üì¶ Tipo: ${pedido.modo === "delivery" ? "Delivery" : "Local"}\n\n`

texto += "üßæ *ITENS:*\n"

pedido.itens.forEach(i=>{
texto += `‚Ä¢ ${i.qtd}x ${i.nome} ‚Äî R$ ${(i.qtd*i.preco).toFixed(2)}\n`
})

if(pedido.frete>0){
texto += `\nüöö Entrega: R$ ${pedido.frete.toFixed(2)}`
}

texto += `\n\nüí∞ *TOTAL: R$ ${pedido.total.toFixed(2)}*`

return texto

}

/* =========================
SUBSTITUIR ENVIO ANTIGO
========================= */

window.finalizarPedido = async()=>{

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){
alert("Preencha nome e telefone")
return
}

if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX para finalizar")
return
}

let pedido = {
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
data:new Date().toISOString()
}

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log("Erro:",e)
}

/* nova mensagem autom√°tica */
let mensagem = montarMensagemWhatsApp(pedido)

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(mensagem)
}`
)

/* reset completo */
resetarSistema()
fecharCarrinho()
mostrar("telaEscolha")

}

/* =========================
GARANTIR QUE DELIVERY
N√ÉO MOSTRE ABAS BLOQUEADAS
========================= */

function renderAbas(){

qs("abas").innerHTML=""

Object.keys(cardapio).forEach(aba=>{

/* bloquear abas inteiras no delivery */
if(modoPedido==="delivery"){

let nomeAba = aba.toLowerCase()

if(
nomeAba.includes("sucos") ||
nomeAba.includes("doses") ||
nomeAba.includes("caip") ||
nomeAba.includes("batida") ||
nomeAba.includes("vitamina")
){
return
}

}

let btn = document.createElement("button")
btn.className="aba"
btn.innerText = aba

btn.onclick = ()=>{

document.querySelectorAll(".aba")
.forEach(a=>a.classList.remove("ativa"))

btn.classList.add("ativa")
renderItens(aba)

}

qs("abas").appendChild(btn)

})

}

/* =========================
FECHAR CARRINHO FOR√áADO
========================= */

function fecharCarrinho(){
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"
}

/* =========================
RESET COMPLETO DO SISTEMA
========================= */

function resetarSistema(){

carrinho = []
valorFrete = 0
pixComprovanteOK = false
modoPedido = null

/* limpar campos */
if(qs("nome")) qs("nome").value=""
if(qs("telefone")) qs("telefone").value=""
if(qs("rua")) qs("rua").value=""
if(qs("bairro")) qs("bairro").value=""
if(qs("numero")) qs("numero").value=""
if(qs("mesaInput")) qs("mesaInput").value=""
if(qs("troco")) qs("troco").value=""

if(qs("pixJaEnviei")) qs("pixJaEnviei").checked=false
if(qs("pixArquivo")) qs("pixArquivo").value=""

renderCarrinho()

/* limpar abas ativas */
document.querySelectorAll(".aba")
.forEach(a=>a.classList.remove("ativa"))

qs("lista").innerHTML=""
qs("abas").innerHTML=""

}

/* =========================
GARANTIR QUE NUNCA FIQUE PRESO
========================= */

window.addEventListener("pageshow",()=>{
resetarSistema()
mostrar("telaEscolha")
})

window.addEventListener("load",()=>{
resetarSistema()
mostrar("telaEscolha")
})

/* =========================
FECHAR TELAS AUTOM√ÅTICO
========================= */

function mostrar(id){

document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))

qs(id).classList.add("ativa")

/* sempre que trocar tela, fechar carrinho */
fecharCarrinho()

}

/* =========================
GARANTIR FINALIZA√á√ÉO LIMPA
========================= */

window.irCheckout = ()=>{

if(!carrinho.length) return

mostrar("telaCheckout")
renderCheckoutResumo()
atualizarPix()

if(qs("pagamento")){
qs("pagamento")
.dispatchEvent(new Event("change"))
}

}

/* =========================
AO FINALIZAR PEDIDO
========================= */

window.finalizarPedido = async()=>{

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){
alert("Preencha nome e telefone")
return
}

if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX para finalizar")
return
}

let pedido = {
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
data:new Date().toISOString()
}

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log("Erro:",e)
}

/* WhatsApp autom√°tico */
let mensagem = montarMensagemWhatsApp(pedido)

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(mensagem)
}`
)

/* RESET DEFINITIVO */
resetarSistema()
mostrar("telaEscolha")

}

/* =========================
GARANTIR QUE DELIVERY RECARREGA ABAS
========================= */

window.definirModo = (modo)=>{

modoPedido = modo

resetarSistema()

modoPedido = modo

mostrar("telaCardapio")
renderAbas()

}

/* =========================
PROTEGER CONTRA DUPLO CLIQUE
========================= */

let bloqueioFinalizacao = false

window.finalizarPedido = async()=>{

if(bloqueioFinalizacao) return
bloqueioFinalizacao = true

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){
alert("Preencha nome e telefone")
bloqueioFinalizacao=false
return
}

if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX para finalizar")
bloqueioFinalizacao=false
return
}

let pedido = {
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
data:new Date().toISOString()
}

try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){}

let mensagem = montarMensagemWhatsApp(pedido)

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(mensagem)
}`
)

resetarSistema()
mostrar("telaEscolha")

setTimeout(()=>{
bloqueioFinalizacao=false
},2000)

}
/* =========================
ABA ATIVA VISUAL LIMPA
========================= */

function marcarAbaAtiva(botao){

document.querySelectorAll(".aba")
.forEach(b=>{
b.style.background="#ffe0b2"
b.style.color="#bf360c"
})

botao.style.background="#ff9800"
botao.style.color="#ffffff"

}

/* =========================
RENDER ABAS EST√ÅVEL
========================= */

function renderAbas(){

qs("abas").innerHTML=""

Object.keys(cardapio).forEach((aba,index)=>{

/* se delivery, esconder abas bloqueadas */
if(modoPedido==="delivery"){

let a = aba.toLowerCase()

if(
a.includes("sucos") ||
a.includes("doses") ||
a.includes("caip") ||
a.includes("batida") ||
a.includes("vitamina")
){
return
}

}

let btn = document.createElement("button")
btn.className="aba"
btn.innerText = aba

btn.onclick = ()=>{
marcarAbaAtiva(btn)
renderItens(aba)
}

qs("abas").appendChild(btn)

/* abrir primeira aba automaticamente */
if(index===0){
setTimeout(()=>{
btn.click()
},50)
}

})

}

/* =========================
AGRUPAR TAMANHOS VISUALMENTE
========================= */

function organizarTamanhos(lista){

let agrupado = {}

lista.forEach(item=>{

let base = item.nome.replace(" P","").replace(" G","")

if(!agrupado[base]){
agrupado[base] = {}
}

if(item.nome.includes(" P")){
agrupado[base]["P"] = item.preco
}else if(item.nome.includes(" G")){
agrupado[base]["G"] = item.preco
}else{
agrupado[base]["√önico"] = item.preco
}

})

return agrupado

}

/* =========================
RENDER ITENS MELHORADO
========================= */

function renderItens(aba){

qs("lista").innerHTML=""

let produtos = cardapio[aba]

let organizados = organizarTamanhos(produtos)

Object.keys(organizados).forEach(nomeBase=>{

let tamanhos = organizados[nomeBase]

let el = document.createElement("div")
el.className="item"

let html = `<div class="itemNome">${nomeBase}</div>`

Object.keys(tamanhos).forEach(t=>{

html += `
<div style="font-size:18px;font-weight:700;color:#2e7d32">
${t==="√önico"?"":t+" - "}
R$ ${tamanhos[t].toFixed(2)}
</div>
`

})

html += `<button class="btnAdd">Adicionar</button>`

el.innerHTML = html

el.querySelector("button").onclick=()=>{

/* se tiver P e G, perguntar */
if(tamanhos["P"] && tamanhos["G"]){

let escolha = confirm("OK = Pequeno | Cancelar = Grande")

if(escolha){
addCarrinho({nome:nomeBase+" P",preco:tamanhos["P"]})
}else{
addCarrinho({nome:nomeBase+" G",preco:tamanhos["G"]})
}

}else{

let preco = tamanhos["√önico"] || tamanhos["P"] || tamanhos["G"]

addCarrinho({nome:nomeBase,preco:preco})

}

}

qs("lista").appendChild(el)

})

}

/* =========================
LAYOUT MENOS CARNAVAL
========================= */

document.querySelectorAll(".item")
.forEach(el=>{
el.style.boxShadow="0 4px 10px rgba(0,0,0,.08)"
})

document.querySelectorAll(".aba")
.forEach(el=>{
el.style.background="#ffe0b2"
})

/* =========================
WHATSAPP FORMATADO BONITO
========================= */

function montarMensagemWhatsApp(pedido){

let msg = `ü•ü *RECANTO DO PASTEL*\n\n`

msg += `üë§ Cliente: ${pedido.cliente.nome}\n`
msg += `üì± Telefone: ${pedido.cliente.tel}\n\n`

msg += `üßæ *Itens do Pedido:*\n`

pedido.itens.forEach(i=>{
msg += `‚Ä¢ ${i.qtd}x ${i.nome} - R$ ${(i.qtd*i.preco).toFixed(2)}\n`
})

if(pedido.frete>0){
msg += `\nüöö Frete: R$ ${pedido.frete.toFixed(2)}`
}

msg += `\n\nüí∞ *Total: R$ ${pedido.total.toFixed(2)}*`

if(pedido.modo==="delivery"){
msg += `\n\nüõµ Tipo: Delivery`
}else{
msg += `\n\nüçΩ Tipo: Local`
}

return msg

}

/* =========================
GARANTIR QUE N√ÉO FIQUE EM ABA ANTIGA
========================= */

window.voltarTela = ()=>{
resetarSistema()
mostrar("telaEscolha")
}
/* =========================
RESET TOTAL DO SISTEMA
========================= */

function resetarSistema(){

/* limpar carrinho */
carrinho = []
valorFrete = 0
pixComprovanteOK = false

/* fechar carrinho */
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"

/* limpar visual */
if(qs("cLista")) qs("cLista").innerHTML=""
if(qs("qtd")) qs("qtd").innerText="0"
if(qs("total")) qs("total").innerText="0.00"
if(qs("checkoutItens")) qs("checkoutItens").innerHTML=""
if(qs("checkoutTotal")) qs("checkoutTotal").innerText="0.00"
if(qs("linhaFrete")) qs("linhaFrete").style.display="none"

/* limpar formul√°rio */
if(qs("nome")) qs("nome").value=""
if(qs("telefone")) qs("telefone").value=""
if(qs("rua")) qs("rua").value=""
if(qs("bairro")) qs("bairro").value=""
if(qs("numero")) qs("numero").value=""
if(qs("mesaInput")) qs("mesaInput").value=""
if(qs("troco")) qs("troco").value=""

if(qs("pixJaEnviei")) qs("pixJaEnviei").checked=false
if(qs("pixArquivo")) qs("pixArquivo").value=""

/* esconder caixas */
if(qs("boxEndereco")) qs("boxEndereco").style.display="none"
if(qs("boxPix")) qs("boxPix").style.display="none"
if(qs("boxTroco")) qs("boxTroco").style.display="none"

/* reset modo */
modoPedido = null

/* remover aba ativa */
document.querySelectorAll(".aba")
.forEach(b=>{
b.style.background="#ffe0b2"
b.style.color="#bf360c"
})

}

/* =========================
FINALIZAR PEDIDO DEFINITIVO
========================= */

window.finalizarPedido = async()=>{

let nome = qs("nome")?.value
let tel  = qs("telefone")?.value
let tipo = qs("tipoPedido")?.value
let pag  = qs("pagamento")?.value

if(!nome || !tel){
alert("Preencha nome e telefone")
return
}

/* validar PIX delivery */
if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX para finalizar")
return
}

/* montar pedido */
let pedido = {
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
frete:valorFrete,
modo:modoPedido,
data:new Date().toISOString()
}

/* salvar */
try{
await addDoc(collection(db,"pedidos"),pedido)
}catch(e){
console.log("Erro salvar:",e)
}

/* mensagem autom√°tica */
let mensagem = montarMensagemWhatsApp(pedido)

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(mensagem)
}`
)

/* RESET COMPLETO */
resetarSistema()

/* voltar para tela inicial */
mostrar("telaEscolha")

}

/* =========================
GARANTIR QUE AO SAIR E VOLTAR N√ÉO FIQUE EM ABA
========================= */

window.addEventListener("pageshow",()=>{
resetarSistema()
mostrar("telaEscolha")
})

/* =========================
GARANTIR QUE DELIVERY N√ÉO MOSTRE ABAS BLOQUEADAS
========================= */

window.definirModo = (modo)=>{
resetarSistema()
modoPedido = modo
mostrar("telaCardapio")
renderAbas()
}

/* =========================
FECHAR TELA AO ABRIR OUTRA
========================= */

function mostrar(id){

document.querySelectorAll(".tela")
.forEach(t=>{
t.classList.remove("ativa")
})

qs(id).classList.add("ativa")

/* fechar carrinho ao mudar tela */
qs("carrinho").classList.remove("aberto")
document.body.style.overflow="auto"

}

/* =========================
INICIALIZA√á√ÉO FINAL
========================= */

async function initSistema(){

await carregarCardapioFirebase()

renderAbas()

resetarSistema()

mostrar("telaEscolha")

}

initSistema()

/* =========================
FIM DEFINITIVO DO SISTEMA
========================= */

</script>
</body>
</html>
