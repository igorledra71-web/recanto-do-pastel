<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Recanto do Pastel</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
html,body{height:100%;background:#fff7e6}

/* telas */

.tela{
position:fixed;
inset:0;
display:none;
flex-direction:column;
align-items:center;
padding:14px;
overflow:auto;
}
.tela.ativa{display:flex}

/* engrenagem */

.btnConfig{
position:fixed;
top:12px;
right:14px;
z-index:4000;
font-size:26px;
background:white;
border:none;
border-radius:14px;
padding:10px;
box-shadow:0 4px 12px rgba(0,0,0,.2);
}

/* voltar */

.btnVoltarGlobal{
position:fixed;
bottom:12px;
left:12px;
z-index:3000;
background:#333;
color:white;
border:none;
border-radius:14px;
padding:12px 16px;
font-weight:700;
}

/* inicial */

#telaInicial{
justify-content:center;
text-align:center;
background:linear-gradient(180deg,#ff9800,#ff5722);
color:white;
}

.logoImg{
width:85vw;
max-width:520px;
margin-top:40px;
margin-bottom:10px;
filter:drop-shadow(0 12px 24px rgba(0,0,0,.35));
}

.logoNome{
font-size:26px;
font-weight:700;
margin-bottom:28px;
}

.btnPrincipal{
background:white;
color:#ff5722;
padding:18px;
border-radius:16px;
font-size:20px;
font-weight:700;
border:none;
width:100%;
max-width:320px;
margin-top:30px;
}

/* card√°pio */

.topo{
width:100%;
max-width:680px;
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}

.abas{
display:flex;
gap:8px;
overflow-x:auto;
width:100%;
max-width:680px;
}

.aba{
background:#ffe0b2;
border:none;
padding:12px 16px;
border-radius:20px;
font-weight:600;
white-space:nowrap;
font-size:15px;
}

.lista{
width:100%;
max-width:680px;
display:flex;
flex-direction:column;
gap:14px;
padding-bottom:140px;
}

.item{
background:white;
border-radius:18px;
padding:16px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 4px 14px rgba(0,0,0,.12);
gap:12px;
min-height:72px;
}

.btnAdd{
background:#4caf50;
color:white;
border:none;
border-radius:14px;
padding:14px 18px;
font-weight:700;
font-size:18px;
}

/* carrinho */

#carrinho{
position:fixed;
top:0;
right:-100%;
width:92%;
max-width:420px;
height:100%;
background:#f7f7f7;
box-shadow:-8px 0 24px rgba(0,0,0,.25);
transition:.35s;
display:flex;
flex-direction:column;
z-index:2000;
border-top-left-radius:18px;
border-bottom-left-radius:18px;
}

#carrinho.aberto{right:0}

.cLista{
flex:1;
overflow:auto;
padding:16px;
display:flex;
flex-direction:column;
gap:12px;
}

.cItem{
background:white;
border-radius:14px;
padding:12px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 2px 8px rgba(0,0,0,.12);
font-size:16px;
}

.btnFinalizarCarrinho{
margin:12px;
padding:16px;
border-radius:14px;
font-size:18px;
font-weight:700;
background:#ff5722;
color:white;
border:none;
}

/* form */

.form{
width:100%;
max-width:680px;
display:flex;
flex-direction:column;
gap:12px;
}

input,select{
padding:14px;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
width:100%;
}

/* admin */

#telaAdmin{background:#212121;color:white}

.adminBox{
background:#424242;
padding:12px;
border-radius:12px;
margin-bottom:12px;
width:100%;
max-width:680px;
}

.adminBtn{
background:#ff9800;
border:none;
color:white;
padding:12px;
border-radius:10px;
margin-top:6px;
width:100%;
font-weight:700;
}

/* comprovante pix */

.pixProofBox{
background:#fff3e0;
border-radius:14px;
padding:12px;
display:flex;
flex-direction:column;
gap:8px;
}

</style>
</head>
<body>
<!-- ‚öôÔ∏è ADMIN -->

<button class="btnConfig"
onclick="abrirConfig()">‚öôÔ∏è</button>

<button class="btnVoltarGlobal"
onclick="voltarUniversal()">‚Üê VOLTAR</button>

<!-- =========================
TELA INICIAL
========================= -->

<div id="telaInicial" class="tela ativa">

<div style="
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100%;
width:100%;
">

<img src="logo-recanto.png" class="logoImg">

<div class="logoNome">
Recanto do Pastel
</div>

<button class="btnPrincipal"
onclick="abrirCardapio()">
FAZER PEDIDO
</button>

</div>
</div>

<!-- =========================
CARD√ÅPIO
========================= -->

<div id="telaCardapio" class="tela">

<div class="topo">
<b>Card√°pio</b>

<button class="adminBtn"
style="max-width:180px;background:#ff5722"
onclick="toggleCarrinho()">
Carrinho (<span id="qtd">0</span>)
</button>
</div>

<div id="abas" class="abas"></div>
<div id="lista" class="lista"></div>

</div>

<!-- =========================
CARRINHO
========================= -->

<div id="carrinho">

<div style="
padding:16px;
font-weight:700;
font-size:18px;
display:flex;
justify-content:space-between;
align-items:center">

Seu Pedido

<button onclick="toggleCarrinho()"
style="
background:#ccc;
border:none;
border-radius:10px;
padding:8px 10px">
X
</button>

</div>

<div id="cLista" class="cLista"></div>

<div style="padding:12px">

<div id="linhaFreteCarrinho"
style="display:none;margin-bottom:6px">
Frete: R$
<span id="freteCarrinhoTxt">0.00</span>
</div>

<b style="font-size:18px">
Total R$
<span id="total">0.00</span>
</b>

</div>

<button class="btnFinalizarCarrinho"
onclick="irCheckout()">
FINALIZAR
</button>

</div>
<!-- =========================
CHECKOUT
========================= -->

<div id="telaCheckout" class="tela">

<h2 style="margin-bottom:12px">
Finalizar Pedido
</h2>

<div class="form">

<select id="tipoPedido">

<option value="local">
Consumir no local
</option>

<option value="entrega">
Entrega
</option>

</select>

<!-- MESA -->

<div id="boxMesa">
<input id="mesaInput"
placeholder="N√∫mero da mesa (opcional)">
</div>

<input id="nome"
placeholder="Nome do cliente">

<input id="telefone"
placeholder="Telefone">

<!-- ENDERE√áO ENTREGA -->

<div id="boxEndereco" style="display:none">

<input id="rua" placeholder="Rua">
<input id="bairro" placeholder="Bairro">
<input id="numero" placeholder="N√∫mero">

</div>

<!-- PAGAMENTO -->

<select id="pagamento">
<option>PIX</option>
<option>D√©bito</option>
<option>Cr√©dito</option>
<option>Dinheiro</option>
</select>

<!-- TROCO -->

<div id="boxTroco" style="display:none">
<input id="troco" placeholder="Troco para quanto?">
</div>

<!-- PIX BOX -->

<div id="boxPix" style="display:none" class="pixProofBox">

<div>
<b>Chave PIX</b><br>
<span id="pixChaveTxt"></span>
</div>

<div>
<b>Valor PIX</b><br>
R$ <span id="pixValorTxt">0.00</span>
</div>

<button class="adminBtn"
style="background:#25d366"
onclick="abrirZapComprovante()">
Enviar comprovante no WhatsApp
</button>

<label style="display:flex;gap:8px;align-items:center">
<input type="checkbox" id="pixJaEnviei">
J√° enviei comprovante
</label>

<input type="file"
id="pixArquivo"
accept="image/*,application/pdf">

</div>

<input id="frete" value="0" readonly>

<button id="btnFinalizarPedido"
class="btnPrincipal"
style="background:#ff5722;color:white"
onclick="finalizarPedido()">
ENVIAR PEDIDO
</button>

</div>
</div>
<!-- =========================
PAINEL ADMIN
========================= -->

<div id="telaAdmin" class="tela">

<h2 style="margin-bottom:14px">
Painel Admin
</h2>

<div class="adminBox">

<b>Abas do Card√°pio</b>

<button class="adminBtn"
onclick="adminNovaAba()">
Nova Aba
</button>

<button class="adminBtn"
onclick="abrirRemoverAbaUI()">
Remover Aba (lista)
</button>

</div>

<div class="adminBox">

<b>Produtos</b>

<button class="adminBtn"
onclick="abrirNovoProdutoUI()">
Adicionar Produto
</button>

<button class="adminBtn"
onclick="abrirEditorItens()">
Editar / Remover Produtos
</button>

</div>

<div class="adminBox">

<b>Pedidos ao Vivo</b>
<div id="adminPedidos"></div>

</div>

<div class="adminBox">

<b>Relat√≥rios</b>

<button class="adminBtn"
onclick="relatorioHoje()">Hoje</button>

<button class="adminBtn"
onclick="relatorioMes()">M√™s</button>

<button class="adminBtn"
onclick="relatorioAno()">Ano</button>

<button class="adminBtn"
onclick="exportarExcel()">Exportar Excel</button>

<button class="adminBtn"
onclick="zerarRelatorios()">Zerar Dados</button>

</div>

</div>

<!-- =========================
EDITOR PRODUTOS
========================= -->

<div id="telaEditorItens" class="tela">

<h2>Editor de Produtos</h2>
<div id="listaEditor" class="lista"></div>

</div>

<!-- =========================
UI REMOVER ABA
========================= -->

<div id="uiRemoverAba" class="tela">

<h2>Remover Aba</h2>
<div id="listaAbasRemover" class="lista"></div>

</div>

<!-- =========================
UI NOVO PRODUTO
========================= -->

<div id="uiNovoProduto" class="tela">

<h2>Novo Produto</h2>

<div class="form">

<input id="novoProdNome"
placeholder="Nome do produto">

<input id="novoProdPreco"
placeholder="Pre√ßo">

<select id="novoProdAba"></select>

<button class="btnPrincipal"
onclick="confirmarNovoProduto()">
Salvar Produto
</button>

</div>

</div>
<script type="module">

/* =========================
CONFIG
========================= */

const ADMIN_SENHA="1234"
let WHATSAPP_LOJA="5599999999999"
let PIX_CHAVE="pix-recanto@pix"

/* =========================
FIREBASE
========================= */

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"

import {
getFirestore, collection, addDoc,
onSnapshot, getDocs, deleteDoc, doc
} from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"

const firebaseConfig={
apiKey:"AIzaSyCE6daBipSq0Xjxt3ofW9anxMdN-AecI4w",
authDomain:"recanto-do-pastel-bcea2.firebaseapp.com",
projectId:"recanto-do-pastel-bcea2",
storageBucket:"recanto-do-pastel-bcea2.firebasestorage.app",
messagingSenderId:"304374292790",
appId:"1:304374292790:web:5bd235b7c0419a8dfe1397"
}

let db=null
try{ db=getFirestore(initializeApp(firebaseConfig)) }catch(e){}

/* =========================
ESTADO
========================= */

let carrinho=[]
let pedidosCache=[]
let historico=["telaInicial"]
let pixComprovanteOK=false

let cardapio={
"Past√©is":[
{nome:"Pastel Carne",preco:12},
{nome:"Pastel Queijo",preco:11}
],
"Bebidas":[
{nome:"Refri",preco:6}
]
}

/* =========================
UTIL
========================= */

const qs=id=>document.getElementById(id)

function mostrar(id){
document.querySelectorAll(".tela")
.forEach(t=>t.classList.remove("ativa"))
qs(id).classList.add("ativa")
historico.push(id)
}

window.voltarUniversal=()=>{
historico.pop()
mostrar(historico.pop()||"telaInicial")
}

/* =========================
ADMIN LOGIN
========================= */

window.abrirConfig=()=>{
let s=prompt("Senha admin")
if(s!==ADMIN_SENHA) return alert("Senha incorreta")
mostrar("telaAdmin")
}

/* =========================
CARD√ÅPIO
========================= */

window.abrirCardapio=()=>{
mostrar("telaCardapio")
renderAbas()
}

function renderAbas(){
qs("abas").innerHTML=""
Object.keys(cardapio).forEach(a=>{
let b=document.createElement("button")
b.className="aba"
b.innerText=a
b.onclick=()=>renderItens(cardapio[a])
qs("abas").appendChild(b)
})
}

function renderItens(lista){

qs("lista").innerHTML=""

lista.forEach(it=>{
let el=document.createElement("div")
el.className="item"

el.innerHTML=`
<div>
<div style="font-weight:700;font-size:18px">${it.nome}</div>
<div style="color:#ff5722;font-weight:700">
R$ ${it.preco.toFixed(2)}
</div>
</div>
<button class="btnAdd">+</button>
`

el.querySelector("button").onclick=
()=>addCarrinho(it)

qs("lista").appendChild(el)
})
}

/* =========================
CARRINHO
========================= */

function totalItens(){
return carrinho.reduce((s,i)=>s+i.preco*i.qtd,0)
}
function freteAtual(){
return parseFloat(qs("frete").value||0)
}
function totalGeral(){
return totalItens()+freteAtual()
}

function addCarrinho(it){
let e=carrinho.find(x=>x.nome===it.nome)
e?e.qtd++:carrinho.push({...it,qtd:1})
qs("carrinho").classList.add("aberto")
renderCarrinho()
}

window.removerItem=n=>{
carrinho=carrinho.filter(i=>i.nome!==n)
renderCarrinho()
if(!carrinho.length)
qs("carrinho").classList.remove("aberto")
}

window.toggleCarrinho=()=>{
qs("carrinho").classList.toggle("aberto")
}

function renderCarrinho(){

qs("cLista").innerHTML=""
let q=0

carrinho.forEach(i=>{
q+=i.qtd
let r=document.createElement("div")
r.className="cItem"
r.innerHTML=`
<div>
<b>${i.qtd}x ${i.nome}</b><br>
R$ ${(i.qtd*i.preco).toFixed(2)}
</div>
<button onclick="removerItem('${i.nome}')">X</button>
`
qs("cLista").appendChild(r)
})

qs("qtd").innerText=q
qs("total").innerText=totalGeral().toFixed(2)

qs("linhaFreteCarrinho").style.display=
freteAtual()>0?"block":"none"

qs("freteCarrinhoTxt").innerText=
freteAtual().toFixed(2)

atualizarPix()
}

/* =========================
CHECKOUT
========================= */

qs("tipoPedido").onchange=e=>{
let ent=e.target.value==="entrega"
qs("boxEndereco").style.display=ent?"block":"none"
qs("boxMesa").style.display=ent?"none":"block"
qs("frete").value=ent?5:0
renderCarrinho()
}

qs("pagamento").onchange=e=>{
let p=e.target.value

qs("boxPix").style.display=
(p==="PIX")?"block":"none"

qs("boxTroco").style.display=
(p==="Dinheiro")?"block":"none"

pixComprovanteOK=false
qs("pixJaEnviei").checked=false
atualizarPix()
}

function atualizarPix(){
qs("pixValorTxt").innerText=
totalGeral().toFixed(2)
qs("pixChaveTxt").innerText=
PIX_CHAVE
}

/* comprovante */

qs("pixArquivo").onchange=()=>{
if(qs("pixArquivo").files.length>0)
pixComprovanteOK=true
}

qs("pixJaEnviei").onchange=e=>{
pixComprovanteOK=e.target.checked
}

window.abrirZapComprovante=()=>{
let v=totalGeral().toFixed(2)
let txt=`Comprovante PIX pedido ‚Äî valor R$ ${v}`
window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${encodeURIComponent(txt)}`)
}

/* =========================
FINALIZAR
========================= */

window.irCheckout=()=>{
if(!carrinho.length) return
mostrar("telaCheckout")
atualizarPix()
}

window.finalizarPedido=async()=>{

let nome=qs("nome").value
let tel=qs("telefone").value
if(!nome||!tel)
return alert("Preencha dados")

let tipo=qs("tipoPedido").value
let pag=qs("pagamento").value

if(tipo==="entrega" && pag==="PIX" && !pixComprovanteOK){
alert("Envie o comprovante PIX")
return
}

let pedido={
cliente:{nome,tel},
itens:carrinho,
total:totalGeral(),
data:new Date().toISOString()
}

try{
if(db) await addDoc(collection(db,"pedidos"),pedido)
}catch(e){}

let txt="ü•ü RECANTO DO PASTEL\n\n"
carrinho.forEach(i=>txt+=`${i.qtd}x ${i.nome}\n`)
txt+=`\nTotal R$ ${pedido.total.toFixed(2)}`

window.open(
`https://wa.me/${WHATSAPP_LOJA}?text=${
encodeURIComponent(txt)}`)

carrinho=[]
renderCarrinho()
qs("carrinho").classList.remove("aberto")
mostrar("telaInicial")
}

/* =========================
ADMIN ABAS UI
========================= */

window.adminNovaAba=()=>{
let n=prompt("Nome da nova aba")
if(!n||cardapio[n]) return
cardapio[n]=[]
renderAbas()
}

window.abrirRemoverAbaUI=()=>{
qs("listaAbasRemover").innerHTML=""
Object.keys(cardapio).forEach(a=>{
let b=document.createElement("button")
b.className="adminBtn"
b.innerText=a
b.onclick=()=>{
delete cardapio[a]
mostrar("telaAdmin")
renderAbas()
}
qs("listaAbasRemover").appendChild(b)
})
mostrar("uiRemoverAba")
}

/* =========================
NOVO PRODUTO UI
========================= */

window.abrirNovoProdutoUI=()=>{
qs("novoProdAba").innerHTML=""
Object.keys(cardapio).forEach(a=>{
let o=document.createElement("option")
o.innerText=a
qs("novoProdAba").appendChild(o)
})
mostrar("uiNovoProduto")
}

window.confirmarNovoProduto=()=>{
let nome=qs("novoProdNome").value
let preco=parseFloat(qs("novoProdPreco").value)
let aba=qs("novoProdAba").value
if(!nome||isNaN(preco)) return
cardapio[aba].push({nome,preco})
mostrar("telaAdmin")
}

/* =========================
EDITOR ITENS
========================= */

window.abrirEditorItens=()=>{
qs("listaEditor").innerHTML=""
Object.keys(cardapio).forEach(a=>{
cardapio[a].forEach(i=>{
let el=document.createElement("div")
el.className="item"
el.innerHTML=`
<div><b>${a}</b><br>${i.nome}<br>R$ ${i.preco}</div>
<div>
<button onclick="editNome('${a}','${i.nome}')">Nome</button>
<button onclick="editPreco('${a}','${i.nome}')">Pre√ßo</button>
<button onclick="remItem('${a}','${i.nome}')">X</button>
</div>`
qs("listaEditor").appendChild(el)
})
})
mostrar("telaEditorItens")
}

window.editNome=(a,n)=>{
let it=cardapio[a].find(x=>x.nome===n)
let novo=prompt("Novo nome",it.nome)
if(novo) it.nome=novo
abrirEditorItens()
}

window.editPreco=(a,n)=>{
let it=cardapio[a].find(x=>x.nome===n)
let novo=parseFloat(prompt("Novo pre√ßo",it.preco))
if(!isNaN(novo)) it.preco=novo
abrirEditorItens()
}

window.remItem=(a,n)=>{
cardapio[a]=cardapio[a].filter(x=>x.nome!==n)
abrirEditorItens()
}

/* =========================
RELAT√ìRIOS + EXCEL
========================= */

if(db){
onSnapshot(collection(db,"pedidos"),snap=>{
pedidosCache=[]
qs("adminPedidos").innerHTML=""
snap.forEach(d=>{
let p=d.data()
pedidosCache.push(p)
qs("adminPedidos").innerHTML+=
`${p.cliente.nome} ‚Äî R$ ${p.total}<br>`
})
})
}

function soma(fn){
return pedidosCache.filter(fn)
.reduce((s,p)=>s+p.total,0)
}

window.relatorioHoje=()=>{
let h=new Date().toDateString()
alert(soma(p=>new Date(p.data).toDateString()===h))
}

window.relatorioMes=()=>{
let m=new Date().getMonth()
alert(soma(p=>new Date(p.data).getMonth()===m))
}

window.relatorioAno=()=>{
let a=new Date().getFullYear()
alert(soma(p=>new Date(p.data).getFullYear()===a))
}

window.exportarExcel=()=>{
let csv="nome,total,data\n"
pedidosCache.forEach(p=>{
csv+=`${p.cliente.nome},${p.total},${p.data}\n`
})
let blob=new Blob([csv])
let a=document.createElement("a")
a.href=URL.createObjectURL(blob)
a.download="relatorio.csv"
a.click()
}

window.zerarRelatorios=async()=>{
if(!confirm("Apagar todos?")) return
let s=await getDocs(collection(db,"pedidos"))
s.forEach(d=>deleteDoc(d.ref))
}

/* ========================= */

renderAbas()

</script>
</body>
</html>
